---
title: Golang-语法基础
author: Draco
time: 2021-06-08 20:15:56
categories: 
  - Golang
tags: 
  - Golang
---





## 参考

::: tip

- [Go编程时光](http://golang.iswbm.com/)
- [Go语言入门教程](http://c.biancheng.net/golang/)
- [Go 圣经](https://books.studygolang.com/gopl-zh/)
- [《Go 语言入门经典》](https://weread.qq.com/web/reader/12132c407193f24a121a46b)

:::





## 变量和常量的声明

Go 语言是静态类型语言，由于编译时，编译器会检查变量的类型，所以要求所有的变量都要有明确的类型。

**变量在使用前，需要先声明**。声明类型，就约定了你这个变量只能赋该类型的值。

声明一般有以下几种方法

> 其中前面两种同样也可用于定义常量，只需把关键字 `var` 变成 `const` 即可。



Go 标准库风格建议在函数外使用 var 或 const 声明且省略类型，在函数内部使用 `:= ` 的简短声明





### 第一种：使用 var

```go
var <name> <type>
```

其中 var 是关键字（固定不变），name 是变量名，type 是类型。

使用 var ，虽然只指定了类型，但是 Go 会对其进行`隐式初始化`，比如 

- string 类型就初始化为空字符串
- int 类型就初始化为0
- float 就初始化为 0.0
- bool类型就初始化为false
- 指针类型就初始化为 nil

若想在声明过程，顺便也初始化，可以这样写

```go
var name string = "字符串"
```



可以简化为

```go
vat name = "字符串"
```



若你的右值带有小数点，**在不指定类型的情况下，编译器会将你的这个变量声明为 float64**，但是很多情况下，我们并不需要这么高的精度（占用的内存空间更大）

这种情况下，推荐指定类型，不要偷懒

```go
var rate float32 = 0.89
```



声明多个：

```go
var s, t string = "foo", "bar"
```

或

```go
var (
    name string
    age int
    gender string
)
```





### 第二种：使用 := 短变量声明

使用 `:=` （推导声明写法或者短类型声明法：编译器会自动根据右值类型推断出左值的对应类型。），可以声明一个变量，并对其进行（显式）初始化。

> 只能用于函数内部

```go
name := "Go"

// 等价于

var name string = "Go"

// 等价于

var name = "Go"
```



声明多个：

```go
name, age := "wangbm", 28
```

这种方法，也经常用于变量的交换

```go
var a int = 100
var b int = 200
b, a = a, b
```

> 两个变量要同一个类型





### 第三种：new 函数声明一个指针变量

变量分为两种 `普通变量` 和 `指针变量`

::: info

- 普通变量：存放的是数据本身
- 指针变量：存放的是数据的地址。

:::



如下代码，age 是一个普通变量，存放的内容是 28，而 ptr 是 存放变量age值的内存地址：0xc000010098

```go
package main

import "fmt"

func main()  {
    var age int = 28
    var ptr = &age  // &后面接变量名，表示取出该变量的内存地址
    fmt.Println("age: ", age)
    fmt.Println("ptr: ", ptr)
}
```

输出

```
age:  28
ptr:  0xc000010098
```



而这里要说的 new 函数，是 Go 里的一个内建函数。

使用表达式 `new(Type)` 将创建一个Type类型的匿名变量，初始化为Type类型的零值，然后返回`变量地址`，返回的指针类型为`*Type`。



用new创建变量和普通变量声明语句方式创建变量没有什么区别，除了不需要声明一个临时变量的名字外，我们还可以在表达式中使用new(Type)。换言之，new函数类似是一种语法糖，而不是一个新的基础概念。

如下两种写法，可以说是等价的

```go
// 使用 new
func newInt() *int {
    return new(int)
}

// 使用传统的方式
func newInt() *int {
    var dummy int
    return &dummy
}
```

以上不管哪种方法，变量/常量都只能声明一次，声明多次，编译就会报错。

但也有例外，这就要说到一个特殊变量：**匿名变量**，也称作占位符，或者空白标识符，用下划线表示。

匿名变量，优点有三：

- 不分配内存，不占用内存空间
- 不需要你为命名无用的变量名而纠结
- 多次声明不会有任何问题

通常我们用匿名接收必须接收，但是又不会用到的值。

```go
func GetData() (int, int) {
    return 100, 200
}
func main(){
    a, _ := GetData()
    _, b := GetData()
    fmt.Println(a, b)
}
```



### 常量声明 

```go
const s string = "Hello World"
```



### 变量的零值

如果声明变量没有给指定值，则变量降为默认值，这种默认值被称为零值，不同于其他语言的  null & nil & undefined。

```go
func TestDefaultValue(t *testing.T) {
	var (
		i int
		f float32
		b bool
		s string
	)
	fmt.Printf("%v %v %v %q\n", i, f, b, s)
}

//0 0 false ""
```





## 数据类型



### 整型

Go 语言中，整数类型可以再细分成10个类型，为了方便大家学习，我将这些类型整理成一张表格。



![image1](http://image.iswbm.com/20200120204329.png)

> int 和 uint 的区别就在于一个 `u`，有 `u` 说明是无符号，没有 `u` 代表有符号。



#### 解释这个符号的区别

以 `int8` 和 `uint8` 举例，8 代表 8个bit，能表示的数值个数有 `2^8 = 256`。

uint8 是无符号，能表示的都是正数，`0-255`，刚好256个数。

int8 是有符号，既可以正数，也可以负数，那怎么办？对半分呗，`-128-127`，也刚好 256个数。

int8 int16 int32 int64 这几个类型的最后都有一个数值，这表明了它们能表示的数值个数是固定的。

而 int 并没有指定它的位数，说明它的大小，是可以变化的，那根据什么变化呢？

- 当你在32位的系统下，int 和 uint 都占用 4个字节，也就是32位。
- 若你在64位的系统下，int 和 uint 都占用 8个字节，也就是64位。

出于这个原因，在某些场景下，你应当避免使用 int 和 uint ，而使用更加精确的 int32 和 int64，比如在二进制传输、读写文件的结构描述（为了保持文件的结构不会受到不同编译目标平台字节长度的影响）



#### 不同进制的表示方法

出于习惯，在初始化数据类型为整型的变量时，我们会使用10进制的表示法，因为它最直观，比如这样，表示整数10.

```go
var num int = 10
```

不过，你要清楚，你一样可以使用其他进制来表示一个整数，这里以比较常用的2进制、8进制和16进制举例。

2进制：以`0b`或`0B`为前缀

```go
var num01 int = 0b1100
```

8进制：以`0o`或者 `0O`为前缀

```go
var num02 int = 0o14
```

16进制：以`0x` 为前缀

```go
var num03 int = 0xC
```

下面用一段代码分别使用二进制、8进制、16进制来表示 10 进制的数值：12

```go
package main

import (
    "fmt"
)

func main() {
    var num01 int = 0b1100
    var num02 int = 0o14
    var num03 int = 0xC

    fmt.Printf("2进制数 %b 表示的是: %d \n", num01, num01)
    fmt.Printf("8进制数 %o 表示的是: %d \n", num02, num02)
    fmt.Printf("16进制数 %X 表示的是: %d \n", num03, num03)
}
```

输出如下

```
2进制数 1100 表示的是: 12
8进制数 14 表示的是: 12
16进制数 C 表示的是: 12
```

以上代码用过了 fmt 包的格式化功能，你可以参考这里去看上面的代码

```
%b    表示为二进制
%c    该值对应的unicode码值
%d    表示为十进制
%o    表示为八进制
%q    该值对应的单引号括起来的go语法字符字面值，必要时会采用安全的转义表示
%x    表示为十六进制，使用a-f
%X    表示为十六进制，使用A-F
%U    表示为Unicode格式：U+1234，等价于"U+%04X"
%E    用科学计数法表示
%f    用浮点数表示
```



### 浮点型

浮点数类型的值一般由整数部分、小数点“`.`”和小数部分组成。

其中，整数部分和小数部分均由10进制表示法表示。不过还有另一种表示方法。那就是在其中加入指数部分。指数部分由“E”或“e”以及一个带正负号的10进制数组成。比如，`3.7E-2`表示浮点数`0.037`。又比如，`3.7E+1`表示浮点数`37`。

有时候，浮点数类型值的表示也可以被简化。比如，`37.0`可以被简化为`37`。又比如，`0.037`可以被简化为`.037`。

> 有一点需要注意，在Go语言里，浮点数的相关部分只能由10进制表示法表示，而不能由8进制表示法或16进制表示法表示。比如，`03.7`表示的一定是浮点数`3.7`。



#### float32 和 float64

Go语言中提供了两种精度的浮点数 float32 和 float64。

**float32**，也即我们常说的单精度，存储占用4个字节，也即4*8=32位，其中1位用来符号，8位用来指数，剩下的23位表示尾数

![img](https://pic4.zhimg.com/80/v2-749cc641eb4d5dafd085e8c23f8826aa_hd.jpg)

img

**float64**，也即我们熟悉的双精度，存储占用8个字节，也即8*8=64位，其中1位用来符号，11位用来指数，剩下的52位表示尾数

![img](https://pic2.zhimg.com/80/v2-48240f0e1e0dd33ec89100cbe2d30707_hd.jpg)



### byte、rune与字符串

