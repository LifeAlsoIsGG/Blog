<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Redis部署与基本使用 | Draco&#39;s Blog</title>
    <meta name="generator" content="VuePress 1.9.7">
    <script src="https://cdn.jsdelivr.net/npm/react/umd/react.production.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/react-dom/umd/react-dom.production.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@babel/standalone/babel.min.js"></script>
    <link rel="icon" href="/favicon.ico">
    <link rel="icon" href="/assets/icon/chrome-mask-512.png" type="image/png" sizes="512x512">
    <link rel="icon" href="/assets/icon/chrome-mask-192.png" type="image/png" sizes="192x192">
    <link rel="icon" href="/assets/icon/chrome-512.png" type="image/png" sizes="512x512">
    <link rel="icon" href="/assets/icon/chrome-192.png" type="image/png" sizes="192x192">
    <link rel="manifest" href="/manifest.webmanifest" crossorigin="use-credentials">
    <link rel="apple-touch-icon" href="/assets/icon/apple-icon-152.png">
    <meta name="description" content="美丽新世界">
    <meta property="og:url" content="https://vuepress-theme-hope-demo.mrhope.site/database/redis/Redis_deployment&amp;use.html">
    <meta property="og:site_name" content="Draco&#39;s Blog">
    <meta property="og:title" content="Redis部署与基本使用">
    <meta property="og:type" content="article">
    <meta property="og:image" content="https://vuepress-theme-hope-demo.mrhope.site/">
    <meta property="og:locale" content="en-US">
    <meta property="og:locale:alternate" content="zh-CN">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image:alt" content="Redis部署与基本使用">
    <meta property="article:author" content="Draco">
    <meta property="article:tag" content="数据库">
    <meta property="article:published_time" content="2020-11-21T15:17:13.000Z">
    <meta name="theme-color" content="#46bd87">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileImage" content="/assets/icon/ms-icon-144.png">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    
    <link rel="preload" href="/assets/css/0.styles.66747f18.css" as="style"><link rel="preload" href="/assets/js/app.f37efbaf.js" as="script"><link rel="preload" href="/assets/js/vendors~layout-Layout.f4e7cf7e.js" as="script"><link rel="preload" href="/assets/js/vendors~layout-Blog~layout-Layout~layout-NotFound.9dd70d26.js" as="script"><link rel="preload" href="/assets/js/page-Redis部署与基本使用.ebeabc90.js" as="script"><link rel="preload" href="/assets/js/vendors~layout-Blog~layout-Layout.2ab8e312.js" as="script"><link rel="prefetch" href="/assets/js/126.0fdf291b.js"><link rel="prefetch" href="/assets/js/127.84bcceb5.js"><link rel="prefetch" href="/assets/js/128.ac62039f.js"><link rel="prefetch" href="/assets/js/129.ca752e3a.js"><link rel="prefetch" href="/assets/js/130.e96b6083.js"><link rel="prefetch" href="/assets/js/131.884b0a1d.js"><link rel="prefetch" href="/assets/js/132.e1cad475.js"><link rel="prefetch" href="/assets/js/layout-Blog.15024dbf.js"><link rel="prefetch" href="/assets/js/layout-Layout.e7c6637c.js"><link rel="prefetch" href="/assets/js/layout-NotFound.1ff18383.js"><link rel="prefetch" href="/assets/js/layout-Slide.469c1fb5.js"><link rel="prefetch" href="/assets/js/page-About.c11d407a.js"><link rel="prefetch" href="/assets/js/page-BlogHome.0eec53ed.js"><link rel="prefetch" href="/assets/js/page-Componentdisabled.1a1efbd0.js"><link rel="prefetch" href="/assets/js/page-DockerInstallsoftware.c3c5d32d.js"><link rel="prefetch" href="/assets/js/page-Dockerdeployment.e4f74fbc.js"><link rel="prefetch" href="/assets/js/page-Docker学习笔记.66f43bd5.js"><link rel="prefetch" href="/assets/js/page-Dubbo笔记.ef25589f.js"><link rel="prefetch" href="/assets/js/page-EasyExcel导入导出Excel.1aee734b.js"><link rel="prefetch" href="/assets/js/page-ElasticSearch笔记.38669873.js"><link rel="prefetch" href="/assets/js/page-ElasticSearch面试.be29ac46.js"><link rel="prefetch" href="/assets/js/page-Encryptionarticle.f73cf4b6.js"><link rel="prefetch" href="/assets/js/page-Git笔记.0c093588.js"><link rel="prefetch" href="/assets/js/page-Golang-介绍和使用.3d438d80.js"><link rel="prefetch" href="/assets/js/page-Golang-语法基础.ab25dda7.js"><link rel="prefetch" href="/assets/js/page-GoogleCloudSpanner.43b4ad6e.js"><link rel="prefetch" href="/assets/js/page-Guides.69d6506d.js"><link rel="prefetch" href="/assets/js/page-Hadoop伪分布式配置.9d528440.js"><link rel="prefetch" href="/assets/js/page-HttpServletrequest与HttpServletResponse.129c598c.js"><link rel="prefetch" href="/assets/js/page-IDEA初始化SpringBoot项目+逆向工程+配置.b64826d3.js"><link rel="prefetch" href="/assets/js/page-JVM-类加载子系统.114ecadd.js"><link rel="prefetch" href="/assets/js/page-JVM-运行时数据区.cf1b6ae6.js"><link rel="prefetch" href="/assets/js/page-JVM.94c690a4.js"><link rel="prefetch" href="/assets/js/page-JWT认证原理(更新中).25d448ac.js"><link rel="prefetch" href="/assets/js/page-Java-IO.292a5f23.js"><link rel="prefetch" href="/assets/js/page-Java-String.28b10d71.js"><link rel="prefetch" href="/assets/js/page-Java-UML类图.fb393bc2.js"><link rel="prefetch" href="/assets/js/page-Java-基础知识笔记.5b2f5261.js"><link rel="prefetch" href="/assets/js/page-Java-基础面试题.28ea8149.js"><link rel="prefetch" href="/assets/js/page-Java-多线程并发.a601bb18.js"><link rel="prefetch" href="/assets/js/page-Java-常用方法汇总.494b74a5.js"><link rel="prefetch" href="/assets/js/page-Java-新特性.f3b6506c.js"><link rel="prefetch" href="/assets/js/page-Java-注解和反射.9d7f774b.js"><link rel="prefetch" href="/assets/js/page-Java-设计模式.417fe60b.js"><link rel="prefetch" href="/assets/js/page-Java-集合容器.f24ce96a.js"><link rel="prefetch" href="/assets/js/page-JavaScript面试题.1ee41246.js"><link rel="prefetch" href="/assets/js/page-JavaSwing-超市系统.9835d633.js"><link rel="prefetch" href="/assets/js/page-Javaweb大学活动管理系统.de71ae58.js"><link rel="prefetch" href="/assets/js/page-Java多线程-1.fdc9b756.js"><link rel="prefetch" href="/assets/js/page-Java多线程-2.792233bb.js"><link rel="prefetch" href="/assets/js/page-Java多线程-JUC使用.66714093.js"><link rel="prefetch" href="/assets/js/page-Java多线程-关键字锁.dde1efcd.js"><link rel="prefetch" href="/assets/js/page-Java学习目录.fa7d1ab3.js"><link rel="prefetch" href="/assets/js/page-Java面试整理.d9bb5702.js"><link rel="prefetch" href="/assets/js/page-Linux常用命令.83eaa010.js"><link rel="prefetch" href="/assets/js/page-Linux技巧.8d8a83fa.js"><link rel="prefetch" href="/assets/js/page-MarkdownEnhance.8722d148.js"><link rel="prefetch" href="/assets/js/page-Markdown增强.20153906.js"><link rel="prefetch" href="/assets/js/page-Maven笔记.bff49840.js"><link rel="prefetch" href="/assets/js/page-MyProject.e553bcf5.js"><link rel="prefetch" href="/assets/js/page-Mybatis-Plus基础笔记.3423af20.js"><link rel="prefetch" href="/assets/js/page-Mybatis基础笔记.1c27d76d.js"><link rel="prefetch" href="/assets/js/page-Mybatis语法笔记.1f2e8b78.js"><link rel="prefetch" href="/assets/js/page-Mybatis逆向工程Example类使用.82842443.js"><link rel="prefetch" href="/assets/js/page-Mysql理论学习笔记.896cd9ba.js"><link rel="prefetch" href="/assets/js/page-Nginx-动静分离.c751f862.js"><link rel="prefetch" href="/assets/js/page-Nginx-反向代理.f1323ed9.js"><link rel="prefetch" href="/assets/js/page-Nginx-负载均衡.abb94f87.js"><link rel="prefetch" href="/assets/js/page-Nginx基础笔记和安装配置.4ad2f18f.js"><link rel="prefetch" href="/assets/js/page-Nginx学习目录.e349509a.js"><link rel="prefetch" href="/assets/js/page-Promise异步调用.f0d027db.js"><link rel="prefetch" href="/assets/js/page-RabbitMQ.c29f9a83.js"><link rel="prefetch" href="/assets/js/page-RabbitMQ面试题.b3e180d7.js"><link rel="prefetch" href="/assets/js/page-Redis应用场景.3f1ff728.js"><link rel="prefetch" href="/assets/js/page-Redis理论学习笔记.7cea7686.js"><link rel="prefetch" href="/assets/js/page-Redis集群和哨兵.e1a63bd1.js"><link rel="prefetch" href="/assets/js/page-Restful.4d002b68.js"><link rel="prefetch" href="/assets/js/page-SQL学习笔记.b6283069.js"><link rel="prefetch" href="/assets/js/page-SSH.07cf6f1d.js"><link rel="prefetch" href="/assets/js/page-Slidepage.ce18af28.js"><link rel="prefetch" href="/assets/js/page-Spring-RestTemplate.8acb90a4.js"><link rel="prefetch" href="/assets/js/page-SpringBootVue项目搭建(持续更新).fc386327.js"><link rel="prefetch" href="/assets/js/page-SpringSecurity.82e6e104.js"><link rel="prefetch" href="/assets/js/page-Spring基础笔记.813ed085.js"><link rel="prefetch" href="/assets/js/page-Spring注解.5b76683c.js"><link rel="prefetch" href="/assets/js/page-Spring错误坑记录.3dc579b6.js"><link rel="prefetch" href="/assets/js/page-Spring错误笔记.9780c436.js"><link rel="prefetch" href="/assets/js/page-Spring面试题.3398b38e.js"><link rel="prefetch" href="/assets/js/page-Swagger使用.e9dfe2d2.js"><link rel="prefetch" href="/assets/js/page-pageconfig.b83bc34b.js"><link rel="prefetch" href="/assets/js/page-主要功能与配置演示.594094d6.js"><link rel="prefetch" href="/assets/js/page-修改Host以访问Github.1050944f.js"><link rel="prefetch" href="/assets/js/page-前端学习目录.3f5e8816.js"><link rel="prefetch" href="/assets/js/page-字节测开面经.46658822.js"><link rel="prefetch" href="/assets/js/page-学习路线.fecd41c8.js"><link rel="prefetch" href="/assets/js/page-实验室出入管理小程序.f1fac269.js"><link rel="prefetch" href="/assets/js/page-密码加密的文章.cdedbba8.js"><link rel="prefetch" href="/assets/js/page-幻灯片页.8ad8e5ee.js"><link rel="prefetch" href="/assets/js/page-操作系统.ed5bf774.js"><link rel="prefetch" href="/assets/js/page-数据库学习目录.0b66440b.js"><link rel="prefetch" href="/assets/js/page-数据结构.7e177678.js"><link rel="prefetch" href="/assets/js/page-数据结构算法学习目录.6e9a96d7.js"><link rel="prefetch" href="/assets/js/page-数据结构算法题目合集.f539a1d1.js"><link rel="prefetch" href="/assets/js/page-服务器上部署SpringBoot.6d181be6.js"><link rel="prefetch" href="/assets/js/page-概述参考.f7a19770.js"><link rel="prefetch" href="/assets/js/page-算法.a08b5a7b.js"><link rel="prefetch" href="/assets/js/page-组件禁用.6bb1660e.js"><link rel="prefetch" href="/assets/js/page-腾讯云学习笔记.1bec7d68.js"><link rel="prefetch" href="/assets/js/page-自定义布局.7cf01612.js"><link rel="prefetch" href="/assets/js/page-计算机知识.1760d3d2.js"><link rel="prefetch" href="/assets/js/page-计算机网络.a78948d4.js"><link rel="prefetch" href="/assets/js/page-认识SpringCloud.18e79646.js"><link rel="prefetch" href="/assets/js/page-设计模式七大原则.4366f0cb.js"><link rel="prefetch" href="/assets/js/page-设计模式之J2EE设计模式.b21c8f8f.js"><link rel="prefetch" href="/assets/js/page-设计模式之创建型设计模式.d49a22e3.js"><link rel="prefetch" href="/assets/js/page-设计模式之结构型设计模式.474cda96.js"><link rel="prefetch" href="/assets/js/page-设计模式之行为型设计模式.f3e7a5c1.js"><link rel="prefetch" href="/assets/js/page-面试大纲.39e822d6.js"><link rel="prefetch" href="/assets/js/page-音频批量识别平台.64c0e8af.js"><link rel="prefetch" href="/assets/js/page-页面配置.c353ad4a.js"><link rel="prefetch" href="/assets/js/page-项目主页.1a72b713.js"><link rel="prefetch" href="/assets/js/vendors~chart.eac869b4.js"><link rel="prefetch" href="/assets/js/vendors~flowchart.ea0348d6.js"><link rel="prefetch" href="/assets/js/vendors~mermaid.6841064d.js"><link rel="prefetch" href="/assets/js/vendors~photo-swipe.cf893ebe.js"><link rel="prefetch" href="/assets/js/vendors~reveal.053f36f4.js"><link rel="prefetch" href="/assets/js/vendors~waline.57fdea87.js">
    <link rel="stylesheet" href="/assets/css/0.styles.66747f18.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container has-navbar has-sidebar has-anchor"><header class="navbar"><!----> <div class="content__navbar-start"></div> <button title="Sidebar Button" class="sidebar-button"><span class="icon"></span></button> <a href="/" class="home-link router-link-active"><img src="https://blog-1300186248.cos.ap-shanghai.myqcloud.com/avatar.png" alt="Draco's Blog" class="logo"> <!----> <span class="site-name can-hide">Draco's Blog</span></a> <!----> <div class="content__navbar-center"></div> <div class="links"><button tabindex="-1" aria-hidden="true" class="color-button"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="skin-icon"><path d="M224 800c0 9.6 3.2 44.8 6.4 54.4 6.4 48-48 76.8-48 76.8s80 41.6 147.2 0 134.4-134.4
        38.4-195.2c-22.4-12.8-41.6-19.2-57.6-19.2C259.2 716.8 227.2 761.6 224 800zM560 675.2l-32
        51.2c-51.2 51.2-83.2 32-83.2 32 25.6 67.2 0 112-12.8 128 25.6 6.4 51.2 9.6 80 9.6 54.4 0
        102.4-9.6 150.4-32l0 0c3.2 0 3.2-3.2 3.2-3.2 22.4-16 12.8-35.2
        6.4-44.8-9.6-12.8-12.8-25.6-12.8-41.6 0-54.4 60.8-99.2 137.6-99.2 6.4 0 12.8 0 22.4
        0 12.8 0 38.4 9.6 48-25.6 0-3.2 0-3.2 3.2-6.4 0-3.2 3.2-6.4 3.2-6.4 6.4-16 6.4-16 6.4-19.2
        9.6-35.2 16-73.6 16-115.2 0-105.6-41.6-198.4-108.8-268.8C704 396.8 560 675.2 560 675.2zM224
        419.2c0-28.8 22.4-51.2 51.2-51.2 28.8 0 51.2 22.4 51.2 51.2 0 28.8-22.4 51.2-51.2 51.2C246.4
        470.4 224 448 224 419.2zM320 284.8c0-22.4 19.2-41.6 41.6-41.6 22.4 0 41.6 19.2 41.6 41.6 0
        22.4-19.2 41.6-41.6 41.6C339.2 326.4 320 307.2 320 284.8zM457.6 208c0-12.8 12.8-25.6 25.6-25.6
        12.8 0 25.6 12.8 25.6 25.6 0 12.8-12.8 25.6-25.6 25.6C470.4 233.6 457.6 220.8 457.6 208zM128
        505.6C128 592 153.6 672 201.6 736c28.8-60.8 112-60.8 124.8-60.8-16-51.2 16-99.2
        16-99.2l316.8-422.4c-48-19.2-99.2-32-150.4-32C297.6 118.4 128 291.2 128 505.6zM764.8
        86.4c-22.4 19.2-390.4 518.4-390.4 518.4-22.4 28.8-12.8 76.8 22.4 99.2l9.6 6.4c35.2 22.4
        80 12.8 99.2-25.6 0 0 6.4-12.8 9.6-19.2 54.4-105.6 275.2-524.8 288-553.6
        6.4-19.2-3.2-32-19.2-32C777.6 76.8 771.2 80 764.8 86.4z"></path></svg> <div class="color-picker-menu" style="display:none;"><div class="theme-options"><ul class="themecolor-select"><label for="themecolor-select">Theme Color:</label> <li><span class="default-theme"></span></li> </ul> <div class="darkmode-toggle"><label for="darkmode-toggle" class="desc">Theme Mode:</label> <div class="darkmode-switch"><div class="item day"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon light-icon"><path d="M512 256a42.667 42.667 0 0 0 42.667-42.667V128a42.667 42.667 0 0 0-85.334 0v85.333A42.667 42.667 0 0 0 512 256zm384 213.333h-85.333a42.667 42.667 0 0 0 0 85.334H896a42.667 42.667 0 0 0 0-85.334zM256 512a42.667 42.667 0 0 0-42.667-42.667H128a42.667 42.667 0 0 0 0 85.334h85.333A42.667 42.667 0 0 0 256 512zm9.387-298.667a42.667 42.667 0 0 0-59.307 62.72l61.44 59.307a42.667 42.667 0 0 0 31.147 11.947 42.667 42.667 0 0 0 30.72-13.227 42.667 42.667 0 0 0 0-60.16zm459.946 133.974a42.667 42.667 0 0 0 29.44-11.947l61.44-59.307a42.667 42.667 0 0 0-57.6-62.72l-61.44 60.587a42.667 42.667 0 0 0 0 60.16 42.667 42.667 0 0 0 28.16 13.227zM512 768a42.667 42.667 0 0 0-42.667 42.667V896a42.667 42.667 0 0 0 85.334 0v-85.333A42.667 42.667 0 0 0 512 768zm244.48-79.36a42.667 42.667 0 0 0-59.307 61.44l61.44 60.587a42.667 42.667 0 0 0 29.44 11.946 42.667 42.667 0 0 0 30.72-12.8 42.667 42.667 0 0 0 0-60.586zm-488.96 0-61.44 59.307a42.667 42.667 0 0 0 0 60.586 42.667 42.667 0 0 0 30.72 12.8 42.667 42.667 0 0 0 28.587-10.666l61.44-59.307a42.667 42.667 0 0 0-59.307-61.44zM512 341.333A170.667 170.667 0 1 0 682.667 512 170.667 170.667 0 0 0 512 341.333z" fill="currentColor"></path></svg></div> <div class="item auto active"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon auto-icon"><path d="M460.864 539.072H564.8L510.592 376l-49.728 163.072zM872 362.368V149.504H659.648L510.528 0l-149.12 149.504H149.12v212.928L0 511.872l149.12 149.504v212.928h212.352l149.12 149.504 149.12-149.504h212.352V661.376l149.12-149.504L872 362.368zM614.464 693.12l-31.616-90.624H438.272l-31.616 90.624h-85.888l144.576-407.68h90.368l144.576 407.68h-85.824zm0 0" fill="currentColor"></path></svg></div> <div class="item night"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon dark-icon"><path d="M935.539 630.402c-11.43-11.432-28.674-14.739-43.531-8.354-46.734 20.103-96.363 30.297-147.508 30.297-99.59 0-193.221-38.784-263.64-109.203-108.637-108.637-139.61-270.022-78.908-411.148a39.497 39.497 0 0 0-51.886-51.887c-52.637 22.64-100.017 54.81-140.826 95.616-85.346 85.346-132.346 198.821-132.346 319.52 0 120.7 47.001 234.172 132.347 319.519S408.063 947.11 528.76 947.11c120.7 0 234.172-47.003 319.52-132.351 40.809-40.81 72.978-88.19 95.616-140.826a39.497 39.497 0 0 0-8.356-43.532z" fill="currentColor"></path></svg></div></div> <!----></div></div></div></button> <div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/category/" class="nav-link"><i class="iconfont icon-note"></i>
  Category
</a></div><div class="nav-item"><a href="/project/" class="nav-link"><i class="iconfont icon-note"></i>
  My Project
</a></div><div class="nav-item"><a href="/guide/" class="nav-link"><i class="iconfont icon-creative"></i>
  Guide
</a></div><div class="nav-item"><a href="/about/" class="nav-link"><i class="iconfont icon-info"></i>
  About
</a></div></nav> <div class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon i18n-icon" style="width:1rem;height:1rem;vertical-align:middle;margin-left:1rem;"><path d="M639.981 344.075c14.805 44.45 34.542 79.023 69.084 113.596 29.603-29.634 49.34-69.146 64.145-113.596H639.981zM314.33 591.024h128.29l-64.145-172.865-64.145 172.865z" fill="currentColor"></path> <path d="M807.746 116.882H215.643c-54.274 0-98.681 44.45-98.681 98.78v592.677c0 54.329 44.407 98.78 98.68 98.78h592.104c54.273 0 98.681-44.451 98.681-98.78V215.66c0-54.329-39.475-98.78-98.68-98.78zM565.971 754.01c-9.866 9.878-19.738 9.878-29.603 9.878-4.94 0-14.805 0-19.738-4.939-4.939-4.939-9.872 0-9.872-4.939s-4.932-9.878-9.865-19.756c-4.94-9.878-4.94-14.817-9.872-24.695L467.29 655.23H294.592l-19.737 54.33c-9.866 19.755-14.805 34.572-19.738 44.45-4.939 9.878-14.804 9.878-29.603 9.878-9.871 0-19.737-4.939-29.609-9.878-9.865-9.878-14.798-14.817-14.798-24.695 0-4.939 0-9.878 4.933-19.756 4.939-9.878 4.939-14.817 9.865-24.695l108.553-276.583c4.939-9.878 4.939-19.756 9.872-29.633 4.932-9.878 9.865-19.756 14.798-24.695 4.939-4.94 9.872-14.817 19.737-19.756 9.872-4.94 19.738-4.94 29.61-4.94 9.865 0 19.73 0 29.603 4.94 9.865 4.939 14.804 9.878 19.737 19.756 4.933 4.939 9.866 14.817 14.798 24.695 4.94 9.877 9.872 19.755 14.805 34.572l108.553 271.644c9.865 19.756 14.804 34.573 14.804 44.451-4.939 4.94-9.872 14.817-14.804 24.695zm271.378-192.62c-54.273-19.756-93.748-44.451-128.29-74.085-34.536 34.573-78.943 59.268-133.223 74.085l-14.798-24.695c54.273-14.817 98.68-34.573 133.223-69.146-34.542-34.573-64.145-79.024-74.017-128.413h-49.34V319.38h133.228c-9.877-14.817-19.743-34.573-29.609-49.39l14.799-4.94c9.871 14.818 24.676 34.574 34.542 54.33h123.35v24.695h-49.34c-14.798 49.39-39.468 93.84-69.077 123.474 34.541 29.634 74.01 54.329 128.29 69.146l-19.738 24.695z" fill="currentColor"></path></svg> <span class="arrow"></span></button> <ul class="nav-dropdown"><li class="dropdown-item"><a href="/database/redis/Redis_deployment&amp;use/" aria-current="page" class="nav-link router-link-exact-active router-link-active active"><!---->
  English
</a></li><li class="dropdown-item"><a href="/zh/" class="nav-link"><!---->
  简体中文
</a></li></ul></div></div></div> <a rel="noopener noreferrer" href="https://github.com/LifeAlsoIsGG" target="_blank" class="repo-link can-hide">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> <!----> <div class="content__navbar-end"></div></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><div vocab="https://schema.org/" typeof="Person" class="blogger-info mobile"><div data-balloon-pos="down" role="navigation" class="blogger hasIntro"><img property="image" alt="Blogger Avatar" src="https://blog-1300186248.cos.ap-shanghai.myqcloud.com/avatar.png" class="avatar round"> <div property="name" class="name">Draco</div> <meta property="url" content="/about/"></div> <div class="num-wrapper"><div><div class="num">111</div> <div>Articles</div></div> <div><div class="num">35</div> <div>Category</div></div> <div><div class="num">60</div> <div>Tags</div></div> <div><div class="num">111</div> <div>Timeline</div></div></div> <div class="media-links-wrapper"><a href="https://github.com/LifeAlsoIsGG" rel="noopener noreferrer" target="_blank" aria-label="Github" data-balloon-pos="up" class="media-link"><span class="sr-only">Github</span> <svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon icon-github"><circle cx="512" cy="512" r="512" fill="#171515"></circle> <path d="M509.423 146.442c-200.317 0-362.756 162.42-362.756 362.8 0 160.266 103.936 296.24 248.109 344.217 18.139 3.327 24.76-7.872 24.76-17.486 0-8.613-.313-31.427-.49-61.702-100.912 21.923-122.205-48.63-122.205-48.63-16.495-41.91-40.28-53.067-40.28-53.067-32.937-22.51 2.492-22.053 2.492-22.053 36.407 2.566 55.568 37.386 55.568 37.386 32.362 55.438 84.907 39.43 105.58 30.143 3.296-23.444 12.667-39.43 23.032-48.498-80.557-9.156-165.246-40.28-165.246-179.297 0-39.604 14.135-71.988 37.342-97.348-3.731-9.178-16.18-46.063 3.556-96.009 0 0 30.46-9.754 99.76 37.19 28.937-8.048 59.97-12.071 90.823-12.211 30.807.14 61.843 4.165 90.822 12.21 69.26-46.944 99.663-37.189 99.663-37.189 19.792 49.946 7.34 86.831 3.61 96.01 23.25 25.359 37.29 57.742 37.29 97.347 0 139.366-84.82 170.033-165.637 179.013 13.026 11.2 24.628 33.342 24.628 67.182 0 48.498-.445 87.627-.445 99.521 0 9.702 6.535 20.988 24.945 17.444 144.03-48.067 247.881-183.95 247.881-344.175 0-200.378-162.442-362.798-362.802-362.798z" fill="#FFF"></path></svg></a><a href="https://twitter.com/LifeAlsoIsGG" rel="noopener noreferrer" target="_blank" aria-label="Twitter" data-balloon-pos="up" class="media-link"><span class="sr-only">Twitter</span> <svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon icon-twitter"><circle cx="512" cy="512" r="512" fill="#5EAADE"></circle> <path d="M749.737 364.631c-17.594 7.805-36.513 13.088-56.371 15.459 20.269-12.148 35.836-31.387 43.156-54.312A196.233 196.233 0 0 1 674.2 349.6c-17.894-19.083-43.406-30.997-71.636-30.997-54.2 0-98.137 43.944-98.137 98.157 0 7.695.861 15.19 2.544 22.373-81.57-4.092-153.876-43.174-202.284-102.558-8.443 14.498-13.285 31.356-13.285 49.348 0 34.05 17.326 64.096 43.656 81.697a97.69 97.69 0 0 1-44.447-12.277c-.01.41-.01.82-.01 1.24 0 47.558 33.822 87.23 78.72 96.249a98.285 98.285 0 0 1-25.852 3.448 97.491 97.491 0 0 1-18.465-1.768c12.483 39.002 48.725 67.38 91.672 68.17-33.582 26.334-75.897 42.024-121.884 42.024-7.924 0-15.736-.46-23.408-1.37 43.434 27.844 95.014 44.104 150.443 44.104 180.505 0 279.221-149.576 279.221-279.294 0-4.263-.09-8.494-.278-12.708 19.178-13.835 35.813-31.115 48.967-50.807z" fill="#FFF"></path></svg></a><a href="http://localhost:8083/blog-vuepress/tencent:/AddContact/?fromId=50&amp;fromSubId=1&amp;subcmd=all&amp;uin=1138312802.html" rel="noopener noreferrer" target="_blank" aria-label="QQ" data-balloon-pos="up" class="media-link"><span class="sr-only">QQ</span> <svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon icon-qq"><circle cx="512" cy="512" r="512" fill="#5EAADE"></circle> <path d="M729.46 627.3c-3.157-39.628-24.045-83.747-32.624-105.91l-22.084-57.047c-.702-23.73 6.312-78.322-30.511-146.61s-110.82-74.446-124.497-75.147c-13.677-.701-99.248-1.403-141.331 72.945-42.084 74.347-30.745 148.812-30.745 148.812l-23.523 57.478c-.001.002-10.962 26.223-20.43 58.135-9.469 31.914-18.938 82.064-9.469 92.234 9.47 10.17 43.837-46.643 46.993-51.903 0 0 2.456 27.18 8.943 41.383l.81 1.776.33.723.38.826.3.652.444.96.203.436a281.465 281.465 0 0 0 1.917 4.025l.189.386c.231.473.468.953.711 1.442l.146.292c6.886 13.807 18.61 33.823 37.443 50.42l.018.016-1.184.387c-10.667 3.516-31.694 11.21-40.625 19.82-1.717 1.655-2.987 3.344-3.65 5.045-5.376 13.794 4.208 15.43 20.575 16.366 16.366.934 94.923 3.04 132.564-2.221.407-.056.787-.114 1.17-.171 2.711.094 5.324.142 7.83.16l.151.002c.836.005 1.663.008 2.475.008.496 0 1.015-.002 1.542-.006l.21-.001a222.593 222.593 0 0 0 5.462-.107c.26.038.508.076.778.114 37.642 5.26 116.198 3.156 132.564 2.22 16.366-.934 25.951-2.571 20.574-16.365-4.302-11.037-34.175-21.62-45.956-25.413a141.388 141.388 0 0 0 7.958-7.645l.237-.245a142.494 142.494 0 0 0 2.53-2.702c42.435-46.643 38.928-76.101 40.682-92.935 0 0 35.775 51.553 43.488 53.306 7.713 1.754 10.169-6.31 7.012-45.94z" fill="#FFF"></path></svg></a></div></div> <hr> <!----> <div class="content__sidebar-top"></div> <nav class="sidebar-nav-links"><div class="nav-item"><a href="/category/" class="nav-link"><i class="iconfont icon-note"></i>
  Category
</a></div><div class="nav-item"><a href="/project/" class="nav-link"><i class="iconfont icon-note"></i>
  My Project
</a></div><div class="nav-item"><a href="/guide/" class="nav-link"><i class="iconfont icon-creative"></i>
  Guide
</a></div><div class="nav-item"><a href="/about/" class="nav-link"><i class="iconfont icon-info"></i>
  About
</a></div> <a rel="noopener noreferrer" href="https://github.com/LifeAlsoIsGG" target="_blank" class="repo-link">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav> <!----> <div class="content__sidebar-center"></div> <ul class="sidebar-links"><li><a href="/study-line/" class="sidebar-link"><i class="iconfont icon-info"></i>学习路线</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading clickable"><!----> <span class="title">My Project</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading clickable"><!----> <span class="title">Interview</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading clickable"><i class="iconfont icon-code"></i> <span class="title">java</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading clickable"><!----> <span class="title">Golang</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading clickable open"><!----> <span class="title">Database</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/database/" aria-current="page" class="sidebar-link">数据库学习目录</a></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading clickable"><!----> <span class="title">Mysql</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading clickable open"><!----> <span class="title">Redis</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/database/redis/Redis_theory_note/" class="sidebar-link">Redis理论学习笔记</a></li><li><a href="/database/redis/Redis_deployment&amp;use/" aria-current="page" class="active sidebar-link">Redis部署与基本使用</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/database/redis/Redis_deployment&amp;use/#参考" class="sidebar-link">参考</a></li><li class="sidebar-sub-header"><a href="/database/redis/Redis_deployment&amp;use/#_1-redis安装" class="sidebar-link">1. Redis安装</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/database/redis/Redis_deployment&amp;use/#使用docker在linux下安装" class="sidebar-link heading3">使用Docker在Linux下安装</a></li><li class="sidebar-sub-header"><a href="/database/redis/Redis_deployment&amp;use/#以配置文件方式启动" class="sidebar-link heading3">以配置文件方式启动</a></li><li class="sidebar-sub-header"><a href="/database/redis/Redis_deployment&amp;use/#修改密码" class="sidebar-link heading3">修改密码</a></li><li class="sidebar-sub-header"><a href="/database/redis/Redis_deployment&amp;use/#使用redisdesktopmanager连接" class="sidebar-link heading3">使用RedisDesktopManager连接</a></li></ul></li><li class="sidebar-sub-header"><a href="/database/redis/Redis_deployment&amp;use/#_2-redis性能测试redis-benchmark" class="sidebar-link">2. Redis性能测试redis-benchmark</a></li><li class="sidebar-sub-header"><a href="/database/redis/Redis_deployment&amp;use/#_3-redis基本命令使用" class="sidebar-link">3. Redis基本命令使用</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/database/redis/Redis_deployment&amp;use/#查看redis系统状态" class="sidebar-link heading3">查看redis系统状态</a></li><li class="sidebar-sub-header"><a href="/database/redis/Redis_deployment&amp;use/#_3-1-数据库" class="sidebar-link heading3">3.1 数据库</a></li><li class="sidebar-sub-header"><a href="/database/redis/Redis_deployment&amp;use/#_3-2-键key" class="sidebar-link heading3">3.2 键Key</a></li><li class="sidebar-sub-header"><a href="/database/redis/Redis_deployment&amp;use/#_3-3-list" class="sidebar-link heading3">3.3 List</a></li><li class="sidebar-sub-header"><a href="/database/redis/Redis_deployment&amp;use/#_3-4-set" class="sidebar-link heading3">3.4 Set</a></li><li class="sidebar-sub-header"><a href="/database/redis/Redis_deployment&amp;use/#_3-5-hash" class="sidebar-link heading3">3.5 Hash</a></li><li class="sidebar-sub-header"><a href="/database/redis/Redis_deployment&amp;use/#_3-6-zset" class="sidebar-link heading3">3.6 ZSet</a></li><li class="sidebar-sub-header"><a href="/database/redis/Redis_deployment&amp;use/#_3-7-geospatial" class="sidebar-link heading3">3.7 Geospatial</a></li><li class="sidebar-sub-header"><a href="/database/redis/Redis_deployment&amp;use/#_3-8-hyperloglog" class="sidebar-link heading3">3.8 Hyperloglog</a></li><li class="sidebar-sub-header"><a href="/database/redis/Redis_deployment&amp;use/#_3-9-bitmap" class="sidebar-link heading3">3.9 Bitmap</a></li></ul></li><li class="sidebar-sub-header"><a href="/database/redis/Redis_deployment&amp;use/#_4-redis事务" class="sidebar-link">4. Redis事务</a></li><li class="sidebar-sub-header"><a href="/database/redis/Redis_deployment&amp;use/#_5-redis用监视器实现锁" class="sidebar-link">5. Redis用监视器实现锁</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/database/redis/Redis_deployment&amp;use/#原理" class="sidebar-link heading3">原理</a></li></ul></li><li class="sidebar-sub-header"><a href="/database/redis/Redis_deployment&amp;use/#_6-jedis操作redis" class="sidebar-link">6. Jedis操作Redis</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/database/redis/Redis_deployment&amp;use/#_6-1-测试连接" class="sidebar-link heading3">6.1 测试连接</a></li><li class="sidebar-sub-header"><a href="/database/redis/Redis_deployment&amp;use/#_6-2-hashtest" class="sidebar-link heading3">6.2 HashTest</a></li></ul></li><li class="sidebar-sub-header"><a href="/database/redis/Redis_deployment&amp;use/#_7-springboot整合redis" class="sidebar-link">7. SpringBoot整合Redis</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/database/redis/Redis_deployment&amp;use/#_7-1-导入依赖" class="sidebar-link heading3">7.1 导入依赖</a></li><li class="sidebar-sub-header"><a href="/database/redis/Redis_deployment&amp;use/#_7-2-application-yml配置" class="sidebar-link heading3">7.2 application.yml配置</a></li><li class="sidebar-sub-header"><a href="/database/redis/Redis_deployment&amp;use/#_7-3-简单使用示例" class="sidebar-link heading3">7.3 简单使用示例</a></li><li class="sidebar-sub-header"><a href="/database/redis/Redis_deployment&amp;use/#_7-4-序列化配置" class="sidebar-link heading3">7.4 序列化配置</a></li><li class="sidebar-sub-header"><a href="/database/redis/Redis_deployment&amp;use/#_7-5-配置redisconfig类" class="sidebar-link heading3">7.5 配置redisConfig类</a></li><li class="sidebar-sub-header"><a href="/database/redis/Redis_deployment&amp;use/#_7-6-封装常用api到redisutil" class="sidebar-link heading3">7.6 封装常用API到RedisUtil</a></li></ul></li><li class="sidebar-sub-header"><a href="/database/redis/Redis_deployment&amp;use/#_8-redis-conf详解" class="sidebar-link">8. redis.conf详解</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/database/redis/Redis_deployment&amp;use/#_8-1-存储单位说明" class="sidebar-link heading3">8.1 存储单位说明</a></li><li class="sidebar-sub-header"><a href="/database/redis/Redis_deployment&amp;use/#_8-2-网络配置" class="sidebar-link heading3">8.2 网络配置</a></li><li class="sidebar-sub-header"><a href="/database/redis/Redis_deployment&amp;use/#_8-3-基本配置" class="sidebar-link heading3">8.3 基本配置</a></li><li class="sidebar-sub-header"><a href="/database/redis/Redis_deployment&amp;use/#_8-4-快照配置" class="sidebar-link heading3">8.4 快照配置</a></li><li class="sidebar-sub-header"><a href="/database/redis/Redis_deployment&amp;use/#_8-5-主从复制相关" class="sidebar-link heading3">8.5 主从复制相关</a></li><li class="sidebar-sub-header"><a href="/database/redis/Redis_deployment&amp;use/#_8-6-安全配置" class="sidebar-link heading3">8.6 安全配置</a></li><li class="sidebar-sub-header"><a href="/database/redis/Redis_deployment&amp;use/#_8-7-客户端限制" class="sidebar-link heading3">8.7 客户端限制</a></li><li class="sidebar-sub-header"><a href="/database/redis/Redis_deployment&amp;use/#_8-8-内存容量配置" class="sidebar-link heading3">8.8 内存容量配置</a></li><li class="sidebar-sub-header"><a href="/database/redis/Redis_deployment&amp;use/#_8-9-aof配置" class="sidebar-link heading3">8.9 AOF配置</a></li></ul></li><li class="sidebar-sub-header"><a href="/database/redis/Redis_deployment&amp;use/#_9-redis持久化配置" class="sidebar-link">9. Redis持久化配置</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/database/redis/Redis_deployment&amp;use/#rdb-redis-database" class="sidebar-link heading3">RDB(Redis Database)</a></li></ul></li><li class="sidebar-sub-header"><a href="/database/redis/Redis_deployment&amp;use/#_10-redis发布订阅" class="sidebar-link">10. Redis发布订阅</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/database/redis/Redis_deployment&amp;use/#订阅端" class="sidebar-link heading3">订阅端</a></li><li class="sidebar-sub-header"><a href="/database/redis/Redis_deployment&amp;use/#发送端" class="sidebar-link heading3">发送端</a></li></ul></li><li class="sidebar-sub-header"><a href="/database/redis/Redis_deployment&amp;use/#_11-redis集群配置-主从复制配置" class="sidebar-link">11. Redis集群配置-主从复制配置</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/database/redis/Redis_deployment&amp;use/#_11-1-查看当前库信息" class="sidebar-link heading3">11.1 查看当前库信息</a></li><li class="sidebar-sub-header"><a href="/database/redis/Redis_deployment&amp;use/#_11-2-redis-conf配置" class="sidebar-link heading3">11.2 redis.conf配置</a></li><li class="sidebar-sub-header"><a href="/database/redis/Redis_deployment&amp;use/#_11-3-启动容器" class="sidebar-link heading3">11.3 启动容器</a></li><li class="sidebar-sub-header"><a href="/database/redis/Redis_deployment&amp;use/#_11-4-验证主写从读-主从宕机" class="sidebar-link heading3">11.4 验证主写从读/主从宕机</a></li><li class="sidebar-sub-header"><a href="/database/redis/Redis_deployment&amp;use/#_11-5-其他注意" class="sidebar-link heading3">11.5 其他注意</a></li></ul></li><li class="sidebar-sub-header"><a href="/database/redis/Redis_deployment&amp;use/#_12-redis集群配置-sentinel-哨兵-模式" class="sidebar-link">12. Redis集群配置-Sentinel（哨兵）模式</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/database/redis/Redis_deployment&amp;use/#_12-1-创建sentinel-conf" class="sidebar-link heading3">12.1 创建sentinel.conf</a></li><li class="sidebar-sub-header"><a href="/database/redis/Redis_deployment&amp;use/#_12-2-使用docker启动哨兵" class="sidebar-link heading3">12.2 使用Docker启动哨兵</a></li></ul></li><li class="sidebar-sub-header"><a href="/database/redis/Redis_deployment&amp;use/#_13-redis集群配置-集群cluster模式" class="sidebar-link">13. Redis集群配置-集群cluster模式</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/database/redis/Redis_deployment&amp;use/#_13-1-创建集群网络" class="sidebar-link heading3">13.1 创建集群网络</a></li><li class="sidebar-sub-header"><a href="/database/redis/Redis_deployment&amp;use/#_13-2-创建生成redis配置文件脚本" class="sidebar-link heading3">13.2 创建生成redis配置文件脚本</a></li><li class="sidebar-sub-header"><a href="/database/redis/Redis_deployment&amp;use/#_13-3-创建脚本通过docker运行" class="sidebar-link heading3">13.3 创建脚本通过docker运行</a></li><li class="sidebar-sub-header"><a href="/database/redis/Redis_deployment&amp;use/#_13-4-启动集群" class="sidebar-link heading3">13.4 启动集群</a></li><li class="sidebar-sub-header"><a href="/database/redis/Redis_deployment&amp;use/#_13-5-进入集群" class="sidebar-link heading3">13.5 进入集群</a></li><li class="sidebar-sub-header"><a href="/database/redis/Redis_deployment&amp;use/#_13-6-测试" class="sidebar-link heading3">13.6 测试</a></li><li class="sidebar-sub-header"><a href="/database/redis/Redis_deployment&amp;use/#_13-7-测试集群高可用" class="sidebar-link heading3">13.7 测试集群高可用</a></li><li class="sidebar-sub-header"><a href="/database/redis/Redis_deployment&amp;use/#_13-8-增加节点" class="sidebar-link heading3">13.8 增加节点</a></li><li class="sidebar-sub-header"><a href="/database/redis/Redis_deployment&amp;use/#_13-9-更换节点身份" class="sidebar-link heading3">13.9 更换节点身份</a></li><li class="sidebar-sub-header"><a href="/database/redis/Redis_deployment&amp;use/#_13-11-删除节点" class="sidebar-link heading3">13.11 删除节点</a></li><li class="sidebar-sub-header"><a href="/database/redis/Redis_deployment&amp;use/#_13-10-其他集群操作" class="sidebar-link heading3">13.10 其他集群操作</a></li></ul></li></ul></li><li><a href="/database/redis/Redis_scene/" class="sidebar-link">Redis应用场景</a></li></ul></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading clickable"><!----> <span class="title">Hadoop</span> <span class="arrow right"></span></p> <!----></section></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading clickable"><!----> <span class="title">Spring</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading clickable"><!----> <span class="title">Mybatis</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading clickable"><!----> <span class="title">DataStructure</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading clickable"><!----> <span class="title">Linux</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading clickable"><!----> <span class="title">ElasticSearch</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading clickable"><!----> <span class="title">Docker</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading clickable"><!----> <span class="title">Nginx</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading clickable"><!----> <span class="title">MessageQueue</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading clickable"><!----> <span class="title">Development</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading clickable"><!----> <span class="title">Computer Knowledge</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading clickable"><!----> <span class="title">ErrorNote</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading clickable"><!----> <span class="title">Git</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading clickable"><!----> <span class="title">Frontend</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading clickable"><!----> <span class="title">Guide</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/about/" class="sidebar-link"><i class="iconfont icon-info"></i>About</a></li></ul> <!----> <div class="content__sidebar-bottom"></div> <!----></aside> <main class="page"><nav class="breadcrumb"><ol vocab="https://schema.org/" typeof="BreadcrumbList"><li property="itemListElement" typeof="ListItem"><a href="/database/" property="item" typeof="WebPage" class="router-link-active"><!----> <span property="name">数据库学习目录</span></a> <meta property="position" content="1"></li><li property="itemListElement" typeof="ListItem" class="is-active"><a href="/database/redis/Redis_deployment&amp;use/" aria-current="page" property="item" typeof="WebPage" class="router-link-exact-active router-link-active"><!----> <span property="name">Redis部署与基本使用</span></a> <meta property="position" content="2"></li></ol></nav> <!----> <div class="content__page-top"></div> <div vocab="https://schema.org/" typeof="Article" class="page-title"><h1><!----> <span property="headline">Redis部署与基本使用</span></h1> <div class="page-info"><!----> <span aria-label="Author🖊" data-balloon-pos="down" categoryPath="/category/$category/" tagPath="/tag/$tag/"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon author-icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z" fill="currentColor"></path></svg> <span property="author">Draco</span></span><span aria-label="Page views🔢" data-balloon-pos="down" defaultAuthor="Draco" categoryPath="/category/$category/" tagPath="/tag/$tag/" class="visitor-info"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon eye-icon"><path d="M992 512.096c0-5.76-.992-10.592-1.28-11.136-.192-2.88-1.152-8.064-2.08-10.816-.256-.672-.544-1.376-.832-2.08-.48-1.568-1.024-3.104-1.6-4.32C897.664 290.112 707.104 160 512 160c-195.072 0-385.632 130.016-473.76 322.592-1.056 2.112-1.792 4.096-2.272 5.856a55.512 55.512 0 0 0-.64 1.6c-1.76 5.088-1.792 8.64-1.632 7.744-.832 3.744-1.568 11.168-1.568 11.168-.224 2.272-.224 4.032.032 6.304 0 0 .736 6.464 1.088 7.808.128 1.824.576 4.512 1.12 6.976h-.032c.448 2.08 1.12 4.096 1.984 6.08.48 1.536.992 2.976 1.472 4.032C126.432 733.856 316.992 864 512 864c195.136 0 385.696-130.048 473.216-321.696 1.376-2.496 2.24-4.832 2.848-6.912.256-.608.48-1.184.672-1.728 1.536-4.48 1.856-8.32 1.728-8.32l-.032.032c.608-3.104 1.568-7.744 1.568-13.28zM512 672c-88.224 0-160-71.776-160-160s71.776-160 160-160 160 71.776 160 160-71.776 160-160 160z" fill="currentColor"></path></svg> <span id="/database/redis/Redis_deployment&amp;use/" data-flag-title="Redis部署与基本使用" class="leancloud_visitors waline-visitor-count"><span class="leancloud-visitors-count">...</span></span></span><span aria-label="Writing Date📅" data-balloon-pos="down" defaultAuthor="Draco" categoryPath="/category/$category/" tagPath="/tag/$tag/" class="time-info"><svg viewBox="0 0 1030 1024" xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 0 1-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 0 1-33.473-33.473V143.657H180.6A134.314 134.314 0 0 0 46.66 277.595v535.756A134.314 134.314 0 0 0 180.6 947.289h669.74a134.36 134.36 0 0 0 133.94-133.938V277.595a134.314 134.314 0 0 0-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 0 1-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 0 1-33.472 33.473z" fill="currentColor"></path></svg> <span property="datePublished">2020-11-21 15:17:13</span></span><!----><span aria-label="Tags🏷" data-balloon-pos="down" defaultAuthor="Draco" categoryPath="/category/$category/"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon tag-icon"><path d="M939.902 458.563 910.17 144.567c-1.507-16.272-14.465-29.13-30.737-30.737L565.438 84.098h-.402c-3.215 0-5.726 1.005-7.634 2.913l-470.39 470.39a10.004 10.004 0 0 0 0 14.164l365.423 365.424c1.909 1.908 4.42 2.913 7.132 2.913s5.223-1.005 7.132-2.913l470.39-470.39c2.01-2.11 3.014-5.023 2.813-8.036zm-240.067-72.121c-35.458 0-64.286-28.828-64.286-64.286s28.828-64.285 64.286-64.285 64.286 28.828 64.286 64.285-28.829 64.286-64.286 64.286z" fill="currentColor"></path></svg> <ul class="tags-wrapper"><li class="tag clickable tag0"><span role="navigation">数据库</span></li><li class="tag clickable tag1"><span role="navigation">Redis</span></li></ul> <meta property="keywords" content="数据库,Redis"></span><span aria-label="Reading Time⌛" data-balloon-pos="down" defaultAuthor="Draco" categoryPath="/category/$category/" tagPath="/tag/$tag/" class="reading-time-info"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon timer-icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z" fill="currentColor"></path></svg> <span>About 47 min</span> <meta property="timeRequired" content="PT47M"></span></div> <!----> <hr></div> <div class="anchor-place-holder"><aside id="anchor"><div class="anchor-wrapper"><ul class="anchor-list"><li class="anchor"><a href="/database/redis/Redis_deployment&amp;use/#参考" class="anchor-link heading2"><div>参考</div></a></li><li class="anchor"><a href="/database/redis/Redis_deployment&amp;use/#_1-redis安装" class="anchor-link heading2"><div>1. Redis安装</div></a></li><li class="anchor"><a href="/database/redis/Redis_deployment&amp;use/#使用docker在linux下安装" class="anchor-link heading3"><div>使用Docker在Linux下安装</div></a></li><li class="anchor"><a href="/database/redis/Redis_deployment&amp;use/#以配置文件方式启动" class="anchor-link heading3"><div>以配置文件方式启动</div></a></li><li class="anchor"><a href="/database/redis/Redis_deployment&amp;use/#修改密码" class="anchor-link heading3"><div>修改密码</div></a></li><li class="anchor"><a href="/database/redis/Redis_deployment&amp;use/#使用redisdesktopmanager连接" class="anchor-link heading3"><div>使用RedisDesktopManager连接</div></a></li><li class="anchor"><a href="/database/redis/Redis_deployment&amp;use/#_2-redis性能测试redis-benchmark" class="anchor-link heading2"><div>2. Redis性能测试redis-benchmark</div></a></li><li class="anchor"><a href="/database/redis/Redis_deployment&amp;use/#_3-redis基本命令使用" class="anchor-link heading2"><div>3. Redis基本命令使用</div></a></li><li class="anchor"><a href="/database/redis/Redis_deployment&amp;use/#查看redis系统状态" class="anchor-link heading3"><div>查看redis系统状态</div></a></li><li class="anchor"><a href="/database/redis/Redis_deployment&amp;use/#_3-1-数据库" class="anchor-link heading3"><div>3.1 数据库</div></a></li><li class="anchor"><a href="/database/redis/Redis_deployment&amp;use/#_3-2-键key" class="anchor-link heading3"><div>3.2 键Key</div></a></li><li class="anchor"><a href="/database/redis/Redis_deployment&amp;use/#_3-3-list" class="anchor-link heading3"><div>3.3 List</div></a></li><li class="anchor"><a href="/database/redis/Redis_deployment&amp;use/#_3-4-set" class="anchor-link heading3"><div>3.4 Set</div></a></li><li class="anchor"><a href="/database/redis/Redis_deployment&amp;use/#_3-5-hash" class="anchor-link heading3"><div>3.5 Hash</div></a></li><li class="anchor"><a href="/database/redis/Redis_deployment&amp;use/#_3-6-zset" class="anchor-link heading3"><div>3.6 ZSet</div></a></li><li class="anchor"><a href="/database/redis/Redis_deployment&amp;use/#_3-7-geospatial" class="anchor-link heading3"><div>3.7 Geospatial</div></a></li><li class="anchor"><a href="/database/redis/Redis_deployment&amp;use/#_3-8-hyperloglog" class="anchor-link heading3"><div>3.8 Hyperloglog</div></a></li><li class="anchor"><a href="/database/redis/Redis_deployment&amp;use/#_3-9-bitmap" class="anchor-link heading3"><div>3.9 Bitmap</div></a></li><li class="anchor"><a href="/database/redis/Redis_deployment&amp;use/#_4-redis事务" class="anchor-link heading2"><div>4. Redis事务</div></a></li><li class="anchor"><a href="/database/redis/Redis_deployment&amp;use/#_5-redis用监视器实现锁" class="anchor-link heading2"><div>5. Redis用监视器实现锁</div></a></li><li class="anchor"><a href="/database/redis/Redis_deployment&amp;use/#原理" class="anchor-link heading3"><div>原理</div></a></li><li class="anchor"><a href="/database/redis/Redis_deployment&amp;use/#_6-jedis操作redis" class="anchor-link heading2"><div>6. Jedis操作Redis</div></a></li><li class="anchor"><a href="/database/redis/Redis_deployment&amp;use/#_6-1-测试连接" class="anchor-link heading3"><div>6.1 测试连接</div></a></li><li class="anchor"><a href="/database/redis/Redis_deployment&amp;use/#_6-2-hashtest" class="anchor-link heading3"><div>6.2 HashTest</div></a></li><li class="anchor"><a href="/database/redis/Redis_deployment&amp;use/#_7-springboot整合redis" class="anchor-link heading2"><div>7. SpringBoot整合Redis</div></a></li><li class="anchor"><a href="/database/redis/Redis_deployment&amp;use/#_7-1-导入依赖" class="anchor-link heading3"><div>7.1 导入依赖</div></a></li><li class="anchor"><a href="/database/redis/Redis_deployment&amp;use/#_7-2-application-yml配置" class="anchor-link heading3"><div>7.2 application.yml配置</div></a></li><li class="anchor"><a href="/database/redis/Redis_deployment&amp;use/#_7-3-简单使用示例" class="anchor-link heading3"><div>7.3 简单使用示例</div></a></li><li class="anchor"><a href="/database/redis/Redis_deployment&amp;use/#_7-4-序列化配置" class="anchor-link heading3"><div>7.4 序列化配置</div></a></li><li class="anchor"><a href="/database/redis/Redis_deployment&amp;use/#_7-5-配置redisconfig类" class="anchor-link heading3"><div>7.5 配置redisConfig类</div></a></li><li class="anchor"><a href="/database/redis/Redis_deployment&amp;use/#_7-6-封装常用api到redisutil" class="anchor-link heading3"><div>7.6 封装常用API到RedisUtil</div></a></li><li class="anchor"><a href="/database/redis/Redis_deployment&amp;use/#_8-redis-conf详解" class="anchor-link heading2"><div>8. redis.conf详解</div></a></li><li class="anchor"><a href="/database/redis/Redis_deployment&amp;use/#_8-1-存储单位说明" class="anchor-link heading3"><div>8.1 存储单位说明</div></a></li><li class="anchor"><a href="/database/redis/Redis_deployment&amp;use/#_8-2-网络配置" class="anchor-link heading3"><div>8.2 网络配置</div></a></li><li class="anchor"><a href="/database/redis/Redis_deployment&amp;use/#_8-3-基本配置" class="anchor-link heading3"><div>8.3 基本配置</div></a></li><li class="anchor"><a href="/database/redis/Redis_deployment&amp;use/#_8-4-快照配置" class="anchor-link heading3"><div>8.4 快照配置</div></a></li><li class="anchor"><a href="/database/redis/Redis_deployment&amp;use/#_8-5-主从复制相关" class="anchor-link heading3"><div>8.5 主从复制相关</div></a></li><li class="anchor"><a href="/database/redis/Redis_deployment&amp;use/#_8-6-安全配置" class="anchor-link heading3"><div>8.6 安全配置</div></a></li><li class="anchor"><a href="/database/redis/Redis_deployment&amp;use/#_8-7-客户端限制" class="anchor-link heading3"><div>8.7 客户端限制</div></a></li><li class="anchor"><a href="/database/redis/Redis_deployment&amp;use/#_8-8-内存容量配置" class="anchor-link heading3"><div>8.8 内存容量配置</div></a></li><li class="anchor"><a href="/database/redis/Redis_deployment&amp;use/#_8-9-aof配置" class="anchor-link heading3"><div>8.9 AOF配置</div></a></li><li class="anchor"><a href="/database/redis/Redis_deployment&amp;use/#_9-redis持久化配置" class="anchor-link heading2"><div>9. Redis持久化配置</div></a></li><li class="anchor"><a href="/database/redis/Redis_deployment&amp;use/#rdb-redis-database" class="anchor-link heading3"><div>RDB(Redis Database)</div></a></li><li class="anchor"><a href="/database/redis/Redis_deployment&amp;use/#_10-redis发布订阅" class="anchor-link heading2"><div>10. Redis发布订阅</div></a></li><li class="anchor"><a href="/database/redis/Redis_deployment&amp;use/#订阅端" class="anchor-link heading3"><div>订阅端</div></a></li><li class="anchor"><a href="/database/redis/Redis_deployment&amp;use/#发送端" class="anchor-link heading3"><div>发送端</div></a></li><li class="anchor"><a href="/database/redis/Redis_deployment&amp;use/#_11-redis集群配置-主从复制配置" class="anchor-link heading2"><div>11. Redis集群配置-主从复制配置</div></a></li><li class="anchor"><a href="/database/redis/Redis_deployment&amp;use/#_11-1-查看当前库信息" class="anchor-link heading3"><div>11.1 查看当前库信息</div></a></li><li class="anchor"><a href="/database/redis/Redis_deployment&amp;use/#_11-2-redis-conf配置" class="anchor-link heading3"><div>11.2 redis.conf配置</div></a></li><li class="anchor"><a href="/database/redis/Redis_deployment&amp;use/#_11-3-启动容器" class="anchor-link heading3"><div>11.3 启动容器</div></a></li><li class="anchor"><a href="/database/redis/Redis_deployment&amp;use/#_11-4-验证主写从读-主从宕机" class="anchor-link heading3"><div>11.4 验证主写从读/主从宕机</div></a></li><li class="anchor"><a href="/database/redis/Redis_deployment&amp;use/#_11-5-其他注意" class="anchor-link heading3"><div>11.5 其他注意</div></a></li><li class="anchor"><a href="/database/redis/Redis_deployment&amp;use/#_12-redis集群配置-sentinel-哨兵-模式" class="anchor-link heading2"><div>12. Redis集群配置-Sentinel（哨兵）模式</div></a></li><li class="anchor"><a href="/database/redis/Redis_deployment&amp;use/#_12-1-创建sentinel-conf" class="anchor-link heading3"><div>12.1 创建sentinel.conf</div></a></li><li class="anchor"><a href="/database/redis/Redis_deployment&amp;use/#_12-2-使用docker启动哨兵" class="anchor-link heading3"><div>12.2 使用Docker启动哨兵</div></a></li><li class="anchor"><a href="/database/redis/Redis_deployment&amp;use/#_13-redis集群配置-集群cluster模式" class="anchor-link heading2"><div>13. Redis集群配置-集群cluster模式</div></a></li><li class="anchor"><a href="/database/redis/Redis_deployment&amp;use/#_13-1-创建集群网络" class="anchor-link heading3"><div>13.1 创建集群网络</div></a></li><li class="anchor"><a href="/database/redis/Redis_deployment&amp;use/#_13-2-创建生成redis配置文件脚本" class="anchor-link heading3"><div>13.2 创建生成redis配置文件脚本</div></a></li><li class="anchor"><a href="/database/redis/Redis_deployment&amp;use/#_13-3-创建脚本通过docker运行" class="anchor-link heading3"><div>13.3 创建脚本通过docker运行</div></a></li><li class="anchor"><a href="/database/redis/Redis_deployment&amp;use/#_13-4-启动集群" class="anchor-link heading3"><div>13.4 启动集群</div></a></li><li class="anchor"><a href="/database/redis/Redis_deployment&amp;use/#_13-5-进入集群" class="anchor-link heading3"><div>13.5 进入集群</div></a></li><li class="anchor"><a href="/database/redis/Redis_deployment&amp;use/#_13-6-测试" class="anchor-link heading3"><div>13.6 测试</div></a></li><li class="anchor"><a href="/database/redis/Redis_deployment&amp;use/#_13-7-测试集群高可用" class="anchor-link heading3"><div>13.7 测试集群高可用</div></a></li><li class="anchor"><a href="/database/redis/Redis_deployment&amp;use/#_13-8-增加节点" class="anchor-link heading3"><div>13.8 增加节点</div></a></li><li class="anchor"><a href="/database/redis/Redis_deployment&amp;use/#_13-9-更换节点身份" class="anchor-link heading3"><div>13.9 更换节点身份</div></a></li><li class="anchor"><a href="/database/redis/Redis_deployment&amp;use/#_13-11-删除节点" class="anchor-link heading3"><div>13.11 删除节点</div></a></li><li class="anchor"><a href="/database/redis/Redis_deployment&amp;use/#_13-10-其他集群操作" class="anchor-link heading3"><div>13.10 其他集群操作</div></a></li></ul></div></aside></div> <!----> <div class="content__content-top"></div> <div class="theme-default-content content__default"><h2 id="参考"><a href="#参考" class="header-anchor">#</a> 参考</h2> <div class="custom-block tip"><p class="custom-block-title">Tips</p> <ul><li><a href="https://www.runoob.com/redis/redis-tutorial.html" target="_blank" rel="noopener noreferrer">菜鸟笔记Redis<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="http://doc.redisfans.com/" target="_blank" rel="noopener noreferrer">Redis 命令参考 — Redis 命令参考 (redisfans.com)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div> <h2 id="_1-redis安装"><a href="#_1-redis安装" class="header-anchor">#</a> 1. Redis安装</h2> <h3 id="使用docker在linux下安装"><a href="#使用docker在linux下安装" class="header-anchor">#</a> 使用Docker在Linux下安装</h3> <p>参考</p> <blockquote><ul><li>https://www.runoob.com/docker/docker-install-redis.html</li></ul></blockquote> <div class="custom-block warning"><p class="custom-block-title">Note</p> <p><code>redis.conf</code>中是否在后台开启的属性<code>daemonize</code>只能是<code>NO</code>，如果为<code>YES</code> 会的导致 redis 无法启动，因为后台会导致docker无任务可做而退出。</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>daemonize no
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></div> <h3 id="以配置文件方式启动"><a href="#以配置文件方式启动" class="header-anchor">#</a> 以配置文件方式启动</h3> <p>参考</p> <blockquote><ul><li>https://blog.csdn.net/weixin_42456466/article/details/87270959</li></ul></blockquote> <p>已配置文件方式启动redis容器</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token function">docker</span> run -p <span class="token number">6379</span>:6379 --name redis-6379 -v /usr/local/docker/redis/redis-6379.conf:/etc/redis/redis-6379.conf -v /usr/local/docker/redis/data:/data -d redis redis-server /etc/redis/redis-6379.conf
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>说明</p> <blockquote><ul><li>-p 6378:6379 ：<code>docker端口:本机端口</code>，意思为将容器内6379端口映射到本机器的6379端口</li> <li>--name redis01：容器 名字 为 redis01</li> <li>-v 映射指向，将本机/data/中<code>/data/docker_data/redis/conf/redis.conf</code>映射到容器中<code>/usr/local/etc/redis/redis.conf</code>文件，修改本机该文件即可同步如容器中的指定文件，这里避免了每次进入容器修改文件的繁琐操作</li> <li>-d 后台启动</li> <li>redis：镜像名称</li></ul></blockquote> <p>进入容器</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token function">docker</span> <span class="token builtin class-name">exec</span> -it redis-6379 /bin/bash
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>运行redis</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>redis-cli -p <span class="token number">6379</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="修改密码"><a href="#修改密码" class="header-anchor">#</a> 修改密码</h3> <p>参考</p> <blockquote><ul><li>https://www.cnblogs.com/x-ll123/p/9717351.html</li></ul></blockquote> <h3 id="使用redisdesktopmanager连接"><a href="#使用redisdesktopmanager连接" class="header-anchor">#</a> 使用RedisDesktopManager连接</h3> <p>下载RedisDesktopManager后直接连接即可</p> <p><img src="/assets/img/RedisDesktopManager.229ed63a.jpg" alt="" loading="lazy"></p> <p>连接后</p> <p><img src="/assets/img/RedisDesktopManager-2.86f71863.jpg" alt="" loading="lazy"></p> <h2 id="_2-redis性能测试redis-benchmark"><a href="#_2-redis性能测试redis-benchmark" class="header-anchor">#</a> 2. Redis性能测试redis-benchmark</h2> <p>参考</p> <blockquote><ul><li>https://www.runoob.com/redis/redis-benchmarks.html</li></ul></blockquote> <p><code>Docker</code>中的<code>redis-benchmark</code>测试命令</p> <p>参考</p> <blockquote><ul><li>https://blog.csdn.net/jianjun_fei/article/details/95108694</li></ul></blockquote> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">docker</span> <span class="token builtin class-name">exec</span> -it containerName/containerid redis-benchmark -h <span class="token number">127.0</span>.0.1 -p <span class="token number">6379</span> -c <span class="token number">100</span> -n <span class="token number">100000</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="/assets/img/redis-benchmark.c63de2ac.jpg" alt="" loading="lazy"></p> <h2 id="_3-redis基本命令使用"><a href="#_3-redis基本命令使用" class="header-anchor">#</a> 3. Redis基本命令使用</h2> <p>参考</p> <blockquote><ul><li><a href="https://redis.io/commands" target="_blank" rel="noopener noreferrer">官方命令文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="http://redisdoc.com/" target="_blank" rel="noopener noreferrer">redis中文文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="http://doc.redisfans.com/" target="_blank" rel="noopener noreferrer">Redis 命令参考 — Redis 命令参考 (redisfans.com)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://www.runoob.com/redis/redis-commands.html" target="_blank" rel="noopener noreferrer">菜鸟<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></blockquote> <h3 id="查看redis系统状态"><a href="#查看redis系统状态" class="header-anchor">#</a> 查看redis系统状态</h3> <div class="custom-block tip"><p class="custom-block-title">参考</p> <ul><li>https://www.cnblogs.com/wshenjin/p/11431378.html</li></ul></div> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token comment">#部分Redis系统状态统计信息。</span>
info
<span class="token comment">#全部Redis系统状态统计信息。</span>
info all
<span class="token comment">#某一块的系统状态统计信息，其中section可以忽略大小写。</span>
info section
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="_3-1-数据库"><a href="#_3-1-数据库" class="header-anchor">#</a> 3.1 数据库</h3> <p>切换数据库</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token keyword">select</span> <span class="token number">0</span>
<span class="token keyword">select</span> <span class="token number">1</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>数据库大小(key数量)</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>dbsize
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>清空当前数据库</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>flushdb

<span class="token comment">#清空所有</span>
flushall
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="_3-2-键key"><a href="#_3-2-键key" class="header-anchor">#</a> 3.2 键Key</h3> <p>参考</p> <blockquote><ul><li>https://www.runoob.com/redis/redis-keys.html</li></ul></blockquote> <h4 id="查看所有key"><a href="#查看所有key" class="header-anchor">#</a> 查看所有key</h4> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>keys *
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="设置过期时间"><a href="#设置过期时间" class="header-anchor">#</a> 设置过期时间</h4> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>expire <span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token punctuation">[</span>second<span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="查看剩余时间"><a href="#查看剩余时间" class="header-anchor">#</a> 查看剩余时间</h4> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>ttl <span class="token punctuation">[</span>key<span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>两种情况</p> <blockquote><ul><li>-1：未设置过期时间</li> <li>-2：已过期或不存在key</li></ul></blockquote> <h4 id="查看key对应的value类型"><a href="#查看key对应的value类型" class="header-anchor">#</a> 查看key对应的value类型</h4> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token builtin class-name">type</span> key
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="给某个key的value拼接"><a href="#给某个key的value拼接" class="header-anchor">#</a> 给某个key的value拼接</h4> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>append <span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token punctuation">[</span>value<span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="获取key对应value的长度"><a href="#获取key对应value的长度" class="header-anchor">#</a> 获取key对应value的长度</h4> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>strlen <span class="token punctuation">[</span>key<span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="根据range截取"><a href="#根据range截取" class="header-anchor">#</a> 根据range截取</h4> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment">#截取字符串[0,3]</span>
getrange <span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token number">0</span> <span class="token number">3</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h4 id="替换"><a href="#替换" class="header-anchor">#</a> 替换</h4> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment">#从0开始替换为value</span>
setrange <span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token number">0</span> <span class="token punctuation">[</span>value<span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h4 id="对于value为integer类型的操作"><a href="#对于value为integer类型的操作" class="header-anchor">#</a> 对于value为integer类型的操作</h4> <h5 id="自增长"><a href="#自增长" class="header-anchor">#</a> 自增长++</h5> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>incr <span class="token punctuation">[</span>key<span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h5 id="自减小"><a href="#自减小" class="header-anchor">#</a> 自减小--</h5> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>decr <span class="token punctuation">[</span>key<span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h5 id="指定增加大小"><a href="#指定增加大小" class="header-anchor">#</a> 指定增加大小</h5> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>incrby <span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token punctuation">[</span>number<span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h5 id="指定减小大小"><a href="#指定减小大小" class="header-anchor">#</a> 指定减小大小</h5> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>decrby <span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token punctuation">[</span>number<span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="_3-3-list"><a href="#_3-3-list" class="header-anchor">#</a> 3.3 List</h3> <p>参考</p> <blockquote><ul><li><a href="https://www.runoob.com/redis/redis-lists.html" target="_blank" rel="noopener noreferrer">Redis 列表(List) | 菜鸟教程 (runoob.com)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></blockquote> <h3 id="_3-4-set"><a href="#_3-4-set" class="header-anchor">#</a> 3.4 Set</h3> <p>参考</p> <blockquote><ul><li><a href="https://www.runoob.com/redis/redis-sets.html" target="_blank" rel="noopener noreferrer">Redis 集合(Set) | 菜鸟教程 (runoob.com)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></blockquote> <h3 id="_3-5-hash"><a href="#_3-5-hash" class="header-anchor">#</a> 3.5 Hash</h3> <p>参考</p> <blockquote><ul><li><a href="https://www.runoob.com/redis/redis-hashes.html" target="_blank" rel="noopener noreferrer">Redis 哈希(Hash) | 菜鸟教程 (runoob.com)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></blockquote> <h3 id="_3-6-zset"><a href="#_3-6-zset" class="header-anchor">#</a> 3.6 ZSet</h3> <p>参考</p> <blockquote><ul><li><a href="https://www.runoob.com/redis/redis-sorted-sets.html" target="_blank" rel="noopener noreferrer">Redis 有序集合(sorted set) | 菜鸟教程 (runoob.com)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></blockquote> <h3 id="_3-7-geospatial"><a href="#_3-7-geospatial" class="header-anchor">#</a> 3.7 Geospatial</h3> <p>地图经纬度，底层是用ZSet，可以使用ZSet的命令</p> <h3 id="_3-8-hyperloglog"><a href="#_3-8-hyperloglog" class="header-anchor">#</a> 3.8 Hyperloglog</h3> <p>基数</p> <h3 id="_3-9-bitmap"><a href="#_3-9-bitmap" class="header-anchor">#</a> 3.9 Bitmap</h3> <p>参考</p> <div class="custom-block tip"><p class="custom-block-title">参考</p> <ul><li><a href="https://blog.csdn.net/u011957758/article/details/74783347" target="_blank" rel="noopener noreferrer">一看就懂系列之 详解redis的bitmap在亿级项目中的应用<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>https://www.cnblogs.com/wuhaidong/articles/10389484.html</li></ul></div> <p>二进制，可用于打卡等状态变化</p> <h2 id="_4-redis事务"><a href="#_4-redis事务" class="header-anchor">#</a> 4. Redis事务</h2> <p>Redis 事务可以一次执行多个命令， 并且带有以下三个重要的保证：</p> <blockquote><ul><li>批量操作在发送 EXEC 命令前被放入队列缓存。</li> <li>收到 EXEC 命令后进入事务执行，事务中任意命令执行失败，其余的命令依然被执行。</li> <li>在事务执行过程，其他客户端提交的命令请求不会插入到事务执行命令序列中。</li></ul></blockquote> <p>一个事务从开始到执行会经历以下三个阶段：</p> <blockquote><ul><li>开始事务。</li> <li>命令入队。</li> <li>执行事务。</li></ul></blockquote> <p>以下是一个事务的例子， 它先以 <strong>MULTI</strong> 开始一个事务， 然后将多个命令入队到事务中， 最后由 <strong>EXEC</strong> 命令触发事务， 一并执行事务中的所有命令：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>redis <span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> MULTI
OK

redis <span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> SET book-name <span class="token string">&quot;Mastering C++ in 21 days&quot;</span>
QUEUED

redis <span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> GET book-name
QUEUED

redis <span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> SADD tag <span class="token string">&quot;C++&quot;</span> <span class="token string">&quot;Programming&quot;</span> <span class="token string">&quot;Mastering Series&quot;</span>
QUEUED

redis <span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> SMEMBERS tag
QUEUED

redis <span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> EXEC
<span class="token number">1</span><span class="token punctuation">)</span> OK
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">&quot;Mastering C++ in 21 days&quot;</span>
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">3</span>
<span class="token number">4</span><span class="token punctuation">)</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;Mastering Series&quot;</span>
   <span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">&quot;C++&quot;</span>
   <span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">&quot;Programming&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p>单个 Redis 命令的执行是原子性的，但 Redis 没有在事务上增加任何维持原子性的机制，所以 Redis 事务的执行并不是原子性的。</p> <p>事务可以理解为一个打包的批量执行脚本，但批量指令并非原子化的操作，中间某条指令的失败不会导致前面已做指令的回滚，也不会造成后续的指令不做。</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>redis <span class="token number">127.0</span>.0.1:700<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span> multi
OK
redis <span class="token number">127.0</span>.0.1:700<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span> <span class="token builtin class-name">set</span> a aaa
QUEUED
redis <span class="token number">127.0</span>.0.1:700<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span> <span class="token builtin class-name">set</span> b bbb
QUEUED
redis <span class="token number">127.0</span>.0.1:700<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span> <span class="token builtin class-name">set</span> c ccc
QUEUED
redis <span class="token number">127.0</span>.0.1:700<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span> <span class="token builtin class-name">exec</span>
<span class="token number">1</span><span class="token punctuation">)</span> OK
<span class="token number">2</span><span class="token punctuation">)</span> OK
<span class="token number">3</span><span class="token punctuation">)</span> OK
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>如果在 <code>set b bbb</code> 处失败，<code>set a</code> 已成功不会回滚，<code>set c</code> 还会继续执行。</p> <p>取消事务</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>discard
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="_5-redis用监视器实现锁"><a href="#_5-redis用监视器实现锁" class="header-anchor">#</a> 5. Redis用监视器实现锁</h2> <p>开启一个线程，开启监视器监视key<code>money</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> get money
<span class="token string">&quot;1080&quot;</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> <span class="token function">watch</span> money
OK
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> multi
OK
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> incrby money <span class="token number">100</span>
QUEUED


</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>在执行事务前修改前，用另一个线程修改<code>money</code>的值</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> get money
<span class="token string">&quot;1080&quot;</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> <span class="token builtin class-name">set</span> money <span class="token number">2000</span>
OK

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>此时再执行第一个线程的事务，redis发现监视的值<code>money</code>被更改，不会执行关于<code>money</code>的操作</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> <span class="token builtin class-name">exec</span>
<span class="token punctuation">(</span>nil<span class="token punctuation">)</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="原理"><a href="#原理" class="header-anchor">#</a> 原理</h3> <p>watch相当于实现了<code>乐观锁</code></p> <h2 id="_6-jedis操作redis"><a href="#_6-jedis操作redis" class="header-anchor">#</a> 6. Jedis操作Redis</h2> <p>导入包</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code>        <span class="token comment">&lt;!-- https://mvnrepository.com/artifact/redis.clients/jedis --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>redis.clients<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>jedis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.3.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>fastjson<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.2.70<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h3 id="_6-1-测试连接"><a href="#_6-1-测试连接" class="header-anchor">#</a> 6.1 测试连接</h3> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> pingTest <span class="token punctuation">{</span>
    
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Jedis</span> jedis <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Jedis</span><span class="token punctuation">(</span><span class="token string">&quot;127.0.0.1&quot;</span><span class="token punctuation">,</span> <span class="token number">6379</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//密码验证</span>
        jedis<span class="token punctuation">.</span><span class="token function">auth</span><span class="token punctuation">(</span><span class="token string">&quot;123456&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>jedis<span class="token punctuation">.</span><span class="token function">ping</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="_6-2-hashtest"><a href="#_6-2-hashtest" class="header-anchor">#</a> 6.2 HashTest</h3> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestHash</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Jedis</span> jedis <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Jedis</span><span class="token punctuation">(</span><span class="token string">&quot;47.100.59.153&quot;</span><span class="token punctuation">,</span> <span class="token number">6379</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        jedis<span class="token punctuation">.</span><span class="token function">auth</span><span class="token punctuation">(</span><span class="token string">&quot;0.00.0&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        jedis<span class="token punctuation">.</span><span class="token function">flushDB</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;key1&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;value1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;key2&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;value2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;key3&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;value3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;key4&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;value4&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//添加名称为hash（key）的hash元素</span>
        jedis<span class="token punctuation">.</span><span class="token function">hmset</span><span class="token punctuation">(</span><span class="token string">&quot;hash&quot;</span><span class="token punctuation">,</span>map<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//向名称为hash的hash中添加key为key5，value为value5元素</span>
        jedis<span class="token punctuation">.</span><span class="token function">hset</span><span class="token punctuation">(</span><span class="token string">&quot;hash&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;key5&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;value5&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;散列hash的所有键值对为：&quot;</span><span class="token operator">+</span>jedis<span class="token punctuation">.</span><span class="token function">hgetAll</span><span class="token punctuation">(</span><span class="token string">&quot;hash&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//return Map&lt;String,String&gt;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;散列hash的所有键为：&quot;</span><span class="token operator">+</span>jedis<span class="token punctuation">.</span><span class="token function">hkeys</span><span class="token punctuation">(</span><span class="token string">&quot;hash&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//return Set&lt;String&gt;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;散列hash的所有值为：&quot;</span><span class="token operator">+</span>jedis<span class="token punctuation">.</span><span class="token function">hvals</span><span class="token punctuation">(</span><span class="token string">&quot;hash&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//return List&lt;String&gt;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;将key6保存的值加上一个整数，如果key6不存在则添加key6：&quot;</span><span class="token operator">+</span>jedis<span class="token punctuation">.</span><span class="token function">hincrBy</span><span class="token punctuation">(</span><span class="token string">&quot;hash&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;key6&quot;</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;散列hash的所有键值对为：&quot;</span><span class="token operator">+</span>jedis<span class="token punctuation">.</span><span class="token function">hgetAll</span><span class="token punctuation">(</span><span class="token string">&quot;hash&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;将key6保存的值加上一个整数，如果key6不存在则添加key6：&quot;</span><span class="token operator">+</span>jedis<span class="token punctuation">.</span><span class="token function">hincrBy</span><span class="token punctuation">(</span><span class="token string">&quot;hash&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;key6&quot;</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;散列hash的所有键值对为：&quot;</span><span class="token operator">+</span>jedis<span class="token punctuation">.</span><span class="token function">hgetAll</span><span class="token punctuation">(</span><span class="token string">&quot;hash&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;删除一个或者多个键值对：&quot;</span><span class="token operator">+</span>jedis<span class="token punctuation">.</span><span class="token function">hdel</span><span class="token punctuation">(</span><span class="token string">&quot;hash&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;key2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;散列hash的所有键值对为：&quot;</span><span class="token operator">+</span>jedis<span class="token punctuation">.</span><span class="token function">hgetAll</span><span class="token punctuation">(</span><span class="token string">&quot;hash&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;散列hash中键值对的个数：&quot;</span><span class="token operator">+</span>jedis<span class="token punctuation">.</span><span class="token function">hlen</span><span class="token punctuation">(</span><span class="token string">&quot;hash&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;判断hash中是否存在key2：&quot;</span><span class="token operator">+</span>jedis<span class="token punctuation">.</span><span class="token function">hexists</span><span class="token punctuation">(</span><span class="token string">&quot;hash&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;key2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;判断hash中是否存在key3：&quot;</span><span class="token operator">+</span>jedis<span class="token punctuation">.</span><span class="token function">hexists</span><span class="token punctuation">(</span><span class="token string">&quot;hash&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;key3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;获取hash中的值：&quot;</span><span class="token operator">+</span>jedis<span class="token punctuation">.</span><span class="token function">hmget</span><span class="token punctuation">(</span><span class="token string">&quot;hash&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;key3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;获取hash中的值：&quot;</span><span class="token operator">+</span>jedis<span class="token punctuation">.</span><span class="token function">hmget</span><span class="token punctuation">(</span><span class="token string">&quot;hash&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;key3&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;key4&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><h2 id="_7-springboot整合redis"><a href="#_7-springboot整合redis" class="header-anchor">#</a> 7. SpringBoot整合Redis</h2> <p>原先底层使用的是<code>jedis</code>，在Spring2.x后改为<code>lettuce</code></p> <blockquote><ul><li>jedis：采用的直连,多个线程操作的话,是不安全的,如果想要避免不安全的,使用 <code>jedis pool</code>连接池!更像<code>BIO模式</code></li> <li>lettuce：采用<code>netty</code>，实例可以再多个线程中进行共享,不存在线程不安全的情况!可以减少线程数据了,更像<code>NIO模式</code></li></ul></blockquote> <h3 id="_7-1-导入依赖"><a href="#_7-1-导入依赖" class="header-anchor">#</a> 7.1 导入依赖</h3> <p><code>pom.xml</code></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token generics"><span class="token punctuation">&lt;</span>dependency<span class="token punctuation">&gt;</span></span>
  <span class="token generics"><span class="token punctuation">&lt;</span>groupId<span class="token punctuation">&gt;</span></span>org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">&gt;</span>
  <span class="token generics"><span class="token punctuation">&lt;</span>artifactId<span class="token punctuation">&gt;</span></span>spring<span class="token operator">-</span>boot<span class="token operator">-</span>starter<span class="token operator">-</span>data<span class="token operator">-</span>redis<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>dependency<span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="_7-2-application-yml配置"><a href="#_7-2-application-yml配置" class="header-anchor">#</a> 7.2 <code>application.yml</code>配置</h3> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code>  <span class="token comment">#reids相关配置</span>
  <span class="token key atrule">redis</span><span class="token punctuation">:</span>
    <span class="token comment">#redis服务器地址</span>
    <span class="token key atrule">host</span><span class="token punctuation">:</span> 47.100.59.153
    <span class="token comment">#redis服务器端口</span>
    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">6379</span>
    <span class="token key atrule">database</span><span class="token punctuation">:</span> <span class="token number">0</span>
    <span class="token comment">#密码</span>
    <span class="token key atrule">password</span><span class="token punctuation">:</span> 0.00.0
    <span class="token key atrule">lettuce</span><span class="token punctuation">:</span>
      <span class="token key atrule">pool</span><span class="token punctuation">:</span>
        <span class="token comment">#连接池最大连接数（使用负值表示没有限制）</span>
        <span class="token key atrule">max-active</span><span class="token punctuation">:</span> <span class="token number">1024</span>
        <span class="token comment">#连接池最大阻塞等待时间（使用负值表示没有限制）</span>
        <span class="token key atrule">max-wait</span><span class="token punctuation">:</span> 10000ms
        <span class="token comment">#连接池中最大空闲连接</span>
        <span class="token key atrule">max-idle</span><span class="token punctuation">:</span> <span class="token number">200</span>
        <span class="token comment">#连接池中最小空闲连接</span>
        <span class="token key atrule">min-idle</span><span class="token punctuation">:</span> <span class="token number">5</span>
    <span class="token comment"># 连接超时时间(毫秒)</span>
    <span class="token key atrule">timeout</span><span class="token punctuation">:</span> 10000ms
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><h3 id="_7-3-简单使用示例"><a href="#_7-3-简单使用示例" class="header-anchor">#</a> 7.3 简单使用示例</h3> <p><code>SpringbootDemoApplicationTests.java</code></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">RedisTemplate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> redisTemplate<span class="token punctuation">;</span>


    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">void</span> <span class="token function">redisTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;myKey&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;你好&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;myKey&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">/*获得数据库对象*/</span>
        <span class="token class-name">RedisConnection</span> conn <span class="token operator">=</span> redisTemplate<span class="token punctuation">.</span><span class="token function">getConnectionFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        conn<span class="token punctuation">.</span><span class="token function">flushDb</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h3 id="_7-4-序列化配置"><a href="#_7-4-序列化配置" class="header-anchor">#</a> 7.4 序列化配置</h3> <p><code>RedisAutoConfiguration.java</code></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span><span class="token punctuation">(</span>
  proxyBeanMethods <span class="token operator">=</span> <span class="token boolean">false</span>
<span class="token punctuation">)</span>
<span class="token annotation punctuation">@ConditionalOnClass</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token class-name">RedisOperations</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@EnableConfigurationProperties</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token class-name">RedisProperties</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Import</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token class-name">LettuceConnectionConfiguration</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">JedisConnectionConfiguration</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RedisAutoConfiguration</span> <span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token class-name">RedisAutoConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token punctuation">}</span>

  <span class="token annotation punctuation">@Bean</span>
  <span class="token annotation punctuation">@ConditionalOnMissingBean</span><span class="token punctuation">(</span>
    name <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&quot;redisTemplate&quot;</span><span class="token punctuation">}</span>
  <span class="token punctuation">)</span> <span class="token comment">//注解意思为当没有自定义redisTemplate使使用此bean，可以自定义来替换这个默认的</span>
  <span class="token keyword">public</span> <span class="token class-name">RedisTemplate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> <span class="token function">redisTemplate</span><span class="token punctuation">(</span><span class="token class-name">RedisConnectionFactory</span> redisConnectionFactory<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">UnknownHostException</span> <span class="token punctuation">{</span>
    <span class="token comment">// 默认的RedisTemplate没有过多地设置，redis对象都是需要序列化</span>
    <span class="token comment">// 两个泛型都是object object 的类型，我们后使用需要强制转换&lt;String, Object&gt;</span>
    <span class="token class-name">RedisTemplate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> template <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RedisTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    template<span class="token punctuation">.</span><span class="token function">setConnectionFactory</span><span class="token punctuation">(</span>redisConnectionFactory<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> template<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token annotation punctuation">@Bean</span>
  <span class="token annotation punctuation">@ConditionalOnMissingBean</span> <span class="token comment">//由于string是最常使用的bean，所以这里单独定义一个string的redisTemplate</span>
  <span class="token keyword">public</span> <span class="token class-name">StringRedisTemplate</span> <span class="token function">stringRedisTemplate</span><span class="token punctuation">(</span><span class="token class-name">RedisConnectionFactory</span> redisConnectionFactory<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">UnknownHostException</span> <span class="token punctuation">{</span>
    <span class="token class-name">StringRedisTemplate</span> template <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringRedisTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    template<span class="token punctuation">.</span><span class="token function">setConnectionFactory</span><span class="token punctuation">(</span>redisConnectionFactory<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> template<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><p><code>RedisTemplate.java</code></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Nullable</span>
<span class="token keyword">private</span> <span class="token class-name">RedisSerializer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> defaultSerializer<span class="token punctuation">;</span>
<span class="token annotation punctuation">@Nullable</span>
<span class="token keyword">private</span> <span class="token class-name">ClassLoader</span> classLoader<span class="token punctuation">;</span>
<span class="token annotation punctuation">@Nullable</span>
<span class="token keyword">private</span> <span class="token class-name">RedisSerializer</span> keySerializer <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token annotation punctuation">@Nullable</span>
<span class="token keyword">private</span> <span class="token class-name">RedisSerializer</span> valueSerializer <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token annotation punctuation">@Nullable</span>
<span class="token keyword">private</span> <span class="token class-name">RedisSerializer</span> hashKeySerializer <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token annotation punctuation">@Nullable</span>
<span class="token keyword">private</span> <span class="token class-name">RedisSerializer</span> hashValueSerializer <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>


<span class="token comment">//这里默认使用的是JDK的序列化，可以自定义一个配置类使用JSON序列化</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>defaultSerializer <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>defaultSerializer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JdkSerializationRedisSerializer</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>classLoader <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">?</span> <span class="token keyword">this</span><span class="token punctuation">.</span>classLoader <span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>当没有序列化对象直接传对象作为<code>value</code>时会报错误<code>SerializationException</code></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Autowired</span>
<span class="token keyword">private</span> <span class="token class-name">RedisTemplate</span> redisTemplate<span class="token punctuation">;</span>

<span class="token annotation punctuation">@Test</span>
<span class="token keyword">void</span> <span class="token function">redisTest_2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">JsonProcessingException</span> <span class="token punctuation">{</span>
  <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token class-name">User</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">uid</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">realName</span><span class="token punctuation">(</span><span class="token string">&quot;realName&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 当没有序列化对象时</span>
  <span class="token comment">// String jsonUser = new ObjectMapper().writeValueAsString(user);</span>
  redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;user1&quot;</span><span class="token punctuation">,</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;user1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p><img src="/assets/img/SerializationException.36eb0b68.jpg" alt="" loading="lazy"></p> <h3 id="_7-5-配置redisconfig类"><a href="#_7-5-配置redisconfig类" class="header-anchor">#</a> 7.5 配置redisConfig类</h3> <p><code>redisConfig.java</code></p> <p>用于替换在<code>RedisAutoConfiguration</code>默认的<code>RedisTemplate</code></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RedisConfig</span> <span class="token punctuation">{</span>

    <span class="token comment">/*自定义RedisTemplate*/</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">RedisTemplate</span> <span class="token function">redisTemplate</span><span class="token punctuation">(</span><span class="token class-name">RedisConnectionFactory</span> factory<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">RedisTemplate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> redisTemplate <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RedisTemplate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        redisTemplate<span class="token punctuation">.</span><span class="token function">setConnectionFactory</span><span class="token punctuation">(</span>factory<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 使用Jackson2JsonRedisSerialize 替换默认序列化</span>
        <span class="token class-name">Jackson2JsonRedisSerializer</span> jackson2JsonRedisSerializer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Jackson2JsonRedisSerializer</span><span class="token punctuation">(</span><span class="token class-name">Object</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">ObjectMapper</span> objectMapper <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectMapper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        objectMapper<span class="token punctuation">.</span><span class="token function">setVisibility</span><span class="token punctuation">(</span><span class="token class-name">PropertyAccessor</span><span class="token punctuation">.</span>ALL<span class="token punctuation">,</span> <span class="token class-name">JsonAutoDetect<span class="token punctuation">.</span>Visibility</span><span class="token punctuation">.</span>ANY<span class="token punctuation">)</span><span class="token punctuation">;</span>
        objectMapper<span class="token punctuation">.</span><span class="token function">enableDefaultTyping</span><span class="token punctuation">(</span><span class="token class-name">ObjectMapper<span class="token punctuation">.</span>DefaultTyping</span><span class="token punctuation">.</span>NON_FINAL<span class="token punctuation">)</span><span class="token punctuation">;</span>
        jackson2JsonRedisSerializer<span class="token punctuation">.</span><span class="token function">setObjectMapper</span><span class="token punctuation">(</span>objectMapper<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 设置value的序列化规则和 key的序列化规则</span>
        <span class="token class-name">StringRedisSerializer</span> stringRedisSerializer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringRedisSerializer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// key采用String的序列化方式</span>
        redisTemplate<span class="token punctuation">.</span><span class="token function">setKeySerializer</span><span class="token punctuation">(</span>stringRedisSerializer<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// hash的key也采用String的序列化方式</span>
        redisTemplate<span class="token punctuation">.</span><span class="token function">setHashKeySerializer</span><span class="token punctuation">(</span>stringRedisSerializer<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// value序列化方式采用jackson</span>
        redisTemplate<span class="token punctuation">.</span><span class="token function">setValueSerializer</span><span class="token punctuation">(</span>jackson2JsonRedisSerializer<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// hash的value也采用jackson</span>
        redisTemplate<span class="token punctuation">.</span><span class="token function">setHashValueSerializer</span><span class="token punctuation">(</span>jackson2JsonRedisSerializer<span class="token punctuation">)</span><span class="token punctuation">;</span>

        redisTemplate<span class="token punctuation">.</span><span class="token function">afterPropertiesSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> redisTemplate<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><p>存储一个对象</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">void</span> <span class="token function">redisTest_2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">JsonProcessingException</span> <span class="token punctuation">{</span>
  <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token class-name">User</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">uid</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">realName</span><span class="token punctuation">(</span><span class="token string">&quot;realName&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;user5&quot;</span><span class="token punctuation">,</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;user5&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>存储在redis中的是已经序列化的字符串</p> <p><img src="/assets/img/after_serializationException.9b561e53.jpg" alt="存储在Redis中序列化的User" loading="lazy"></p> <p>取出来后会经过反序列化</p> <p><img src="/assets/img/after_serializationException_2.2acf610f.jpg" alt="取出User并反序列化" loading="lazy"></p> <h3 id="_7-6-封装常用api到redisutil"><a href="#_7-6-封装常用api到redisutil" class="header-anchor">#</a> 7.6 封装常用API到<code>RedisUtil</code></h3> <details class="custom-block details"><summary>RedisUtil.java</summary> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>lifeisgg<span class="token punctuation">.</span>springboot_demo<span class="token punctuation">.</span>util</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>redis<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">RedisTemplate</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">CollectionUtils</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Map</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Set</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">TimeUnit</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * @Project: springboot_demo
 * @Package: com.lifeisgg.springboot_demo.util
 * @ClassName: RedisUtil
 * @Author: Chen Long
 * @Description:
 * @Datetime: 2020/12/1  20:32
 */</span>
<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">RedisUtil</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">RedisTemplate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> redisTemplate<span class="token punctuation">;</span>

    <span class="token comment">// =============================common============================</span>
    <span class="token comment">/**
     * 指定缓存失效时间
     * @param key  键
     * @param time 时间(秒)
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">expire</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">,</span> <span class="token keyword">long</span> time<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>time <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                redisTemplate<span class="token punctuation">.</span><span class="token function">expire</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> time<span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 根据key 获取过期时间
     * @param key 键 不能为null
     * @return 时间(秒) 返回0代表为永久有效
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">long</span> <span class="token function">getExpire</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> redisTemplate<span class="token punctuation">.</span><span class="token function">getExpire</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


    <span class="token comment">/**
     * 判断key是否存在
     * @param key 键
     * @return true 存在 false不存在
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">hasKey</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> redisTemplate<span class="token punctuation">.</span><span class="token function">hasKey</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>


    <span class="token comment">/**
     * 删除缓存
     * @param key 可以传一个值 或多个
     */</span>
    <span class="token annotation punctuation">@SuppressWarnings</span><span class="token punctuation">(</span><span class="token string">&quot;unchecked&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">del</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> key<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>key <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> key<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>key<span class="token punctuation">.</span>length <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                redisTemplate<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>key<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                redisTemplate<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token class-name">CollectionUtils</span><span class="token punctuation">.</span><span class="token function">arrayToList</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>


    <span class="token comment">// ============================String=============================</span>

    <span class="token comment">/**
     * 普通缓存获取
     * @param key 键
     * @return 值
     */</span>
    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> key <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">?</span> <span class="token keyword">null</span> <span class="token operator">:</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 普通缓存放入
     * @param key   键
     * @param value 值
     * @return true成功 false失败
     */</span>

    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">set</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">,</span> <span class="token class-name">Object</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>


    <span class="token comment">/**
     * 普通缓存放入并设置时间
     * @param key   键
     * @param value 值
     * @param time  时间(秒) time要大于0 如果time小于等于0 将设置无限期
     * @return true成功 false 失败
     */</span>

    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">set</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">,</span> <span class="token class-name">Object</span> value<span class="token punctuation">,</span> <span class="token keyword">long</span> time<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>time <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> time<span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token function">set</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>


    <span class="token comment">/**
     * 递增
     * @param key   键
     * @param delta 要增加几(大于0)
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">long</span> <span class="token function">incr</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">,</span> <span class="token keyword">long</span> delta<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>delta <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">&quot;递增因子必须大于0&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">increment</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> delta<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


    <span class="token comment">/**
     * 递减
     * @param key   键
     * @param delta 要减少几(小于0)
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">long</span> <span class="token function">decr</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">,</span> <span class="token keyword">long</span> delta<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>delta <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">&quot;递减因子必须大于0&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">increment</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> <span class="token operator">-</span>delta<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


    <span class="token comment">// ================================Map=================================</span>

    <span class="token comment">/**
     * HashGet
     * @param key  键 不能为null
     * @param item 项 不能为null
     */</span>
    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">hget</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">,</span> <span class="token class-name">String</span> item<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForHash</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> item<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 获取hashKey对应的所有键值
     * @param key 键
     * @return 对应的多个键值
     */</span>
    <span class="token keyword">public</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> <span class="token function">hmget</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForHash</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">entries</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * HashSet
     * @param key 键
     * @param map 对应多个键值
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">hmset</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">,</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> map<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            redisTemplate<span class="token punctuation">.</span><span class="token function">opsForHash</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">putAll</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> map<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>


    <span class="token comment">/**
     * HashSet 并设置时间
     * @param key  键
     * @param map  对应多个键值
     * @param time 时间(秒)
     * @return true成功 false失败
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">hmset</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">,</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> map<span class="token punctuation">,</span> <span class="token keyword">long</span> time<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            redisTemplate<span class="token punctuation">.</span><span class="token function">opsForHash</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">putAll</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> map<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>time <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">expire</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> time<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>


    <span class="token comment">/**
     * 向一张hash表中放入数据,如果不存在将创建
     *
     * @param key   键
     * @param item  项
     * @param value 值
     * @return true 成功 false失败
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">hset</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">,</span> <span class="token class-name">String</span> item<span class="token punctuation">,</span> <span class="token class-name">Object</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            redisTemplate<span class="token punctuation">.</span><span class="token function">opsForHash</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> item<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 向一张hash表中放入数据,如果不存在将创建
     *
     * @param key   键
     * @param item  项
     * @param value 值
     * @param time  时间(秒) 注意:如果已存在的hash表有时间,这里将会替换原有的时间
     * @return true 成功 false失败
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">hset</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">,</span> <span class="token class-name">String</span> item<span class="token punctuation">,</span> <span class="token class-name">Object</span> value<span class="token punctuation">,</span> <span class="token keyword">long</span> time<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            redisTemplate<span class="token punctuation">.</span><span class="token function">opsForHash</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> item<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>time <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">expire</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> time<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>


    <span class="token comment">/**
     * 删除hash表中的值
     *
     * @param key  键 不能为null
     * @param item 项 可以使多个 不能为null
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">hdel</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> item<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        redisTemplate<span class="token punctuation">.</span><span class="token function">opsForHash</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> item<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


    <span class="token comment">/**
     * 判断hash表中是否有该项的值
     *
     * @param key  键 不能为null
     * @param item 项 不能为null
     * @return true 存在 false不存在
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">hHasKey</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">,</span> <span class="token class-name">String</span> item<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForHash</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">hasKey</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> item<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


    <span class="token comment">/**
     * hash递增 如果不存在,就会创建一个 并把新增后的值返回
     *
     * @param key  键
     * @param item 项
     * @param by   要增加几(大于0)
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">double</span> <span class="token function">hincr</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">,</span> <span class="token class-name">String</span> item<span class="token punctuation">,</span> <span class="token keyword">double</span> by<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForHash</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">increment</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> item<span class="token punctuation">,</span> by<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


    <span class="token comment">/**
     * hash递减
     *
     * @param key  键
     * @param item 项
     * @param by   要减少记(小于0)
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">double</span> <span class="token function">hdecr</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">,</span> <span class="token class-name">String</span> item<span class="token punctuation">,</span> <span class="token keyword">double</span> by<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForHash</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">increment</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> item<span class="token punctuation">,</span> <span class="token operator">-</span>by<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


    <span class="token comment">// ============================set=============================</span>

    <span class="token comment">/**
     * 根据key获取Set中的所有值
     * @param key 键
     */</span>
    <span class="token keyword">public</span> <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> <span class="token function">sGet</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">members</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>


    <span class="token comment">/**
     * 根据value从一个set中查询,是否存在
     *
     * @param key   键
     * @param value 值
     * @return true 存在 false不存在
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">sHasKey</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">,</span> <span class="token class-name">Object</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isMember</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>


    <span class="token comment">/**
     * 将数据放入set缓存
     *
     * @param key    键
     * @param values 值 可以是多个
     * @return 成功个数
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">long</span> <span class="token function">sSet</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> values<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> values<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>


    <span class="token comment">/**
     * 将set数据放入缓存
     *
     * @param key    键
     * @param time   时间(秒)
     * @param values 值 可以是多个
     * @return 成功个数
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">long</span> <span class="token function">sSetAndTime</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">,</span> <span class="token keyword">long</span> time<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> values<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">Long</span> count <span class="token operator">=</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> values<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>time <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
                <span class="token function">expire</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> time<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> count<span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>


    <span class="token comment">/**
     * 获取set缓存的长度
     *
     * @param key 键
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">long</span> <span class="token function">sGetSetSize</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>


    <span class="token comment">/**
     * 移除值为value的
     *
     * @param key    键
     * @param values 值 可以是多个
     * @return 移除的个数
     */</span>

    <span class="token keyword">public</span> <span class="token keyword">long</span> <span class="token function">setRemove</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> values<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">Long</span> count <span class="token operator">=</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> values<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> count<span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// ===============================list=================================</span>

    <span class="token comment">/**
     * 获取list缓存的内容
     *
     * @param key   键
     * @param start 开始
     * @param end   结束 0 到 -1代表所有值
     */</span>
    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> <span class="token function">lGet</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">,</span> <span class="token keyword">long</span> start<span class="token punctuation">,</span> <span class="token keyword">long</span> end<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">range</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> start<span class="token punctuation">,</span> end<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>


    <span class="token comment">/**
     * 获取list缓存的长度
     *
     * @param key 键
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">long</span> <span class="token function">lGetListSize</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>


    <span class="token comment">/**
     * 通过索引 获取list中的值
     *
     * @param key   键
     * @param index 索引 index&gt;=0时， 0 表头，1 第二个元素，依次类推；index&lt;0时，-1，表尾，-2倒数第二个元素，依次类推
     */</span>
    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">lGetIndex</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">,</span> <span class="token keyword">long</span> index<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">index</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> index<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>


    <span class="token comment">/**
     * 将list放入缓存
     *
     * @param key   键
     * @param value 值
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">lSet</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">,</span> <span class="token class-name">Object</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            redisTemplate<span class="token punctuation">.</span><span class="token function">opsForList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">rightPush</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>


    <span class="token comment">/**
     * 将list放入缓存
     * @param key   键
     * @param value 值
     * @param time  时间(秒)
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">lSet</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">,</span> <span class="token class-name">Object</span> value<span class="token punctuation">,</span> <span class="token keyword">long</span> time<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            redisTemplate<span class="token punctuation">.</span><span class="token function">opsForList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">rightPush</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>time <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
                <span class="token function">expire</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> time<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>


    <span class="token comment">/**
     * 将list放入缓存
     *
     * @param key   键
     * @param value 值
     * @return
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">lSet</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            redisTemplate<span class="token punctuation">.</span><span class="token function">opsForList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">rightPushAll</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>


    <span class="token comment">/**
     * 将list放入缓存
     *
     * @param key   键
     * @param value 值
     * @param time  时间(秒)
     * @return
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">lSet</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> value<span class="token punctuation">,</span> <span class="token keyword">long</span> time<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            redisTemplate<span class="token punctuation">.</span><span class="token function">opsForList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">rightPushAll</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>time <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
                <span class="token function">expire</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> time<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>


    <span class="token comment">/**
     * 根据索引修改list中的某条数据
     *
     * @param key   键
     * @param index 索引
     * @param value 值
     * @return
     */</span>

    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">lUpdateIndex</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">,</span> <span class="token keyword">long</span> index<span class="token punctuation">,</span> <span class="token class-name">Object</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            redisTemplate<span class="token punctuation">.</span><span class="token function">opsForList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> index<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>


    <span class="token comment">/**
     * 移除N个值为value
     *
     * @param key   键
     * @param count 移除多少个
     * @param value 值
     * @return 移除的个数
     */</span>

    <span class="token keyword">public</span> <span class="token keyword">long</span> <span class="token function">lRemove</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">,</span> <span class="token keyword">long</span> count<span class="token punctuation">,</span> <span class="token class-name">Object</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">Long</span> remove <span class="token operator">=</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> count<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> remove<span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br><span class="line-number">162</span><br><span class="line-number">163</span><br><span class="line-number">164</span><br><span class="line-number">165</span><br><span class="line-number">166</span><br><span class="line-number">167</span><br><span class="line-number">168</span><br><span class="line-number">169</span><br><span class="line-number">170</span><br><span class="line-number">171</span><br><span class="line-number">172</span><br><span class="line-number">173</span><br><span class="line-number">174</span><br><span class="line-number">175</span><br><span class="line-number">176</span><br><span class="line-number">177</span><br><span class="line-number">178</span><br><span class="line-number">179</span><br><span class="line-number">180</span><br><span class="line-number">181</span><br><span class="line-number">182</span><br><span class="line-number">183</span><br><span class="line-number">184</span><br><span class="line-number">185</span><br><span class="line-number">186</span><br><span class="line-number">187</span><br><span class="line-number">188</span><br><span class="line-number">189</span><br><span class="line-number">190</span><br><span class="line-number">191</span><br><span class="line-number">192</span><br><span class="line-number">193</span><br><span class="line-number">194</span><br><span class="line-number">195</span><br><span class="line-number">196</span><br><span class="line-number">197</span><br><span class="line-number">198</span><br><span class="line-number">199</span><br><span class="line-number">200</span><br><span class="line-number">201</span><br><span class="line-number">202</span><br><span class="line-number">203</span><br><span class="line-number">204</span><br><span class="line-number">205</span><br><span class="line-number">206</span><br><span class="line-number">207</span><br><span class="line-number">208</span><br><span class="line-number">209</span><br><span class="line-number">210</span><br><span class="line-number">211</span><br><span class="line-number">212</span><br><span class="line-number">213</span><br><span class="line-number">214</span><br><span class="line-number">215</span><br><span class="line-number">216</span><br><span class="line-number">217</span><br><span class="line-number">218</span><br><span class="line-number">219</span><br><span class="line-number">220</span><br><span class="line-number">221</span><br><span class="line-number">222</span><br><span class="line-number">223</span><br><span class="line-number">224</span><br><span class="line-number">225</span><br><span class="line-number">226</span><br><span class="line-number">227</span><br><span class="line-number">228</span><br><span class="line-number">229</span><br><span class="line-number">230</span><br><span class="line-number">231</span><br><span class="line-number">232</span><br><span class="line-number">233</span><br><span class="line-number">234</span><br><span class="line-number">235</span><br><span class="line-number">236</span><br><span class="line-number">237</span><br><span class="line-number">238</span><br><span class="line-number">239</span><br><span class="line-number">240</span><br><span class="line-number">241</span><br><span class="line-number">242</span><br><span class="line-number">243</span><br><span class="line-number">244</span><br><span class="line-number">245</span><br><span class="line-number">246</span><br><span class="line-number">247</span><br><span class="line-number">248</span><br><span class="line-number">249</span><br><span class="line-number">250</span><br><span class="line-number">251</span><br><span class="line-number">252</span><br><span class="line-number">253</span><br><span class="line-number">254</span><br><span class="line-number">255</span><br><span class="line-number">256</span><br><span class="line-number">257</span><br><span class="line-number">258</span><br><span class="line-number">259</span><br><span class="line-number">260</span><br><span class="line-number">261</span><br><span class="line-number">262</span><br><span class="line-number">263</span><br><span class="line-number">264</span><br><span class="line-number">265</span><br><span class="line-number">266</span><br><span class="line-number">267</span><br><span class="line-number">268</span><br><span class="line-number">269</span><br><span class="line-number">270</span><br><span class="line-number">271</span><br><span class="line-number">272</span><br><span class="line-number">273</span><br><span class="line-number">274</span><br><span class="line-number">275</span><br><span class="line-number">276</span><br><span class="line-number">277</span><br><span class="line-number">278</span><br><span class="line-number">279</span><br><span class="line-number">280</span><br><span class="line-number">281</span><br><span class="line-number">282</span><br><span class="line-number">283</span><br><span class="line-number">284</span><br><span class="line-number">285</span><br><span class="line-number">286</span><br><span class="line-number">287</span><br><span class="line-number">288</span><br><span class="line-number">289</span><br><span class="line-number">290</span><br><span class="line-number">291</span><br><span class="line-number">292</span><br><span class="line-number">293</span><br><span class="line-number">294</span><br><span class="line-number">295</span><br><span class="line-number">296</span><br><span class="line-number">297</span><br><span class="line-number">298</span><br><span class="line-number">299</span><br><span class="line-number">300</span><br><span class="line-number">301</span><br><span class="line-number">302</span><br><span class="line-number">303</span><br><span class="line-number">304</span><br><span class="line-number">305</span><br><span class="line-number">306</span><br><span class="line-number">307</span><br><span class="line-number">308</span><br><span class="line-number">309</span><br><span class="line-number">310</span><br><span class="line-number">311</span><br><span class="line-number">312</span><br><span class="line-number">313</span><br><span class="line-number">314</span><br><span class="line-number">315</span><br><span class="line-number">316</span><br><span class="line-number">317</span><br><span class="line-number">318</span><br><span class="line-number">319</span><br><span class="line-number">320</span><br><span class="line-number">321</span><br><span class="line-number">322</span><br><span class="line-number">323</span><br><span class="line-number">324</span><br><span class="line-number">325</span><br><span class="line-number">326</span><br><span class="line-number">327</span><br><span class="line-number">328</span><br><span class="line-number">329</span><br><span class="line-number">330</span><br><span class="line-number">331</span><br><span class="line-number">332</span><br><span class="line-number">333</span><br><span class="line-number">334</span><br><span class="line-number">335</span><br><span class="line-number">336</span><br><span class="line-number">337</span><br><span class="line-number">338</span><br><span class="line-number">339</span><br><span class="line-number">340</span><br><span class="line-number">341</span><br><span class="line-number">342</span><br><span class="line-number">343</span><br><span class="line-number">344</span><br><span class="line-number">345</span><br><span class="line-number">346</span><br><span class="line-number">347</span><br><span class="line-number">348</span><br><span class="line-number">349</span><br><span class="line-number">350</span><br><span class="line-number">351</span><br><span class="line-number">352</span><br><span class="line-number">353</span><br><span class="line-number">354</span><br><span class="line-number">355</span><br><span class="line-number">356</span><br><span class="line-number">357</span><br><span class="line-number">358</span><br><span class="line-number">359</span><br><span class="line-number">360</span><br><span class="line-number">361</span><br><span class="line-number">362</span><br><span class="line-number">363</span><br><span class="line-number">364</span><br><span class="line-number">365</span><br><span class="line-number">366</span><br><span class="line-number">367</span><br><span class="line-number">368</span><br><span class="line-number">369</span><br><span class="line-number">370</span><br><span class="line-number">371</span><br><span class="line-number">372</span><br><span class="line-number">373</span><br><span class="line-number">374</span><br><span class="line-number">375</span><br><span class="line-number">376</span><br><span class="line-number">377</span><br><span class="line-number">378</span><br><span class="line-number">379</span><br><span class="line-number">380</span><br><span class="line-number">381</span><br><span class="line-number">382</span><br><span class="line-number">383</span><br><span class="line-number">384</span><br><span class="line-number">385</span><br><span class="line-number">386</span><br><span class="line-number">387</span><br><span class="line-number">388</span><br><span class="line-number">389</span><br><span class="line-number">390</span><br><span class="line-number">391</span><br><span class="line-number">392</span><br><span class="line-number">393</span><br><span class="line-number">394</span><br><span class="line-number">395</span><br><span class="line-number">396</span><br><span class="line-number">397</span><br><span class="line-number">398</span><br><span class="line-number">399</span><br><span class="line-number">400</span><br><span class="line-number">401</span><br><span class="line-number">402</span><br><span class="line-number">403</span><br><span class="line-number">404</span><br><span class="line-number">405</span><br><span class="line-number">406</span><br><span class="line-number">407</span><br><span class="line-number">408</span><br><span class="line-number">409</span><br><span class="line-number">410</span><br><span class="line-number">411</span><br><span class="line-number">412</span><br><span class="line-number">413</span><br><span class="line-number">414</span><br><span class="line-number">415</span><br><span class="line-number">416</span><br><span class="line-number">417</span><br><span class="line-number">418</span><br><span class="line-number">419</span><br><span class="line-number">420</span><br><span class="line-number">421</span><br><span class="line-number">422</span><br><span class="line-number">423</span><br><span class="line-number">424</span><br><span class="line-number">425</span><br><span class="line-number">426</span><br><span class="line-number">427</span><br><span class="line-number">428</span><br><span class="line-number">429</span><br><span class="line-number">430</span><br><span class="line-number">431</span><br><span class="line-number">432</span><br><span class="line-number">433</span><br><span class="line-number">434</span><br><span class="line-number">435</span><br><span class="line-number">436</span><br><span class="line-number">437</span><br><span class="line-number">438</span><br><span class="line-number">439</span><br><span class="line-number">440</span><br><span class="line-number">441</span><br><span class="line-number">442</span><br><span class="line-number">443</span><br><span class="line-number">444</span><br><span class="line-number">445</span><br><span class="line-number">446</span><br><span class="line-number">447</span><br><span class="line-number">448</span><br><span class="line-number">449</span><br><span class="line-number">450</span><br><span class="line-number">451</span><br><span class="line-number">452</span><br><span class="line-number">453</span><br><span class="line-number">454</span><br><span class="line-number">455</span><br><span class="line-number">456</span><br><span class="line-number">457</span><br><span class="line-number">458</span><br><span class="line-number">459</span><br><span class="line-number">460</span><br><span class="line-number">461</span><br><span class="line-number">462</span><br><span class="line-number">463</span><br><span class="line-number">464</span><br><span class="line-number">465</span><br><span class="line-number">466</span><br><span class="line-number">467</span><br><span class="line-number">468</span><br><span class="line-number">469</span><br><span class="line-number">470</span><br><span class="line-number">471</span><br><span class="line-number">472</span><br><span class="line-number">473</span><br><span class="line-number">474</span><br><span class="line-number">475</span><br><span class="line-number">476</span><br><span class="line-number">477</span><br><span class="line-number">478</span><br><span class="line-number">479</span><br><span class="line-number">480</span><br><span class="line-number">481</span><br><span class="line-number">482</span><br><span class="line-number">483</span><br><span class="line-number">484</span><br><span class="line-number">485</span><br><span class="line-number">486</span><br><span class="line-number">487</span><br><span class="line-number">488</span><br><span class="line-number">489</span><br><span class="line-number">490</span><br><span class="line-number">491</span><br><span class="line-number">492</span><br><span class="line-number">493</span><br><span class="line-number">494</span><br><span class="line-number">495</span><br><span class="line-number">496</span><br><span class="line-number">497</span><br><span class="line-number">498</span><br><span class="line-number">499</span><br><span class="line-number">500</span><br><span class="line-number">501</span><br><span class="line-number">502</span><br><span class="line-number">503</span><br><span class="line-number">504</span><br><span class="line-number">505</span><br><span class="line-number">506</span><br><span class="line-number">507</span><br><span class="line-number">508</span><br><span class="line-number">509</span><br><span class="line-number">510</span><br><span class="line-number">511</span><br><span class="line-number">512</span><br><span class="line-number">513</span><br><span class="line-number">514</span><br><span class="line-number">515</span><br><span class="line-number">516</span><br><span class="line-number">517</span><br><span class="line-number">518</span><br><span class="line-number">519</span><br><span class="line-number">520</span><br><span class="line-number">521</span><br><span class="line-number">522</span><br><span class="line-number">523</span><br><span class="line-number">524</span><br><span class="line-number">525</span><br><span class="line-number">526</span><br><span class="line-number">527</span><br><span class="line-number">528</span><br><span class="line-number">529</span><br><span class="line-number">530</span><br><span class="line-number">531</span><br><span class="line-number">532</span><br><span class="line-number">533</span><br><span class="line-number">534</span><br><span class="line-number">535</span><br><span class="line-number">536</span><br><span class="line-number">537</span><br><span class="line-number">538</span><br><span class="line-number">539</span><br><span class="line-number">540</span><br><span class="line-number">541</span><br><span class="line-number">542</span><br><span class="line-number">543</span><br><span class="line-number">544</span><br><span class="line-number">545</span><br><span class="line-number">546</span><br><span class="line-number">547</span><br><span class="line-number">548</span><br><span class="line-number">549</span><br><span class="line-number">550</span><br><span class="line-number">551</span><br><span class="line-number">552</span><br><span class="line-number">553</span><br><span class="line-number">554</span><br><span class="line-number">555</span><br><span class="line-number">556</span><br><span class="line-number">557</span><br><span class="line-number">558</span><br><span class="line-number">559</span><br><span class="line-number">560</span><br><span class="line-number">561</span><br><span class="line-number">562</span><br><span class="line-number">563</span><br><span class="line-number">564</span><br><span class="line-number">565</span><br><span class="line-number">566</span><br><span class="line-number">567</span><br><span class="line-number">568</span><br><span class="line-number">569</span><br><span class="line-number">570</span><br><span class="line-number">571</span><br><span class="line-number">572</span><br><span class="line-number">573</span><br><span class="line-number">574</span><br><span class="line-number">575</span><br><span class="line-number">576</span><br><span class="line-number">577</span><br><span class="line-number">578</span><br><span class="line-number">579</span><br><span class="line-number">580</span><br><span class="line-number">581</span><br></div></div></details> <h2 id="_8-redis-conf详解"><a href="#_8-redis-conf详解" class="header-anchor">#</a> 8. <code>redis.conf</code>详解</h2> <p><code>redis.conf</code>官方下载地址</p> <blockquote><ul><li>http://download.redis.io/redis-stable/redis.conf</li></ul></blockquote> <h3 id="_8-1-存储单位说明"><a href="#_8-1-存储单位说明" class="header-anchor">#</a> 8.1 存储单位说明</h3> <div id="code-demo-0cb02e2a" class="code-demo-wrapper"><!----> <div class="code-demo-header"><button class="toggle-button right"></button> <span class="title">存储单位说明</span> <form action="https://jsfiddle.net/api/post/library/pure/" target="_blank" method="post" class="code-demo-jsfiddle"><input type="hidden" name="html" value=""> <input type="hidden" name="js" value=""> <input type="hidden" name="css" value=""> <input type="hidden" name="wrap" value="1"> <input type="hidden" name="panel_js" value="3"> <input type="hidden" name="resources" value=""> <button type="submit" aria-label="JSFiddle" data-balloon-pos="up" class="jsfiddle-button"><svg viewBox="0 0 1170 1024" xmlns="http://www.w3.org/2000/svg" width="228.516" height="200" class="jsfiddle-icon"><path d="M1028.571 441.143q63.429 26.286 102.572 83.143t39.143 126.571q0 93.714-67.429 160.286T940 877.714q-2.286 0-6.571-.285t-6-.286H232q-97.143-5.714-164.571-71.714T0 645.143q0-62.857 31.429-116t84-84q-6.858-22.286-6.858-46.857 0-65.715 46.858-112T269.143 240q54.286 0 98.286 33.143 42.857-88 127.142-141.714t186.572-53.715q94.857 0 174.857 46t126.571 124.857 46.572 172q0 3.429-.286 10.286t-.286 10.286zm-761.142 152q0 69.714 48 110.286T434.286 744q78.285 0 137.143-56.571-9.143-11.429-27.143-32.286t-24.857-28.857q-38.286 37.143-82.286 37.143-31.429 0-53.429-19.143t-22-50q0-30.286 22-49.715T436 525.143q25.143 0 48.286 12T526 568.57t37.143 42.858 39.428 46.857 44 42.857T702 732.57t69.429 12q69.142 0 116.857-40.857T936 594.857q0-69.143-48-109.714T769.714 444.57Q688 444.571 632 500l53.143 61.714q37.714-36.571 81.143-36.571 29.714 0 52.571 18.857t22.857 48q0 32.571-21.143 52.286T766.857 664q-24.571 0-47.143-12t-41.143-31.429-37.428-42.857-39.714-46.857T557.143 488 502 456.571t-67.714-12q-69.715 0-118.286 40.286t-48.571 108.286z"></path></svg></button></form> <form target="_blank" action="https://codepen.io/pen/define" method="post" class="code-demo-codepen"><input type="hidden" name="data" value="{&quot;html&quot;:&quot;&quot;,&quot;js&quot;:&quot;&quot;,&quot;css&quot;:&quot;&quot;,&quot;js_external&quot;:&quot;&quot;,&quot;css_external&quot;:&quot;&quot;,&quot;layout&quot;:&quot;left&quot;,&quot;editors&quot;:&quot;101&quot;}"></form></div> <div class="code-demo-container" style="display:none;"></div> <div class="code-demo-code-wrapper" style="height:0;"><div class="code-demo-codes"><div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># Redis configuration file example.</span>
<span class="token comment">#</span>
<span class="token comment"># Note that in order to read the configuration file, Redis must be</span>
<span class="token comment"># started with the file path as first argument:</span>
<span class="token comment">#</span>
<span class="token comment"># ./redis-server /path/to/redis.conf</span>

<span class="token comment"># Note on units: when memory size is needed, it is possible to specify</span>
<span class="token comment"># it in the usual form of 1k 5GB 4M and so forth:</span>
<span class="token comment">#</span>
<span class="token comment"># 1k =&gt; 1000 bytes</span>
<span class="token comment"># 1kb =&gt; 1024 bytes</span>
<span class="token comment"># 1m =&gt; 1000000 bytes</span>
<span class="token comment"># 1mb =&gt; 1024*1024 bytes</span>
<span class="token comment"># 1g =&gt; 1000000000 bytes</span>
<span class="token comment"># 1gb =&gt; 1024*1024*1024 bytes</span>
<span class="token comment">#</span>
<span class="token comment"># units are case insensitive so 1GB 1Gb 1gB are all the same.</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div></div></div></div><h3 id="_8-2-网络配置"><a href="#_8-2-网络配置" class="header-anchor">#</a> 8.2 网络配置</h3> <div id="code-demo-7d3ec0fa" class="code-demo-wrapper"><!----> <div class="code-demo-header"><button class="toggle-button right"></button> <span class="title">网络配置</span> <form action="https://jsfiddle.net/api/post/library/pure/" target="_blank" method="post" class="code-demo-jsfiddle"><input type="hidden" name="html" value=""> <input type="hidden" name="js" value=""> <input type="hidden" name="css" value=""> <input type="hidden" name="wrap" value="1"> <input type="hidden" name="panel_js" value="3"> <input type="hidden" name="resources" value=""> <button type="submit" aria-label="JSFiddle" data-balloon-pos="up" class="jsfiddle-button"><svg viewBox="0 0 1170 1024" xmlns="http://www.w3.org/2000/svg" width="228.516" height="200" class="jsfiddle-icon"><path d="M1028.571 441.143q63.429 26.286 102.572 83.143t39.143 126.571q0 93.714-67.429 160.286T940 877.714q-2.286 0-6.571-.285t-6-.286H232q-97.143-5.714-164.571-71.714T0 645.143q0-62.857 31.429-116t84-84q-6.858-22.286-6.858-46.857 0-65.715 46.858-112T269.143 240q54.286 0 98.286 33.143 42.857-88 127.142-141.714t186.572-53.715q94.857 0 174.857 46t126.571 124.857 46.572 172q0 3.429-.286 10.286t-.286 10.286zm-761.142 152q0 69.714 48 110.286T434.286 744q78.285 0 137.143-56.571-9.143-11.429-27.143-32.286t-24.857-28.857q-38.286 37.143-82.286 37.143-31.429 0-53.429-19.143t-22-50q0-30.286 22-49.715T436 525.143q25.143 0 48.286 12T526 568.57t37.143 42.858 39.428 46.857 44 42.857T702 732.57t69.429 12q69.142 0 116.857-40.857T936 594.857q0-69.143-48-109.714T769.714 444.57Q688 444.571 632 500l53.143 61.714q37.714-36.571 81.143-36.571 29.714 0 52.571 18.857t22.857 48q0 32.571-21.143 52.286T766.857 664q-24.571 0-47.143-12t-41.143-31.429-37.428-42.857-39.714-46.857T557.143 488 502 456.571t-67.714-12q-69.715 0-118.286 40.286t-48.571 108.286z"></path></svg></button></form> <form target="_blank" action="https://codepen.io/pen/define" method="post" class="code-demo-codepen"><input type="hidden" name="data" value="{&quot;html&quot;:&quot;&quot;,&quot;js&quot;:&quot;&quot;,&quot;css&quot;:&quot;&quot;,&quot;js_external&quot;:&quot;&quot;,&quot;css_external&quot;:&quot;&quot;,&quot;layout&quot;:&quot;left&quot;,&quot;editors&quot;:&quot;101&quot;}"></form></div> <div class="code-demo-container" style="display:none;"></div> <div class="code-demo-code-wrapper" style="height:0;"><div class="code-demo-codes"><div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment">################################## NETWORK #####################################</span>

<span class="token comment"># 绑定的IP</span>
<span class="token builtin class-name">bind</span> <span class="token number">127.0</span>.0.1

<span class="token comment"># 保护模式是否开启，默认开启</span>
protected-mode <span class="token function">yes</span>

<span class="token comment"># 端口号</span>
port <span class="token number">6379</span>

<span class="token comment"># TCP listen() backlog.</span>
<span class="token comment">#</span>
<span class="token comment"># In high requests-per-second environments you need a high backlog in order</span>
<span class="token comment"># to avoid slow clients connection issues. Note that the Linux kernel</span>
<span class="token comment"># will silently truncate it to the value of /proc/sys/net/core/somaxconn so</span>
<span class="token comment"># make sure to raise both the value of somaxconn and tcp_max_syn_backlog</span>
<span class="token comment"># in order to get the desired effect.</span>
tcp-backlog <span class="token number">511</span>

<span class="token comment"># Unix socket.</span>
<span class="token comment">#</span>
<span class="token comment"># Specify the path for the Unix socket that will be used to listen for</span>
<span class="token comment"># incoming connections. There is no default, so Redis will not listen</span>
<span class="token comment"># on a unix socket when not specified.</span>
<span class="token comment">#</span>
<span class="token comment"># unixsocket /tmp/redis.sock</span>
<span class="token comment"># unixsocketperm 700</span>

<span class="token comment"># Close the connection after a client is idle for N seconds (0 to disable)</span>
<span class="token function">timeout</span> <span class="token number">0</span>

<span class="token comment"># TCP keepalive.</span>
<span class="token comment">#</span>
<span class="token comment"># If non-zero, use SO_KEEPALIVE to send TCP ACKs to clients in absence</span>
<span class="token comment"># of communication. This is useful for two reasons:</span>
<span class="token comment">#</span>
<span class="token comment"># 1) Detect dead peers.</span>
<span class="token comment"># 2) Force network equipment in the middle to consider the connection to be</span>
<span class="token comment">#    alive.</span>
<span class="token comment">#</span>
<span class="token comment"># On Linux, the specified value (in seconds) is the period used to send ACKs.</span>
<span class="token comment"># Note that to close the connection the double of the time is needed.</span>
<span class="token comment"># On other kernels the period depends on the kernel configuration.</span>
<span class="token comment">#</span>
<span class="token comment"># A reasonable value for this option is 300 seconds, which is the new</span>
<span class="token comment"># Redis default starting with Redis 3.2.1.</span>
tcp-keepalive <span class="token number">300</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br></div></div></div></div></div><h3 id="_8-3-基本配置"><a href="#_8-3-基本配置" class="header-anchor">#</a> 8.3 基本配置</h3> <div id="code-demo-18c672ac" class="code-demo-wrapper"><!----> <div class="code-demo-header"><button class="toggle-button right"></button> <span class="title">基本配置</span> <form action="https://jsfiddle.net/api/post/library/pure/" target="_blank" method="post" class="code-demo-jsfiddle"><input type="hidden" name="html" value=""> <input type="hidden" name="js" value=""> <input type="hidden" name="css" value=""> <input type="hidden" name="wrap" value="1"> <input type="hidden" name="panel_js" value="3"> <input type="hidden" name="resources" value=""> <button type="submit" aria-label="JSFiddle" data-balloon-pos="up" class="jsfiddle-button"><svg viewBox="0 0 1170 1024" xmlns="http://www.w3.org/2000/svg" width="228.516" height="200" class="jsfiddle-icon"><path d="M1028.571 441.143q63.429 26.286 102.572 83.143t39.143 126.571q0 93.714-67.429 160.286T940 877.714q-2.286 0-6.571-.285t-6-.286H232q-97.143-5.714-164.571-71.714T0 645.143q0-62.857 31.429-116t84-84q-6.858-22.286-6.858-46.857 0-65.715 46.858-112T269.143 240q54.286 0 98.286 33.143 42.857-88 127.142-141.714t186.572-53.715q94.857 0 174.857 46t126.571 124.857 46.572 172q0 3.429-.286 10.286t-.286 10.286zm-761.142 152q0 69.714 48 110.286T434.286 744q78.285 0 137.143-56.571-9.143-11.429-27.143-32.286t-24.857-28.857q-38.286 37.143-82.286 37.143-31.429 0-53.429-19.143t-22-50q0-30.286 22-49.715T436 525.143q25.143 0 48.286 12T526 568.57t37.143 42.858 39.428 46.857 44 42.857T702 732.57t69.429 12q69.142 0 116.857-40.857T936 594.857q0-69.143-48-109.714T769.714 444.57Q688 444.571 632 500l53.143 61.714q37.714-36.571 81.143-36.571 29.714 0 52.571 18.857t22.857 48q0 32.571-21.143 52.286T766.857 664q-24.571 0-47.143-12t-41.143-31.429-37.428-42.857-39.714-46.857T557.143 488 502 456.571t-67.714-12q-69.715 0-118.286 40.286t-48.571 108.286z"></path></svg></button></form> <form target="_blank" action="https://codepen.io/pen/define" method="post" class="code-demo-codepen"><input type="hidden" name="data" value="{&quot;html&quot;:&quot;&quot;,&quot;js&quot;:&quot;&quot;,&quot;css&quot;:&quot;&quot;,&quot;js_external&quot;:&quot;&quot;,&quot;css_external&quot;:&quot;&quot;,&quot;layout&quot;:&quot;left&quot;,&quot;editors&quot;:&quot;101&quot;}"></form></div> <div class="code-demo-container" style="display:none;"></div> <div class="code-demo-code-wrapper" style="height:0;"><div class="code-demo-codes"><div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment">################################# GENERAL #####################################</span>

<span class="token comment"># 是否以守护进程的方式运行即后台运行，默认为no，需要改为yes</span>
daemonize no

<span class="token comment"># 后台运行指定的pid文件</span>
pidfile /var/run/redis_6379.pid

<span class="token comment"># 日志级别</span>
<span class="token comment"># Specify the server verbosity level.</span>
<span class="token comment"># This can be one of:</span>
<span class="token comment"># debug (a lot of information, useful for development/testing)</span>
<span class="token comment"># verbose (many rarely useful info, but not a mess like the debug level)</span>
<span class="token comment"># notice (moderately verbose, what you want in production probably)</span>
<span class="token comment"># warning (only very important / critical messages are logged)</span>
loglevel notice

<span class="token comment"># 输入的日志位置文件名</span>
<span class="token comment"># Specify the log file name. Also the empty string can be used to force</span>
<span class="token comment"># Redis to log on the standard output. Note that if you use standard</span>
<span class="token comment"># output for logging but daemonize, logs will be sent to /dev/null</span>
logfile <span class="token string">&quot;&quot;</span>

<span class="token comment"># 数据库数量</span>
databases <span class="token number">16</span>

<span class="token comment"># 运行时显示redislogo</span>
always-show-logo <span class="token function">yes</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div></div></div></div><h3 id="_8-4-快照配置"><a href="#_8-4-快照配置" class="header-anchor">#</a> 8.4 快照配置</h3> <div id="code-demo-71d5cf02" class="code-demo-wrapper"><!----> <div class="code-demo-header"><button class="toggle-button right"></button> <span class="title">快照配置</span> <form action="https://jsfiddle.net/api/post/library/pure/" target="_blank" method="post" class="code-demo-jsfiddle"><input type="hidden" name="html" value=""> <input type="hidden" name="js" value=""> <input type="hidden" name="css" value=""> <input type="hidden" name="wrap" value="1"> <input type="hidden" name="panel_js" value="3"> <input type="hidden" name="resources" value=""> <button type="submit" aria-label="JSFiddle" data-balloon-pos="up" class="jsfiddle-button"><svg viewBox="0 0 1170 1024" xmlns="http://www.w3.org/2000/svg" width="228.516" height="200" class="jsfiddle-icon"><path d="M1028.571 441.143q63.429 26.286 102.572 83.143t39.143 126.571q0 93.714-67.429 160.286T940 877.714q-2.286 0-6.571-.285t-6-.286H232q-97.143-5.714-164.571-71.714T0 645.143q0-62.857 31.429-116t84-84q-6.858-22.286-6.858-46.857 0-65.715 46.858-112T269.143 240q54.286 0 98.286 33.143 42.857-88 127.142-141.714t186.572-53.715q94.857 0 174.857 46t126.571 124.857 46.572 172q0 3.429-.286 10.286t-.286 10.286zm-761.142 152q0 69.714 48 110.286T434.286 744q78.285 0 137.143-56.571-9.143-11.429-27.143-32.286t-24.857-28.857q-38.286 37.143-82.286 37.143-31.429 0-53.429-19.143t-22-50q0-30.286 22-49.715T436 525.143q25.143 0 48.286 12T526 568.57t37.143 42.858 39.428 46.857 44 42.857T702 732.57t69.429 12q69.142 0 116.857-40.857T936 594.857q0-69.143-48-109.714T769.714 444.57Q688 444.571 632 500l53.143 61.714q37.714-36.571 81.143-36.571 29.714 0 52.571 18.857t22.857 48q0 32.571-21.143 52.286T766.857 664q-24.571 0-47.143-12t-41.143-31.429-37.428-42.857-39.714-46.857T557.143 488 502 456.571t-67.714-12q-69.715 0-118.286 40.286t-48.571 108.286z"></path></svg></button></form> <form target="_blank" action="https://codepen.io/pen/define" method="post" class="code-demo-codepen"><input type="hidden" name="data" value="{&quot;html&quot;:&quot;&quot;,&quot;js&quot;:&quot;&quot;,&quot;css&quot;:&quot;&quot;,&quot;js_external&quot;:&quot;&quot;,&quot;css_external&quot;:&quot;&quot;,&quot;layout&quot;:&quot;left&quot;,&quot;editors&quot;:&quot;101&quot;}"></form></div> <div class="code-demo-container" style="display:none;"></div> <div class="code-demo-code-wrapper" style="height:0;"><div class="code-demo-codes"><div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment">################################ SNAPSHOTTING  ################################</span>
<span class="token comment">#</span>
<span class="token comment"># Save the DB on disk:</span>
<span class="token comment">#</span>
<span class="token comment">#   save &lt;seconds&gt; &lt;changes&gt;</span>
<span class="token comment">#</span>
<span class="token comment">#   Will save the DB if both the given number of seconds and the given</span>
<span class="token comment">#   number of write operations against the DB occurred.</span>
<span class="token comment">#</span>
<span class="token comment">#   In the example below the behavior will be to save:</span>
<span class="token comment">#   after 900 sec (15 min) if at least 1 key changed</span>
<span class="token comment">#   after 300 sec (5 min) if at least 10 keys changed</span>
<span class="token comment">#   after 60 sec if at least 10000 keys changed</span>
<span class="token comment">#</span>
<span class="token comment">#   Note: you can disable saving completely by commenting out all &quot;save&quot; lines.</span>
<span class="token comment">#</span>
<span class="token comment">#   It is also possible to remove all the previously configured save</span>
<span class="token comment">#   points by adding a save directive with a single empty string argument</span>
<span class="token comment">#   like in the following example:</span>
<span class="token comment">#</span>
<span class="token comment">#   save &quot;&quot;</span>

<span class="token comment"># 如果900s内,如果至少有一个1个key进行了修改,我们就进行持久化操作</span>
save <span class="token number">900</span> <span class="token number">1</span>
<span class="token comment"># 如果.00s内,如果至少有一个10个key进行了修改,我们就进行持久化操作</span>
save <span class="token number">300</span> <span class="token number">10</span>
<span class="token comment"># 如果60s内,如果至少有一个10000个key进行了修改,我们就进行持久化操作</span>
save <span class="token number">60</span> <span class="token number">10000</span>

<span class="token comment"># By default Redis will stop accepting writes if RDB snapshots are enabled</span>
<span class="token comment"># (at least one save point) and the latest background save failed.</span>
<span class="token comment"># This will make the user aware (in a hard way) that data is not persisting</span>
<span class="token comment"># on disk properly, otherwise chances are that no one will notice and some</span>
<span class="token comment"># disaster will happen.</span>
<span class="token comment">#</span>
<span class="token comment"># If the background saving process will start working again Redis will</span>
<span class="token comment"># automatically allow writes again.</span>
<span class="token comment">#</span>
<span class="token comment"># However if you have setup your proper monitoring of the Redis server</span>
<span class="token comment"># and persistence, you may want to disable this feature so that Redis will</span>
<span class="token comment"># continue to work as usual even if there are problems with disk,</span>
<span class="token comment"># permissions, and so forth.</span>
<span class="token comment"># 持久化操作失败是否还继续</span>
stop-writes-on-bgsave-error <span class="token function">yes</span>

<span class="token comment"># Compress string objects using LZF when dump .rdb databases?</span>
<span class="token comment"># By default compression is enabled as it's almost always a win.</span>
<span class="token comment"># If you want to save some CPU in the saving child set it to 'no' but</span>
<span class="token comment"># the dataset will likely be bigger if you have compressible values or keys.</span>
<span class="token comment"># 是否压缩rdb文件，是的话会消耗一定CPU资源</span>
rdbcompression <span class="token function">yes</span>

<span class="token comment"># Since version 5 of RDB a CRC64 checksum is placed at the end of the file.</span>
<span class="token comment"># This makes the format more resistant to corruption but there is a performance</span>
<span class="token comment"># hit to pay (around 10%) when saving and loading RDB files, so you can disable it</span>
<span class="token comment"># for maximum performances.</span>
<span class="token comment">#</span>
<span class="token comment"># RDB files created with checksum disabled have a checksum of zero that will</span>
<span class="token comment"># tell the loading code to skip the check.</span>
<span class="token comment"># 保存rdb文件的时候是否校验rdb文件</span>
rdbchecksum <span class="token function">yes</span>

<span class="token comment"># The filename where to dump the DB</span>
dbfilename dump.rdb

<span class="token comment"># Remove RDB files used by replication in instances without persistence</span>
<span class="token comment"># enabled. By default this option is disabled, however there are environments</span>
<span class="token comment"># where for regulations or other security concerns, RDB files persisted on</span>
<span class="token comment"># disk by masters in order to feed replicas, or stored on disk by replicas</span>
<span class="token comment"># in order to load them for the initial synchronization, should be deleted</span>
<span class="token comment"># ASAP. Note that this option ONLY WORKS in instances that have both AOF</span>
<span class="token comment"># and RDB persistence disabled, otherwise is completely ignored.</span>
<span class="token comment">#</span>
<span class="token comment"># An alternative (and sometimes better) way to obtain the same effect is</span>
<span class="token comment"># to use diskless replication on both master and replicas instances. However</span>
<span class="token comment"># in the case of replicas, diskless is not always an option.</span>
rdb-del-sync-files no

<span class="token comment"># The working directory.</span>
<span class="token comment">#</span>
<span class="token comment"># The DB will be written inside this directory, with the filename specified</span>
<span class="token comment"># above using the 'dbfilename' configuration directive.</span>
<span class="token comment">#</span>
<span class="token comment"># The Append Only File will also be created inside this directory.</span>
<span class="token comment">#</span>
<span class="token comment"># Note that you must specify a directory here, not a file name.</span>
<span class="token comment"># rdb文件保存的目录</span>
<span class="token function">dir</span> ./
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br></div></div></div></div></div><h3 id="_8-5-主从复制相关"><a href="#_8-5-主从复制相关" class="header-anchor">#</a> 8.5 主从复制相关</h3> <div id="code-demo-00276890" class="code-demo-wrapper"><!----> <div class="code-demo-header"><button class="toggle-button right"></button> <span class="title">主从复制相关</span> <form action="https://jsfiddle.net/api/post/library/pure/" target="_blank" method="post" class="code-demo-jsfiddle"><input type="hidden" name="html" value=""> <input type="hidden" name="js" value=""> <input type="hidden" name="css" value=""> <input type="hidden" name="wrap" value="1"> <input type="hidden" name="panel_js" value="3"> <input type="hidden" name="resources" value=""> <button type="submit" aria-label="JSFiddle" data-balloon-pos="up" class="jsfiddle-button"><svg viewBox="0 0 1170 1024" xmlns="http://www.w3.org/2000/svg" width="228.516" height="200" class="jsfiddle-icon"><path d="M1028.571 441.143q63.429 26.286 102.572 83.143t39.143 126.571q0 93.714-67.429 160.286T940 877.714q-2.286 0-6.571-.285t-6-.286H232q-97.143-5.714-164.571-71.714T0 645.143q0-62.857 31.429-116t84-84q-6.858-22.286-6.858-46.857 0-65.715 46.858-112T269.143 240q54.286 0 98.286 33.143 42.857-88 127.142-141.714t186.572-53.715q94.857 0 174.857 46t126.571 124.857 46.572 172q0 3.429-.286 10.286t-.286 10.286zm-761.142 152q0 69.714 48 110.286T434.286 744q78.285 0 137.143-56.571-9.143-11.429-27.143-32.286t-24.857-28.857q-38.286 37.143-82.286 37.143-31.429 0-53.429-19.143t-22-50q0-30.286 22-49.715T436 525.143q25.143 0 48.286 12T526 568.57t37.143 42.858 39.428 46.857 44 42.857T702 732.57t69.429 12q69.142 0 116.857-40.857T936 594.857q0-69.143-48-109.714T769.714 444.57Q688 444.571 632 500l53.143 61.714q37.714-36.571 81.143-36.571 29.714 0 52.571 18.857t22.857 48q0 32.571-21.143 52.286T766.857 664q-24.571 0-47.143-12t-41.143-31.429-37.428-42.857-39.714-46.857T557.143 488 502 456.571t-67.714-12q-69.715 0-118.286 40.286t-48.571 108.286z"></path></svg></button></form> <form target="_blank" action="https://codepen.io/pen/define" method="post" class="code-demo-codepen"><input type="hidden" name="data" value="{&quot;html&quot;:&quot;&quot;,&quot;js&quot;:&quot;&quot;,&quot;css&quot;:&quot;&quot;,&quot;js_external&quot;:&quot;&quot;,&quot;css_external&quot;:&quot;&quot;,&quot;layout&quot;:&quot;left&quot;,&quot;editors&quot;:&quot;101&quot;}"></form></div> <div class="code-demo-container" style="display:none;"></div> <div class="code-demo-code-wrapper" style="height:0;"><div class="code-demo-codes"><div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment">################################# REPLICATION #################################</span>

<span class="token comment"># Master-Replica replication. Use replicaof to make a Redis instance a copy of</span>
<span class="token comment"># another Redis server. A few things to understand ASAP about Redis replication.</span>
<span class="token comment">#</span>
<span class="token comment">#   +------------------+      +---------------+</span>
<span class="token comment">#   |      Master      | ---&gt; |    Replica    |</span>
<span class="token comment">#   | (receive writes) |      |  (exact copy) |</span>
<span class="token comment">#   +------------------+      +---------------+</span>
<span class="token comment">#</span>
<span class="token comment"># 1) Redis replication is asynchronous, but you can configure a master to</span>
<span class="token comment">#    stop accepting writes if it appears to be not connected with at least</span>
<span class="token comment">#    a given number of replicas.</span>
<span class="token comment"># 2) Redis replicas are able to perform a partial resynchronization with the</span>
<span class="token comment">#    master if the replication link is lost for a relatively small amount of</span>
<span class="token comment">#    time. You may want to configure the replication backlog size (see the next</span>
<span class="token comment">#    sections of this file) with a sensible value depending on your needs.</span>
<span class="token comment"># 3) Replication is automatic and does not need user intervention. After a</span>
<span class="token comment">#    network partition replicas automatically try to reconnect to masters</span>
<span class="token comment">#    and resynchronize with them.</span>
<span class="token comment">#</span>
<span class="token comment"># replicaof &lt;masterip&gt; &lt;masterport&gt;</span>

<span class="token comment"># If the master is password protected (using the &quot;requirepass&quot; configuration</span>
<span class="token comment"># directive below) it is possible to tell the replica to authenticate before</span>
<span class="token comment"># starting the replication synchronization process, otherwise the master will</span>
<span class="token comment"># refuse the replica request.</span>
<span class="token comment">#</span>
<span class="token comment"># masterauth &lt;master-password&gt;</span>
<span class="token comment">#</span>
<span class="token comment"># However this is not enough if you are using Redis ACLs (for Redis version</span>
<span class="token comment"># 6 or greater), and the default user is not capable of running the PSYNC</span>
<span class="token comment"># command and/or other commands needed for replication. In this case it's</span>
<span class="token comment"># better to configure a special user to use with replication, and specify the</span>
<span class="token comment"># masteruser configuration as such:</span>
<span class="token comment">#</span>
<span class="token comment"># masteruser &lt;username&gt;</span>
<span class="token comment">#</span>
<span class="token comment"># When masteruser is specified, the replica will authenticate against its</span>
<span class="token comment"># master using the new AUTH form: AUTH &lt;username&gt; &lt;password&gt;.</span>

<span class="token comment"># When a replica loses its connection with the master, or when the replication</span>
<span class="token comment"># is still in progress, the replica can act in two different ways:</span>
<span class="token comment">#</span>
<span class="token comment"># 1) if replica-serve-stale-data is set to 'yes' (the default) the replica will</span>
<span class="token comment">#    still reply to client requests, possibly with out of date data, or the</span>
<span class="token comment">#    data set may just be empty if this is the first synchronization.</span>
<span class="token comment">#</span>
<span class="token comment"># 2) If replica-serve-stale-data is set to 'no' the replica will reply with</span>
<span class="token comment">#    an error &quot;SYNC with master in progress&quot; to all commands except:</span>
<span class="token comment">#    INFO, REPLICAOF, AUTH, PING, SHUTDOWN, REPLCONF, ROLE, CONFIG, SUBSCRIBE,</span>
<span class="token comment">#    UNSUBSCRIBE, PSUBSCRIBE, PUNSUBSCRIBE, PUBLISH, PUBSUB, COMMAND, POST,</span>
<span class="token comment">#    HOST and LATENCY.</span>
<span class="token comment">#</span>
replica-serve-stale-data <span class="token function">yes</span>

<span class="token comment"># You can configure a replica instance to accept writes or not. Writing against</span>
<span class="token comment"># a replica instance may be useful to store some ephemeral data (because data</span>
<span class="token comment"># written on a replica will be easily deleted after resync with the master) but</span>
<span class="token comment"># may also cause problems if clients are writing to it because of a</span>
<span class="token comment"># misconfiguration.</span>
<span class="token comment">#</span>
<span class="token comment"># Since Redis 2.6 by default replicas are read-only.</span>
<span class="token comment">#</span>
<span class="token comment"># Note: read only replicas are not designed to be exposed to untrusted clients</span>
<span class="token comment"># on the internet. It's just a protection layer against misuse of the instance.</span>
<span class="token comment"># Still a read only replica exports by default all the administrative commands</span>
<span class="token comment"># such as CONFIG, DEBUG, and so forth. To a limited extent you can improve</span>
<span class="token comment"># security of read only replicas using 'rename-command' to shadow all the</span>
<span class="token comment"># administrative / dangerous commands.</span>
replica-read-only <span class="token function">yes</span>

<span class="token comment"># Replication SYNC strategy: disk or socket.</span>
<span class="token comment">#</span>
<span class="token comment"># New replicas and reconnecting replicas that are not able to continue the</span>
<span class="token comment"># replication process just receiving differences, need to do what is called a</span>
<span class="token comment"># &quot;full synchronization&quot;. An RDB file is transmitted from the master to the</span>
<span class="token comment"># replicas.</span>
<span class="token comment">#</span>
<span class="token comment"># The transmission can happen in two different ways:</span>
<span class="token comment">#</span>
<span class="token comment"># 1) Disk-backed: The Redis master creates a new process that writes the RDB</span>
<span class="token comment">#                 file on disk. Later the file is transferred by the parent</span>
<span class="token comment">#                 process to the replicas incrementally.</span>
<span class="token comment"># 2) Diskless: The Redis master creates a new process that directly writes the</span>
<span class="token comment">#              RDB file to replica sockets, without touching the disk at all.</span>
<span class="token comment">#</span>
<span class="token comment"># With disk-backed replication, while the RDB file is generated, more replicas</span>
<span class="token comment"># can be queued and served with the RDB file as soon as the current child</span>
<span class="token comment"># producing the RDB file finishes its work. With diskless replication instead</span>
<span class="token comment"># once the transfer starts, new replicas arriving will be queued and a new</span>
<span class="token comment"># transfer will start when the current one terminates.</span>
<span class="token comment">#</span>
<span class="token comment"># When diskless replication is used, the master waits a configurable amount of</span>
<span class="token comment"># time (in seconds) before starting the transfer in the hope that multiple</span>
<span class="token comment"># replicas will arrive and the transfer can be parallelized.</span>
<span class="token comment">#</span>
<span class="token comment"># With slow disks and fast (large bandwidth) networks, diskless replication</span>
<span class="token comment"># works better.</span>
repl-diskless-sync no

<span class="token comment"># When diskless replication is enabled, it is possible to configure the delay</span>
<span class="token comment"># the server waits in order to spawn the child that transfers the RDB via socket</span>
<span class="token comment"># to the replicas.</span>
<span class="token comment">#</span>
<span class="token comment"># This is important since once the transfer starts, it is not possible to serve</span>
<span class="token comment"># new replicas arriving, that will be queued for the next RDB transfer, so the</span>
<span class="token comment"># server waits a delay in order to let more replicas arrive.</span>
<span class="token comment">#</span>
<span class="token comment"># The delay is specified in seconds, and by default is 5 seconds. To disable</span>
<span class="token comment"># it entirely just set it to 0 seconds and the transfer will start ASAP.</span>
repl-diskless-sync-delay <span class="token number">5</span>

<span class="token comment"># -----------------------------------------------------------------------------</span>
<span class="token comment"># WARNING: RDB diskless load is experimental. Since in this setup the replica</span>
<span class="token comment"># does not immediately store an RDB on disk, it may cause data loss during</span>
<span class="token comment"># failovers. RDB diskless load + Redis modules not handling I/O reads may also</span>
<span class="token comment"># cause Redis to abort in case of I/O errors during the initial synchronization</span>
<span class="token comment"># stage with the master. Use only if your do what you are doing.</span>
<span class="token comment"># -----------------------------------------------------------------------------</span>
<span class="token comment">#</span>
<span class="token comment"># Replica can load the RDB it reads from the replication link directly from the</span>
<span class="token comment"># socket, or store the RDB to a file and read that file after it was completely</span>
<span class="token comment"># received from the master.</span>
<span class="token comment">#</span>
<span class="token comment"># In many cases the disk is slower than the network, and storing and loading</span>
<span class="token comment"># the RDB file may increase replication time (and even increase the master's</span>
<span class="token comment"># Copy on Write memory and salve buffers).</span>
<span class="token comment"># However, parsing the RDB file directly from the socket may mean that we have</span>
<span class="token comment"># to flush the contents of the current database before the full rdb was</span>
<span class="token comment"># received. For this reason we have the following options:</span>
<span class="token comment">#</span>
<span class="token comment"># &quot;disabled&quot;    - Don't use diskless load (store the rdb file to the disk first)</span>
<span class="token comment"># &quot;on-empty-db&quot; - Use diskless load only when it is completely safe.</span>
<span class="token comment"># &quot;swapdb&quot;      - Keep a copy of the current db contents in RAM while parsing</span>
<span class="token comment">#                 the data directly from the socket. note that this requires</span>
<span class="token comment">#                 sufficient memory, if you don't have it, you risk an OOM kill.</span>
repl-diskless-load disabled

<span class="token comment"># Replicas send PINGs to server in a predefined interval. It's possible to</span>
<span class="token comment"># change this interval with the repl_ping_replica_period option. The default</span>
<span class="token comment"># value is 10 seconds.</span>
<span class="token comment">#</span>
<span class="token comment"># repl-ping-replica-period 10</span>

<span class="token comment"># The following option sets the replication timeout for:</span>
<span class="token comment">#</span>
<span class="token comment"># 1) Bulk transfer I/O during SYNC, from the point of view of replica.</span>
<span class="token comment"># 2) Master timeout from the point of view of replicas (data, pings).</span>
<span class="token comment"># 3) Replica timeout from the point of view of masters (REPLCONF ACK pings).</span>
<span class="token comment">#</span>
<span class="token comment"># It is important to make sure that this value is greater than the value</span>
<span class="token comment"># specified for repl-ping-replica-period otherwise a timeout will be detected</span>
<span class="token comment"># every time there is low traffic between the master and the replica. The default</span>
<span class="token comment"># value is 60 seconds.</span>
<span class="token comment">#</span>
<span class="token comment"># repl-timeout 60</span>

<span class="token comment"># Disable TCP_NODELAY on the replica socket after SYNC?</span>
<span class="token comment">#</span>
<span class="token comment"># If you select &quot;yes&quot; Redis will use a smaller number of TCP packets and</span>
<span class="token comment"># less bandwidth to send data to replicas. But this can add a delay for</span>
<span class="token comment"># the data to appear on the replica side, up to 40 milliseconds with</span>
<span class="token comment"># Linux kernels using a default configuration.</span>
<span class="token comment">#</span>
<span class="token comment"># If you select &quot;no&quot; the delay for data to appear on the replica side will</span>
<span class="token comment"># be reduced but more bandwidth will be used for replication.</span>
<span class="token comment">#</span>
<span class="token comment"># By default we optimize for low latency, but in very high traffic conditions</span>
<span class="token comment"># or when the master and replicas are many hops away, turning this to &quot;yes&quot; may</span>
<span class="token comment"># be a good idea.</span>
repl-disable-tcp-nodelay no

<span class="token comment"># Set the replication backlog size. The backlog is a buffer that accumulates</span>
<span class="token comment"># replica data when replicas are disconnected for some time, so that when a</span>
<span class="token comment"># replica wants to reconnect again, often a full resync is not needed, but a</span>
<span class="token comment"># partial resync is enough, just passing the portion of data the replica</span>
<span class="token comment"># missed while disconnected.</span>
<span class="token comment">#</span>
<span class="token comment"># The bigger the replication backlog, the longer the replica can endure the</span>
<span class="token comment"># disconnect and later be able to perform a partial resynchronization.</span>
<span class="token comment">#</span>
<span class="token comment"># The backlog is only allocated if there is at least one replica connected.</span>
<span class="token comment">#</span>
<span class="token comment"># repl-backlog-size 1mb</span>

<span class="token comment"># After a master has no connected replicas for some time, the backlog will be</span>
<span class="token comment"># freed. The following option configures the amount of seconds that need to</span>
<span class="token comment"># elapse, starting from the time the last replica disconnected, for the backlog</span>
<span class="token comment"># buffer to be freed.</span>
<span class="token comment">#</span>
<span class="token comment"># Note that replicas never free the backlog for timeout, since they may be</span>
<span class="token comment"># promoted to masters later, and should be able to correctly &quot;partially</span>
<span class="token comment"># resynchronize&quot; with other replicas: hence they should always accumulate backlog.</span>
<span class="token comment">#</span>
<span class="token comment"># A value of 0 means to never release the backlog.</span>
<span class="token comment">#</span>
<span class="token comment"># repl-backlog-ttl 3600</span>

<span class="token comment"># The replica priority is an integer number published by Redis in the INFO</span>
<span class="token comment"># output. It is used by Redis Sentinel in order to select a replica to promote</span>
<span class="token comment"># into a master if the master is no longer working correctly.</span>
<span class="token comment">#</span>
<span class="token comment"># A replica with a low priority number is considered better for promotion, so</span>
<span class="token comment"># for instance if there are three replicas with priority 10, 100, 25 Sentinel</span>
<span class="token comment"># will pick the one with priority 10, that is the lowest.</span>
<span class="token comment">#</span>
<span class="token comment"># However a special priority of 0 marks the replica as not able to perform the</span>
<span class="token comment"># role of master, so a replica with priority of 0 will never be selected by</span>
<span class="token comment"># Redis Sentinel for promotion.</span>
<span class="token comment">#</span>
<span class="token comment"># By default the priority is 100.</span>
replica-priority <span class="token number">100</span>

<span class="token comment"># It is possible for a master to stop accepting writes if there are less than</span>
<span class="token comment"># N replicas connected, having a lag less or equal than M seconds.</span>
<span class="token comment">#</span>
<span class="token comment"># The N replicas need to be in &quot;online&quot; state.</span>
<span class="token comment">#</span>
<span class="token comment"># The lag in seconds, that must be &lt;= the specified value, is calculated from</span>
<span class="token comment"># the last ping received from the replica, that is usually sent every second.</span>
<span class="token comment">#</span>
<span class="token comment"># This option does not GUARANTEE that N replicas will accept the write, but</span>
<span class="token comment"># will limit the window of exposure for lost writes in case not enough replicas</span>
<span class="token comment"># are available, to the specified number of seconds.</span>
<span class="token comment">#</span>
<span class="token comment"># For example to require at least 3 replicas with a lag &lt;= 10 seconds use:</span>
<span class="token comment">#</span>
<span class="token comment"># min-replicas-to-write 3</span>
<span class="token comment"># min-replicas-max-lag 10</span>
<span class="token comment">#</span>
<span class="token comment"># Setting one or the other to 0 disables the feature.</span>
<span class="token comment">#</span>
<span class="token comment"># By default min-replicas-to-write is set to 0 (feature disabled) and</span>
<span class="token comment"># min-replicas-max-lag is set to 10.</span>

<span class="token comment"># A Redis master is able to list the address and port of the attached</span>
<span class="token comment"># replicas in different ways. For example the &quot;INFO replication&quot; section</span>
<span class="token comment"># offers this information, which is used, among other tools, by</span>
<span class="token comment"># Redis Sentinel in order to discover replica instances.</span>
<span class="token comment"># Another place where this info is available is in the output of the</span>
<span class="token comment"># &quot;ROLE&quot; command of a master.</span>
<span class="token comment">#</span>
<span class="token comment"># The listed IP address and port normally reported by a replica is</span>
<span class="token comment"># obtained in the following way:</span>
<span class="token comment">#</span>
<span class="token comment">#   IP: The address is auto detected by checking the peer address</span>
<span class="token comment">#   of the socket used by the replica to connect with the master.</span>
<span class="token comment">#</span>
<span class="token comment">#   Port: The port is communicated by the replica during the replication</span>
<span class="token comment">#   handshake, and is normally the port that the replica is using to</span>
<span class="token comment">#   listen for connections.</span>
<span class="token comment">#</span>
<span class="token comment"># However when port forwarding or Network Address Translation (NAT) is</span>
<span class="token comment"># used, the replica may actually be reachable via different IP and port</span>
<span class="token comment"># pairs. The following two options can be used by a replica in order to</span>
<span class="token comment"># report to its master a specific set of IP and port, so that both INFO</span>
<span class="token comment"># and ROLE will report those values.</span>
<span class="token comment">#</span>
<span class="token comment"># There is no need to use both the options if you need to override just</span>
<span class="token comment"># the port or the IP address.</span>
<span class="token comment">#</span>
<span class="token comment"># replica-announce-ip 5.5.5.5</span>
<span class="token comment"># replica-announce-port 1234</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br><span class="line-number">162</span><br><span class="line-number">163</span><br><span class="line-number">164</span><br><span class="line-number">165</span><br><span class="line-number">166</span><br><span class="line-number">167</span><br><span class="line-number">168</span><br><span class="line-number">169</span><br><span class="line-number">170</span><br><span class="line-number">171</span><br><span class="line-number">172</span><br><span class="line-number">173</span><br><span class="line-number">174</span><br><span class="line-number">175</span><br><span class="line-number">176</span><br><span class="line-number">177</span><br><span class="line-number">178</span><br><span class="line-number">179</span><br><span class="line-number">180</span><br><span class="line-number">181</span><br><span class="line-number">182</span><br><span class="line-number">183</span><br><span class="line-number">184</span><br><span class="line-number">185</span><br><span class="line-number">186</span><br><span class="line-number">187</span><br><span class="line-number">188</span><br><span class="line-number">189</span><br><span class="line-number">190</span><br><span class="line-number">191</span><br><span class="line-number">192</span><br><span class="line-number">193</span><br><span class="line-number">194</span><br><span class="line-number">195</span><br><span class="line-number">196</span><br><span class="line-number">197</span><br><span class="line-number">198</span><br><span class="line-number">199</span><br><span class="line-number">200</span><br><span class="line-number">201</span><br><span class="line-number">202</span><br><span class="line-number">203</span><br><span class="line-number">204</span><br><span class="line-number">205</span><br><span class="line-number">206</span><br><span class="line-number">207</span><br><span class="line-number">208</span><br><span class="line-number">209</span><br><span class="line-number">210</span><br><span class="line-number">211</span><br><span class="line-number">212</span><br><span class="line-number">213</span><br><span class="line-number">214</span><br><span class="line-number">215</span><br><span class="line-number">216</span><br><span class="line-number">217</span><br><span class="line-number">218</span><br><span class="line-number">219</span><br><span class="line-number">220</span><br><span class="line-number">221</span><br><span class="line-number">222</span><br><span class="line-number">223</span><br><span class="line-number">224</span><br><span class="line-number">225</span><br><span class="line-number">226</span><br><span class="line-number">227</span><br><span class="line-number">228</span><br><span class="line-number">229</span><br><span class="line-number">230</span><br><span class="line-number">231</span><br><span class="line-number">232</span><br><span class="line-number">233</span><br><span class="line-number">234</span><br><span class="line-number">235</span><br><span class="line-number">236</span><br><span class="line-number">237</span><br><span class="line-number">238</span><br><span class="line-number">239</span><br><span class="line-number">240</span><br><span class="line-number">241</span><br><span class="line-number">242</span><br><span class="line-number">243</span><br><span class="line-number">244</span><br><span class="line-number">245</span><br><span class="line-number">246</span><br><span class="line-number">247</span><br><span class="line-number">248</span><br><span class="line-number">249</span><br><span class="line-number">250</span><br><span class="line-number">251</span><br><span class="line-number">252</span><br><span class="line-number">253</span><br><span class="line-number">254</span><br><span class="line-number">255</span><br><span class="line-number">256</span><br><span class="line-number">257</span><br><span class="line-number">258</span><br><span class="line-number">259</span><br><span class="line-number">260</span><br><span class="line-number">261</span><br><span class="line-number">262</span><br><span class="line-number">263</span><br><span class="line-number">264</span><br></div></div></div></div></div><h3 id="_8-6-安全配置"><a href="#_8-6-安全配置" class="header-anchor">#</a> 8.6 安全配置</h3> <div id="code-demo-4030b0e8" class="code-demo-wrapper"><!----> <div class="code-demo-header"><button class="toggle-button right"></button> <span class="title">安全配置</span> <form action="https://jsfiddle.net/api/post/library/pure/" target="_blank" method="post" class="code-demo-jsfiddle"><input type="hidden" name="html" value=""> <input type="hidden" name="js" value=""> <input type="hidden" name="css" value=""> <input type="hidden" name="wrap" value="1"> <input type="hidden" name="panel_js" value="3"> <input type="hidden" name="resources" value=""> <button type="submit" aria-label="JSFiddle" data-balloon-pos="up" class="jsfiddle-button"><svg viewBox="0 0 1170 1024" xmlns="http://www.w3.org/2000/svg" width="228.516" height="200" class="jsfiddle-icon"><path d="M1028.571 441.143q63.429 26.286 102.572 83.143t39.143 126.571q0 93.714-67.429 160.286T940 877.714q-2.286 0-6.571-.285t-6-.286H232q-97.143-5.714-164.571-71.714T0 645.143q0-62.857 31.429-116t84-84q-6.858-22.286-6.858-46.857 0-65.715 46.858-112T269.143 240q54.286 0 98.286 33.143 42.857-88 127.142-141.714t186.572-53.715q94.857 0 174.857 46t126.571 124.857 46.572 172q0 3.429-.286 10.286t-.286 10.286zm-761.142 152q0 69.714 48 110.286T434.286 744q78.285 0 137.143-56.571-9.143-11.429-27.143-32.286t-24.857-28.857q-38.286 37.143-82.286 37.143-31.429 0-53.429-19.143t-22-50q0-30.286 22-49.715T436 525.143q25.143 0 48.286 12T526 568.57t37.143 42.858 39.428 46.857 44 42.857T702 732.57t69.429 12q69.142 0 116.857-40.857T936 594.857q0-69.143-48-109.714T769.714 444.57Q688 444.571 632 500l53.143 61.714q37.714-36.571 81.143-36.571 29.714 0 52.571 18.857t22.857 48q0 32.571-21.143 52.286T766.857 664q-24.571 0-47.143-12t-41.143-31.429-37.428-42.857-39.714-46.857T557.143 488 502 456.571t-67.714-12q-69.715 0-118.286 40.286t-48.571 108.286z"></path></svg></button></form> <form target="_blank" action="https://codepen.io/pen/define" method="post" class="code-demo-codepen"><input type="hidden" name="data" value="{&quot;html&quot;:&quot;&quot;,&quot;js&quot;:&quot;&quot;,&quot;css&quot;:&quot;&quot;,&quot;js_external&quot;:&quot;&quot;,&quot;css_external&quot;:&quot;&quot;,&quot;layout&quot;:&quot;left&quot;,&quot;editors&quot;:&quot;101&quot;}"></form></div> <div class="code-demo-container" style="display:none;"></div> <div class="code-demo-code-wrapper" style="height:0;"><div class="code-demo-codes"><p>查看密码</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>//密码为空时获取密码
config get requirepass

//结果
<span class="token string">&quot;requirepass&quot;</span>
<span class="token string">&quot;&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>设置密码</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>config <span class="token builtin class-name">set</span> requirepass <span class="token string">&quot;123456&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>密码登录</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>auth <span class="token number">123456</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><code>redis.conf</code>设置密码</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment">################################## SECURITY ###################################</span>



<span class="token comment"># IMPORTANT NOTE: starting with Redis 6 &quot;requirepass&quot; is just a compatibility</span>
<span class="token comment"># layer on top of the new ACL system. The option effect will be just setting</span>
<span class="token comment"># the password for the default user. Clients will still authenticate using</span>
<span class="token comment"># AUTH &lt;password&gt; as usually, or more explicitly with AUTH default &lt;password&gt;</span>
<span class="token comment"># if they follow the new protocol: both will work.</span>
<span class="token comment">#</span>
<span class="token comment"># requirepass foobared</span>
<span class="token comment"># 设置密码</span>
requirepass <span class="token number">123456</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div></div></div></div><h3 id="_8-7-客户端限制"><a href="#_8-7-客户端限制" class="header-anchor">#</a> 8.7 客户端限制</h3> <div id="code-demo-d4111f42" class="code-demo-wrapper"><!----> <div class="code-demo-header"><button class="toggle-button right"></button> <span class="title">客户端限制</span> <form action="https://jsfiddle.net/api/post/library/pure/" target="_blank" method="post" class="code-demo-jsfiddle"><input type="hidden" name="html" value=""> <input type="hidden" name="js" value=""> <input type="hidden" name="css" value=""> <input type="hidden" name="wrap" value="1"> <input type="hidden" name="panel_js" value="3"> <input type="hidden" name="resources" value=""> <button type="submit" aria-label="JSFiddle" data-balloon-pos="up" class="jsfiddle-button"><svg viewBox="0 0 1170 1024" xmlns="http://www.w3.org/2000/svg" width="228.516" height="200" class="jsfiddle-icon"><path d="M1028.571 441.143q63.429 26.286 102.572 83.143t39.143 126.571q0 93.714-67.429 160.286T940 877.714q-2.286 0-6.571-.285t-6-.286H232q-97.143-5.714-164.571-71.714T0 645.143q0-62.857 31.429-116t84-84q-6.858-22.286-6.858-46.857 0-65.715 46.858-112T269.143 240q54.286 0 98.286 33.143 42.857-88 127.142-141.714t186.572-53.715q94.857 0 174.857 46t126.571 124.857 46.572 172q0 3.429-.286 10.286t-.286 10.286zm-761.142 152q0 69.714 48 110.286T434.286 744q78.285 0 137.143-56.571-9.143-11.429-27.143-32.286t-24.857-28.857q-38.286 37.143-82.286 37.143-31.429 0-53.429-19.143t-22-50q0-30.286 22-49.715T436 525.143q25.143 0 48.286 12T526 568.57t37.143 42.858 39.428 46.857 44 42.857T702 732.57t69.429 12q69.142 0 116.857-40.857T936 594.857q0-69.143-48-109.714T769.714 444.57Q688 444.571 632 500l53.143 61.714q37.714-36.571 81.143-36.571 29.714 0 52.571 18.857t22.857 48q0 32.571-21.143 52.286T766.857 664q-24.571 0-47.143-12t-41.143-31.429-37.428-42.857-39.714-46.857T557.143 488 502 456.571t-67.714-12q-69.715 0-118.286 40.286t-48.571 108.286z"></path></svg></button></form> <form target="_blank" action="https://codepen.io/pen/define" method="post" class="code-demo-codepen"><input type="hidden" name="data" value="{&quot;html&quot;:&quot;&quot;,&quot;js&quot;:&quot;&quot;,&quot;css&quot;:&quot;&quot;,&quot;js_external&quot;:&quot;&quot;,&quot;css_external&quot;:&quot;&quot;,&quot;layout&quot;:&quot;left&quot;,&quot;editors&quot;:&quot;101&quot;}"></form></div> <div class="code-demo-container" style="display:none;"></div> <div class="code-demo-code-wrapper" style="height:0;"><div class="code-demo-codes"><div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment">################################### CLIENTS ####################################</span>

<span class="token comment"># Set the max number of connected clients at the same time. By default</span>
<span class="token comment"># this limit is set to 10000 clients, however if the Redis server is not</span>
<span class="token comment"># able to configure the process file limit to allow for the specified limit</span>
<span class="token comment"># the max number of allowed clients is set to the current file limit</span>
<span class="token comment"># minus 32 (as Redis reserves a few file descriptors for internal uses).</span>
<span class="token comment">#</span>
<span class="token comment"># Once the limit is reached Redis will close all the new connections sending</span>
<span class="token comment"># an error 'max number of clients reached'.</span>
<span class="token comment">#</span>
<span class="token comment"># IMPORTANT: When Redis Cluster is used, the max number of connections is also</span>
<span class="token comment"># shared with the cluster bus: every node in the cluster will use two</span>
<span class="token comment"># connections, one incoming and another outgoing. It is important to size the</span>
<span class="token comment"># limit accordingly in case of very large clusters.</span>
<span class="token comment"># 设置能连接的最大客户端数</span>
maxclients <span class="token number">10000</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div></div></div></div><h3 id="_8-8-内存容量配置"><a href="#_8-8-内存容量配置" class="header-anchor">#</a> 8.8 内存容量配置</h3> <p>参考</p> <blockquote><ul><li><a href="http://www.511yj.com/centos-redis-key.html" target="_blank" rel="noopener noreferrer">redis 设置过期Key 的 maxmemory-policy 六种方式 | 511遇见 (511yj.com)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></blockquote> <p>六种方式</p> <blockquote><ul><li>volatile-lru：只对设置了过期时间的key进行LRU（默认值）</li> <li>allkeys-lru ： 删除lru算法的key</li> <li>volatile-random：随机删除即将过期key</li> <li>allkeys-random：随机删除</li> <li>volatile-ttl ： 删除即将过期的</li> <li>noeviction ： 永不过期，返回错误</li></ul></blockquote> <div id="code-demo-7a3a2da9" class="code-demo-wrapper"><!----> <div class="code-demo-header"><button class="toggle-button right"></button> <span class="title">内存容量配置</span> <form action="https://jsfiddle.net/api/post/library/pure/" target="_blank" method="post" class="code-demo-jsfiddle"><input type="hidden" name="html" value=""> <input type="hidden" name="js" value=""> <input type="hidden" name="css" value=""> <input type="hidden" name="wrap" value="1"> <input type="hidden" name="panel_js" value="3"> <input type="hidden" name="resources" value=""> <button type="submit" aria-label="JSFiddle" data-balloon-pos="up" class="jsfiddle-button"><svg viewBox="0 0 1170 1024" xmlns="http://www.w3.org/2000/svg" width="228.516" height="200" class="jsfiddle-icon"><path d="M1028.571 441.143q63.429 26.286 102.572 83.143t39.143 126.571q0 93.714-67.429 160.286T940 877.714q-2.286 0-6.571-.285t-6-.286H232q-97.143-5.714-164.571-71.714T0 645.143q0-62.857 31.429-116t84-84q-6.858-22.286-6.858-46.857 0-65.715 46.858-112T269.143 240q54.286 0 98.286 33.143 42.857-88 127.142-141.714t186.572-53.715q94.857 0 174.857 46t126.571 124.857 46.572 172q0 3.429-.286 10.286t-.286 10.286zm-761.142 152q0 69.714 48 110.286T434.286 744q78.285 0 137.143-56.571-9.143-11.429-27.143-32.286t-24.857-28.857q-38.286 37.143-82.286 37.143-31.429 0-53.429-19.143t-22-50q0-30.286 22-49.715T436 525.143q25.143 0 48.286 12T526 568.57t37.143 42.858 39.428 46.857 44 42.857T702 732.57t69.429 12q69.142 0 116.857-40.857T936 594.857q0-69.143-48-109.714T769.714 444.57Q688 444.571 632 500l53.143 61.714q37.714-36.571 81.143-36.571 29.714 0 52.571 18.857t22.857 48q0 32.571-21.143 52.286T766.857 664q-24.571 0-47.143-12t-41.143-31.429-37.428-42.857-39.714-46.857T557.143 488 502 456.571t-67.714-12q-69.715 0-118.286 40.286t-48.571 108.286z"></path></svg></button></form> <form target="_blank" action="https://codepen.io/pen/define" method="post" class="code-demo-codepen"><input type="hidden" name="data" value="{&quot;html&quot;:&quot;&quot;,&quot;js&quot;:&quot;&quot;,&quot;css&quot;:&quot;&quot;,&quot;js_external&quot;:&quot;&quot;,&quot;css_external&quot;:&quot;&quot;,&quot;layout&quot;:&quot;left&quot;,&quot;editors&quot;:&quot;101&quot;}"></form></div> <div class="code-demo-container" style="display:none;"></div> <div class="code-demo-code-wrapper" style="height:0;"><div class="code-demo-codes"><div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment">############################## MEMORY MANAGEMENT ################################</span>


<span class="token comment">#最大内存容量</span>
maxmemory <span class="token operator">&lt;</span>bytes<span class="token operator">&gt;</span>

<span class="token comment"># MAXMEMORY POLICY: how Redis will select what to remove when maxmemory</span>
<span class="token comment"># is reached. You can select one from the following behaviors:</span>
<span class="token comment">#</span>
<span class="token comment"># volatile-lru -&gt; Evict using approximated LRU, only keys with an expire set.</span>
<span class="token comment"># allkeys-lru -&gt; Evict any key using approximated LRU.</span>
<span class="token comment"># volatile-lfu -&gt; Evict using approximated LFU, only keys with an expire set.</span>
<span class="token comment"># allkeys-lfu -&gt; Evict any key using approximated LFU.</span>
<span class="token comment"># volatile-random -&gt; Remove a random key having an expire set.</span>
<span class="token comment"># allkeys-random -&gt; Remove a random key, any key.</span>
<span class="token comment"># volatile-ttl -&gt; Remove the key with the nearest expire time (minor TTL)</span>
<span class="token comment"># noeviction -&gt; Don't evict anything, just return an error on write operations.</span>
<span class="token comment">#</span>
<span class="token comment"># LRU means Least Recently Used</span>
<span class="token comment"># LFU means Least Frequently Used</span>
<span class="token comment">#</span>
<span class="token comment"># Both LRU, LFU and volatile-ttl are implemented using approximated</span>
<span class="token comment"># randomized algorithms.</span>
<span class="token comment">#</span>
<span class="token comment"># Note: with any of the above policies, Redis will return an error on write</span>
<span class="token comment">#       operations, when there are no suitable keys for eviction.</span>
<span class="token comment">#</span>
<span class="token comment">#       At the date of writing these commands are: set setnx setex append</span>
<span class="token comment">#       incr decr rpush lpush rpushx lpushx linsert lset rpoplpush sadd</span>
<span class="token comment">#       sinter sinterstore sunion sunionstore sdiff sdiffstore zadd zincrby</span>
<span class="token comment">#       zunionstore zinterstore hset hsetnx hmset hincrby incrby decrby</span>
<span class="token comment">#       getset mset msetnx exec sort</span>
<span class="token comment">#</span>
<span class="token comment"># The default is:</span>
<span class="token comment"># 内存达到上限的处理策略</span>
maxmemory-policy noeviction

<span class="token comment"># LRU, LFU and minimal TTL algorithms are not precise algorithms but approximated</span>
<span class="token comment"># algorithms (in order to save memory), so you can tune it for speed or</span>
<span class="token comment"># accuracy. By default Redis will check five keys and pick the one that was</span>
<span class="token comment"># used least recently, you can change the sample size using the following</span>
<span class="token comment"># configuration directive.</span>
<span class="token comment">#</span>
<span class="token comment"># The default of 5 produces good enough results. 10 Approximates very closely</span>
<span class="token comment"># true LRU but costs more CPU. 3 is faster but not very accurate.</span>
<span class="token comment">#</span>
<span class="token comment"># maxmemory-samples 5</span>

<span class="token comment"># Starting from Redis 5, by default a replica will ignore its maxmemory setting</span>
<span class="token comment"># (unless it is promoted to master after a failover or manually). It means</span>
<span class="token comment"># that the eviction of keys will be just handled by the master, sending the</span>
<span class="token comment"># DEL commands to the replica as keys evict in the master side.</span>
<span class="token comment">#</span>
<span class="token comment"># This behavior ensures that masters and replicas stay consistent, and is usually</span>
<span class="token comment"># what you want, however if your replica is writable, or you want the replica</span>
<span class="token comment"># to have a different memory setting, and you are sure all the writes performed</span>
<span class="token comment"># to the replica are idempotent, then you may change this default (but be sure</span>
<span class="token comment"># to understand what you are doing).</span>
<span class="token comment">#</span>
<span class="token comment"># Note that since the replica by default does not evict, it may end using more</span>
<span class="token comment"># memory than the one set via maxmemory (there are certain buffers that may</span>
<span class="token comment"># be larger on the replica, or data structures may sometimes take more memory</span>
<span class="token comment"># and so forth). So make sure you monitor your replicas and make sure they</span>
<span class="token comment"># have enough memory to never hit a real out-of-memory condition before the</span>
<span class="token comment"># master hits the configured maxmemory setting.</span>
<span class="token comment">#</span>
<span class="token comment"># replica-ignore-maxmemory yes</span>

<span class="token comment"># Redis reclaims expired keys in two ways: upon access when those keys are</span>
<span class="token comment"># found to be expired, and also in background, in what is called the</span>
<span class="token comment"># &quot;active expire key&quot;. The key space is slowly and interactively scanned</span>
<span class="token comment"># looking for expired keys to reclaim, so that it is possible to free memory</span>
<span class="token comment"># of keys that are expired and will never be accessed again in a short time.</span>
<span class="token comment">#</span>
<span class="token comment"># The default effort of the expire cycle will try to avoid having more than</span>
<span class="token comment"># ten percent of expired keys still in memory, and will try to avoid consuming</span>
<span class="token comment"># more than 25% of total memory and to add latency to the system. However</span>
<span class="token comment"># it is possible to increase the expire &quot;effort&quot; that is normally set to</span>
<span class="token comment"># &quot;1&quot;, to a greater value, up to the value &quot;10&quot;. At its maximum value the</span>
<span class="token comment"># system will use more CPU, longer cycles (and technically may introduce</span>
<span class="token comment"># more latency), and will tolerate less already expired keys still present</span>
<span class="token comment"># in the system. It's a tradeoff between memory, CPU and latency.</span>
<span class="token comment">#</span>
<span class="token comment"># active-expire-effort 1</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br></div></div></div></div></div><h3 id="_8-9-aof配置"><a href="#_8-9-aof配置" class="header-anchor">#</a> 8.9 AOF配置</h3> <div class="language-conf line-numbers-mode"><pre class="language-text"><code># 是否用AOF，默认为no
appendonly no：

# 持久化文件的名字
appendfilename &quot;appendonly.aof&quot;

# 以什么策略执行一次保存
# appendfsync always , 在每次修改后都会sync，消耗性能
# appendfsync everysec , 每秒sync一次，可能会丢失1s的数据
appendfsync everysec
# appendfsync no ， 不执行sync，速度最快
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div> <div id="code-demo-4389c344" class="code-demo-wrapper"><!----> <div class="code-demo-header"><button class="toggle-button right"></button> <span class="title">AOF配置</span> <form action="https://jsfiddle.net/api/post/library/pure/" target="_blank" method="post" class="code-demo-jsfiddle"><input type="hidden" name="html" value=""> <input type="hidden" name="js" value=""> <input type="hidden" name="css" value=""> <input type="hidden" name="wrap" value="1"> <input type="hidden" name="panel_js" value="3"> <input type="hidden" name="resources" value=""> <button type="submit" aria-label="JSFiddle" data-balloon-pos="up" class="jsfiddle-button"><svg viewBox="0 0 1170 1024" xmlns="http://www.w3.org/2000/svg" width="228.516" height="200" class="jsfiddle-icon"><path d="M1028.571 441.143q63.429 26.286 102.572 83.143t39.143 126.571q0 93.714-67.429 160.286T940 877.714q-2.286 0-6.571-.285t-6-.286H232q-97.143-5.714-164.571-71.714T0 645.143q0-62.857 31.429-116t84-84q-6.858-22.286-6.858-46.857 0-65.715 46.858-112T269.143 240q54.286 0 98.286 33.143 42.857-88 127.142-141.714t186.572-53.715q94.857 0 174.857 46t126.571 124.857 46.572 172q0 3.429-.286 10.286t-.286 10.286zm-761.142 152q0 69.714 48 110.286T434.286 744q78.285 0 137.143-56.571-9.143-11.429-27.143-32.286t-24.857-28.857q-38.286 37.143-82.286 37.143-31.429 0-53.429-19.143t-22-50q0-30.286 22-49.715T436 525.143q25.143 0 48.286 12T526 568.57t37.143 42.858 39.428 46.857 44 42.857T702 732.57t69.429 12q69.142 0 116.857-40.857T936 594.857q0-69.143-48-109.714T769.714 444.57Q688 444.571 632 500l53.143 61.714q37.714-36.571 81.143-36.571 29.714 0 52.571 18.857t22.857 48q0 32.571-21.143 52.286T766.857 664q-24.571 0-47.143-12t-41.143-31.429-37.428-42.857-39.714-46.857T557.143 488 502 456.571t-67.714-12q-69.715 0-118.286 40.286t-48.571 108.286z"></path></svg></button></form> <form target="_blank" action="https://codepen.io/pen/define" method="post" class="code-demo-codepen"><input type="hidden" name="data" value="{&quot;html&quot;:&quot;&quot;,&quot;js&quot;:&quot;&quot;,&quot;css&quot;:&quot;&quot;,&quot;js_external&quot;:&quot;&quot;,&quot;css_external&quot;:&quot;&quot;,&quot;layout&quot;:&quot;left&quot;,&quot;editors&quot;:&quot;101&quot;}"></form></div> <div class="code-demo-container" style="display:none;"></div> <div class="code-demo-code-wrapper" style="height:0;"><div class="code-demo-codes"><div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment">############################## APPEND ONLY MODE ###############################</span>

<span class="token comment"># By default Redis asynchronously dumps the dataset on disk. This mode is</span>
<span class="token comment"># good enough in many applications, but an issue with the Redis process or</span>
<span class="token comment"># a power outage may result into a few minutes of writes lost (depending on</span>
<span class="token comment"># the configured save points).</span>
<span class="token comment">#</span>
<span class="token comment"># The Append Only File is an alternative persistence mode that provides</span>
<span class="token comment"># much better durability. For instance using the default data fsync policy</span>
<span class="token comment"># (see later in the config file) Redis can lose just one second of writes in a</span>
<span class="token comment"># dramatic event like a server power outage, or a single write if something</span>
<span class="token comment"># wrong with the Redis process itself happens, but the operating system is</span>
<span class="token comment"># still running correctly.</span>
<span class="token comment">#</span>
<span class="token comment"># AOF and RDB persistence can be enabled at the same time without problems.</span>
<span class="token comment"># If the AOF is enabled on startup Redis will load the AOF, that is the file</span>
<span class="token comment"># with the better durability guarantees.</span>
<span class="token comment">#</span>
<span class="token comment"># Please check http://redis.io/topics/persistence for more information.</span>

<span class="token comment"># 是否用AOF默认为no</span>
appendonly no

<span class="token comment"># The name of the append only file (default: &quot;appendonly.aof&quot;)</span>

<span class="token comment"># 持久化文件的名字</span>
appendfilename <span class="token string">&quot;appendonly.aof&quot;</span>

<span class="token comment"># The fsync() call tells the Operating System to actually write data on disk</span>
<span class="token comment"># instead of waiting for more data in the output buffer. Some OS will really flush</span>
<span class="token comment"># data on disk, some other OS will just try to do it ASAP.</span>
<span class="token comment">#</span>
<span class="token comment"># Redis supports three different modes:</span>
<span class="token comment">#</span>
<span class="token comment"># no: don't fsync, just let the OS flush the data when it wants. Faster.</span>
<span class="token comment"># always: fsync after every write to the append only log. Slow, Safest.</span>
<span class="token comment"># everysec: fsync only one time every second. Compromise.</span>
<span class="token comment">#</span>
<span class="token comment"># The default is &quot;everysec&quot;, as that's usually the right compromise between</span>
<span class="token comment"># speed and data safety. It's up to you to understand if you can relax this to</span>
<span class="token comment"># &quot;no&quot; that will let the operating system flush the output buffer when</span>
<span class="token comment"># it wants, for better performances (but if you can live with the idea of</span>
<span class="token comment"># some data loss consider the default persistence mode that's snapshotting),</span>
<span class="token comment"># or on the contrary, use &quot;always&quot; that's very slow but a bit safer than</span>
<span class="token comment"># everysec.</span>
<span class="token comment">#</span>
<span class="token comment"># More details please check the following article:</span>
<span class="token comment"># http://antirez.com/post/redis-persistence-demystified.html</span>
<span class="token comment">#</span>
<span class="token comment"># If unsure, use &quot;everysec&quot;.</span>

<span class="token comment"># appendfsync always</span>
appendfsync everysec
<span class="token comment"># appendfsync no</span>

<span class="token comment"># When the AOF fsync policy is set to always or everysec, and a background</span>
<span class="token comment"># saving process (a background save or AOF log background rewriting) is</span>
<span class="token comment"># performing a lot of I/O against the disk, in some Linux configurations</span>
<span class="token comment"># Redis may block too long on the fsync() call. Note that there is no fix for</span>
<span class="token comment"># this currently, as even performing fsync in a different thread will block</span>
<span class="token comment"># our synchronous write(2) call.</span>
<span class="token comment">#</span>
<span class="token comment"># In order to mitigate this problem it's possible to use the following option</span>
<span class="token comment"># that will prevent fsync() from being called in the main process while a</span>
<span class="token comment"># BGSAVE or BGREWRITEAOF is in progress.</span>
<span class="token comment">#</span>
<span class="token comment"># This means that while another child is saving, the durability of Redis is</span>
<span class="token comment"># the same as &quot;appendfsync none&quot;. In practical terms, this means that it is</span>
<span class="token comment"># possible to lose up to 30 seconds of log in the worst scenario (with the</span>
<span class="token comment"># default Linux settings).</span>
<span class="token comment">#</span>
<span class="token comment"># If you have latency problems turn this to &quot;yes&quot;. Otherwise leave it as</span>
<span class="token comment"># &quot;no&quot; that is the safest pick from the point of view of durability.</span>

no-appendfsync-on-rewrite no

<span class="token comment"># Automatic rewrite of the append only file.</span>
<span class="token comment"># Redis is able to automatically rewrite the log file implicitly calling</span>
<span class="token comment"># BGREWRITEAOF when the AOF log size grows by the specified percentage.</span>
<span class="token comment">#</span>
<span class="token comment"># This is how it works: Redis remembers the size of the AOF file after the</span>
<span class="token comment"># latest rewrite (if no rewrite has happened since the restart, the size of</span>
<span class="token comment"># the AOF at startup is used).</span>
<span class="token comment">#</span>
<span class="token comment"># This base size is compared to the current size. If the current size is</span>
<span class="token comment"># bigger than the specified percentage, the rewrite is triggered. Also</span>
<span class="token comment"># you need to specify a minimal size for the AOF file to be rewritten, this</span>
<span class="token comment"># is useful to avoid rewriting the AOF file even if the percentage increase</span>
<span class="token comment"># is reached but it is still pretty small.</span>
<span class="token comment">#</span>
<span class="token comment"># Specify a percentage of zero in order to disable the automatic AOF</span>
<span class="token comment"># rewrite feature.</span>

auto-aof-rewrite-percentage <span class="token number">100</span>
auto-aof-rewrite-min-size 64mb

<span class="token comment"># An AOF file may be found to be truncated at the end during the Redis</span>
<span class="token comment"># startup process, when the AOF data gets loaded back into memory.</span>
<span class="token comment"># This may happen when the system where Redis is running</span>
<span class="token comment"># crashes, especially when an ext4 filesystem is mounted without the</span>
<span class="token comment"># data=ordered option (however this can't happen when Redis itself</span>
<span class="token comment"># crashes or aborts but the operating system still works correctly).</span>
<span class="token comment">#</span>
<span class="token comment"># Redis can either exit with an error when this happens, or load as much</span>
<span class="token comment"># data as possible (the default now) and start if the AOF file is found</span>
<span class="token comment"># to be truncated at the end. The following option controls this behavior.</span>
<span class="token comment">#</span>
<span class="token comment"># If aof-load-truncated is set to yes, a truncated AOF file is loaded and</span>
<span class="token comment"># the Redis server starts emitting a log to inform the user of the event.</span>
<span class="token comment"># Otherwise if the option is set to no, the server aborts with an error</span>
<span class="token comment"># and refuses to start. When the option is set to no, the user requires</span>
<span class="token comment"># to fix the AOF file using the &quot;redis-check-aof&quot; utility before to restart</span>
<span class="token comment"># the server.</span>
<span class="token comment">#</span>
<span class="token comment"># Note that if the AOF file will be found to be corrupted in the middle</span>
<span class="token comment"># the server will still exit with an error. This option only applies when</span>
<span class="token comment"># Redis will try to read more data from the AOF file but not enough bytes</span>
<span class="token comment"># will be found.</span>
aof-load-truncated <span class="token function">yes</span>

<span class="token comment"># When rewriting the AOF file, Redis is able to use an RDB preamble in the</span>
<span class="token comment"># AOF file for faster rewrites and recoveries. When this option is turned</span>
<span class="token comment"># on the rewritten AOF file is composed of two different stanzas:</span>
<span class="token comment">#</span>
<span class="token comment">#   [RDB file][AOF tail]</span>
<span class="token comment">#</span>
<span class="token comment"># When loading, Redis recognizes that the AOF file starts with the &quot;REDIS&quot;</span>
<span class="token comment"># string and loads the prefixed RDB file, then continues loading the AOF</span>
<span class="token comment"># tail.</span>
aof-use-rdb-preamble <span class="token function">yes</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br></div></div></div></div></div><h2 id="_9-redis持久化配置"><a href="#_9-redis持久化配置" class="header-anchor">#</a> 9. Redis持久化配置</h2> <p>理论参考</p> <blockquote><ul><li><a href="https://myblog.lifeisgg.online/static-blog/database/redis/Redis_theory_note/#_8-redis%E6%8C%81%E4%B9%85%E5%8C%96%E6%9C%BA%E5%88%B6" target="_blank" rel="noopener noreferrer">Redis-RDB理论学习笔记 | LifeAlsoIsGG's Blog (lifeisgg.online)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></blockquote> <p>两种方式</p> <blockquote><ul><li>RDB(REDIS DATABASE)</li> <li>AOF(APPEND ONLY FILE)</li></ul></blockquote> <h3 id="rdb-redis-database"><a href="#rdb-redis-database" class="header-anchor">#</a> RDB(Redis Database)</h3> <p><code>RDB</code>是<code>Redis</code>默认的持久化方案</p> <p>手动触发执行命令<code>save</code>或<code>bgsave</code>即可，设置自动触发则在<code>redis.conf</code>中的快照配置中配置<code>save</code>触发机制</p> <p><code>save</code>和<code>bgsave</code>的区别</p> <p><img src="/assets/img/The_difference_between_save_and_bgsave.f4da06d6.jpg" alt="save和bgsave的区别" loading="lazy"></p> <p>设置自动触发的<code>redis.conf</code>在快照配置里面</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment">################################ SNAPSHOTTING  ################################</span>
<span class="token comment"># 如果900s内,如果至少有一个1个key进行了修改,我们就进行持久化操作</span>
save <span class="token number">900</span> <span class="token number">1</span>
<span class="token comment"># 如果.00s内,如果至少有一个10个key进行了修改,我们就进行持久化操作</span>
save <span class="token number">300</span> <span class="token number">10</span>
<span class="token comment"># 如果60s内,如果至少有一个10000个key进行了修改,我们就进行持久化操作</span>
save <span class="token number">60</span> <span class="token number">10000</span>


<span class="token comment"># 持久化操作失败是否还继续</span>
stop-writes-on-bgsave-error <span class="token function">yes</span>


<span class="token comment"># 是否压缩rdb文件，是的话会消耗一定CPU资源</span>
rdbcompression <span class="token function">yes</span>


<span class="token comment"># 保存rdb文件的时候是否校验rdb文件</span>
rdbchecksum <span class="token function">yes</span>

<span class="token comment"># 存储的文件名</span>
dbfilename dump.rdb

<span class="token comment"># Remove RDB files used by replication in instances without persistence</span>
<span class="token comment"># enabled. By default this option is disabled, however there are environments</span>
<span class="token comment"># where for regulations or other security concerns, RDB files persisted on</span>
<span class="token comment"># disk by masters in order to feed replicas, or stored on disk by replicas</span>
<span class="token comment"># in order to load them for the initial synchronization, should be deleted</span>
<span class="token comment"># ASAP. Note that this option ONLY WORKS in instances that have both AOF</span>
<span class="token comment"># and RDB persistence disabled, otherwise is completely ignored.</span>
<span class="token comment">#</span>
<span class="token comment"># An alternative (and sometimes better) way to obtain the same effect is</span>
<span class="token comment"># to use diskless replication on both master and replicas instances. However</span>
<span class="token comment"># in the case of replicas, diskless is not always an option.</span>
rdb-del-sync-files no

<span class="token comment"># The working directory.</span>
<span class="token comment">#</span>
<span class="token comment"># The DB will be written inside this directory, with the filename specified</span>
<span class="token comment"># above using the 'dbfilename' configuration directive.</span>
<span class="token comment">#</span>
<span class="token comment"># The Append Only File will also be created inside this directory.</span>
<span class="token comment">#</span>
<span class="token comment"># Note that you must specify a directory here, not a file name.</span>
<span class="token comment"># rdb文件保存的目录</span>
<span class="token function">dir</span> ./
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br></div></div><h2 id="_10-redis发布订阅"><a href="#_10-redis发布订阅" class="header-anchor">#</a> 10. Redis发布订阅</h2> <p>参考</p> <blockquote><ul><li><a href="https://www.runoob.com/redis/redis-pub-sub.html" target="_blank" rel="noopener noreferrer">Redis 发布订阅 | 菜鸟教程 (runoob.com)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://redisbook.readthedocs.io/en/latest/feature/pubsub.html" target="_blank" rel="noopener noreferrer">订阅与发布 — Redis 设计与实现 (redisbook.readthedocs.io)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></blockquote> <p>Redis 发布订阅 (pub/sub) 是一种消息通信模式：发送者 (pub) 发送消息，订阅者 (sub) 接收消息。</p> <p>Redis 客户端可以订阅任意数量的频道。</p> <p>下图展示了频道 channel1 ， 以及订阅这个频道的三个客户端 —— client2 、 client5 和 client1 之间的关系：</p> <p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAT8AAADGCAIAAAArLhCZAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAbvklEQVR4nO2dbXAb1bnHHwdamoZaIuC8FL+smwklDqDNW7HJgNa9xLlpJ5FCktq5c0FWMswFnIlt4EPSApahEHcGapnBhXuZxDLcju3GECmZGwan4FW5waaJ7Q1gpZRJvbZEnVhNtFZruGlpdD+svV7JerMleXVWz2/8Qd49e86zZ/XXc86z5yUrEAgAgiAEskBpAxAEmSOoXgQhFVQvgpAKqhdBSAXViyCkgupFEFJB9SIIqaB6EYRUUL0IQiqoXgQhFVQvgpAKqhdBSAXViyCkgupFEFJB9SIIqaB6EYQk5BPyUb0IQiqoXgQhFVQvgpDK9UobgMwRp9MZTzKdTqfValNtDKIIqN40guO48fFxQRA4jgMAlmUDcG1o6E8jw57kFpRfkFtY+L0sWMAwDADQNK3VajUaDU3TyS0ISSlZuKbk/MPz/PDwMMuyPM/zPP+Pa1+d/t1H8gRL8xbfcuuNAbhWVJIrHvl29g1UUc7MrHJys3Pysmce97r9Xo8/TNEu75f+q+JnV48nCxb85Yu/XXJfkae5Q7fqlpuWUhRFURRN0zqdjqKoOd0oknwCgUBWVpb4GdU7H3Acd+7cOZ7nu9n3OY4bF/wAsCT3pltyFxUU5SzS3CCJU/xXESNdPR6YkvfE+NVhl/cvnokxjw8ANNpsmqZLmR9SFKXT6dBFKwiqN+XwPO9wODiOuzD0+QfO0+LBwqJl+UWLC1bnUEU5Cqp0trh6PLzLOzzovfzFl5/28OLBe/UbVxSupGlar9ejmOcTVG+qcDgcLMu+bX9rhHcvyl5IFeXkF91Mrc4pKMqhVodp95IIP+gddnn5Qe+I6zLv8k74v8qn8h4w7mAYxmAwKG2d+kH1JhOe551Op91ut9vtAFBYtOz24uUbNq+Quqzqhh/0nu260PcuP+S6CADbjFt/yPyLwWDArnKKQPUmAY7jWltb32ff+5j75MbshbcXf3fD5hVFxblhY0iZgNftd/V6zrx74Q+9f/6b/6sCKn+78QGTyYTt6uSC6p07PM+3tra22I4M8yNLcrXrygozx83Gj6tHlPHokOtiAZVvrtxjMpnQGycFVO9ccDgcR2yHj9tPLMr+1n07V+l3FammK5s6vG7/ycMDfV38mMenZ+4TZay0UWSD6p0dra2tdZZnhvmRDWUr79t1+4bNK5S2iDzOvHvBedR1tutCAZVfb3nWYDDgCLC5geqNl6ampjpL3bgwrt9ZtLO2OGP7tMnC6/Z3Nvb2dfHXLbi+tubxuro6pS0iD1RvbOx2e01t9TA/srO2eMueNaS8myWCifGr7xwZeOfwuVsW59RbnsW29KxA9UaD5/lKs8nJ/g79bUoR/bCz06Vn7rO1tGJMK05QvRGx2+2VZtNN3/3WIy9twqDUPMAPel974pTvz/9Xb3m2urpaaXMIANUbHrPZbLPZtuxZs7O2GJvK80lnY29nY29lZWVLS4vStqQ7cvXi7HwAAEEQTJUPHn2749GXykwW/XxJd+LDKmtF1WfCvBQ2G6IYNurItzr6k1zeztriJ17fevTtdsP2bYKQfvWRrqB6AQBM5ofeOtb5dMcD+l1FStuSzow68jvaUpP1hs0rnu7Y8d77p4zbcbB0vKB6oaam5r33f/t0xw7s6EZj7LOmlElXhFqd83THjrP9Z2pqalJZjnrIdPWyLNvU1PRQ3b0o3ciMOvKtFevf6YHb9r+yMaUlUatzHqq7t6mpiWXZlBakDjJ9ZZxnLE+tLs5PcYNZ3uDc+NzIhpWRE5S88nD1tkXTZ/rPVBhPS//Jzk58WPX6y7DltTpoXf9Oz+zOwnSaEzNzDs9kgv4zL8d/33NCv6vI1eOpNJv4oeEUF0U8Ge177Xb7B87Tj7x0fwrLCG1wnn46/8znQSn8zqrpBD37Xm86PiF+Fo6flEs35CwAwIl3HpkS5+zOjn3WlD8tXfFsxa9GI9zDcsNITXRtJ5edtcXD/IjNZpu3Egklo32v3W5fXZyfyvEYEx/Wv9Mj82zC8ZOP7Dvt6t+wcu1UkhOn27ZueW3k+1qY9LQ9Hn81LAIYde77Y7CvHnXkd7S96zFt+/70EOED5e2PLZ/K+Y9T10Y/G2oVAHz+K+vTDR2O4hrDWlCcnLzs1cX5LMtWVlYqbUtak9G+t9v5/qqS76ayBL/3BMCBckkk2m0/ah8JUcht++um1Lg2dzcADPoFANHjtU9Kd+LDKmtFmKDRxuceWz6V8xrZtVHPjnnOBFsFACsfe3j/VmjrjeR+55t1mwvfZ99T2op0J6N97wjvriy+O4UFjPl5gJLcqL5964qiJdI/2Tlb5Zd/1iRr+oa7NlsWagu+NubZho6Khpk5+gVYng5zf6iiHPdwXAtWZzIZ7XvTm1GHLODUPlLTPlK+O9VlnvB7U10Ekjwy2vcCwMTU4sYpYUk2BdAW0heNk35PG8Bue6o6ojGDzMqS2ueiFjLa996pu0NcxDhlZOdsBWjomB5aOPZZU741cnQ3FFlHNHnjnJbkbtgKPfteDxrw2H+mYjaGpRpXj+eOu3DcWwwy2vc+YNzx2pGXTRZ9ykpYdE/dljMn3mkzWmXCu23/zuWxL12buxugbWbv9ITf2wyJdU3DWhW3YfPCHz4a3XZ/udJWpDsZ7XsrKysvuX3Oo64UlrHk+9VB/dWNz4386J4lkdNPs9wQ3NHdba957gAAeL1jSbHq4f3yONbWLa/Fa1jKcfV4hgYv4uuimGT6DMGHTP/e1X3yhZMVOCUwfdi/0ba59MdvtP630oakIzi/dxqe53W0bk1Z7qMvlSltCwIA8OoTXQNd7nPcx7jaRlhwfu80FEU57A7nUdfJwwNK24KA86jLedTVansDpRsPma5eAGAYpqWl5Y165xv1ODxASTobe199oqulpcVoNCptCxlkdMxZQgyQmM3mCf/Vh56Zt7U1kEkmxq++8azTedTV0tKCwar4yfR+rxyWZQ1Gw7eyFzz+Xz/G6b7zBj/o/c8n37vs+bLV1opeNybY7w0PwzDD/PDt37vzwJZfdzb2TozjcJ/UMjF+tbOx98CWX+fdsvIcdw6lO1vQ94bBarXWWZ65Bl/vqP3Blj1rlDZHnTg7XW/Wf7AArq+3PItL4cQPvjGKjSAIVqu1vr5+SZ52R+0P9Dtx1F7ScHa63mr8/ZhbqK6utlgsuKHRrED1xgvP8xaLpbW19UbNwn/do8MtURJB3ADlfzv/eNF9xWQyWSwWfC00B1C9s0P0w43WX/rH/6rfVbRh84r1ZbiN4Cxw9XicnS7nUVe25ju1NY9XVlaibucMqncuCIJgt9sbrb/8+NwnS/NuWldG3bcTt/CNBj/oPdt14YPOzy65fXfp7qytedxoNGI7OUFQvQnB87zVan3b/pZ72LM076bbi5dv2Lxi1d252KgWOdt14cy7F/7QO3rJ7cvWZJsrzTU1NehskwWqNzlwHGe329+2v/XJuU8BYHVJ/vrNhes3rRCXufO6/a6PPPynXvXtiiS+6aHuyClYlSO2Prxu/9lTF873/Pn3734OAHfq7njAuMNoNNI0rbSxagPVm2TERjXLskc7f/PlxFc3LPzGP/957eu//xMAHn2pTJW7q5x598JLD58AgOu/ed111y24+tU/vr1o4ab7y4xGIzaPUwqqN2kIguB0OjmOY1k27PL/N2oW5hfdXFScS63OueXW7JT2k71uf0p3G/a6/cPnvfyg19XrueL58qL7ysw0DMMwDEPTtF6vRw2nAlRvQvA8LymW47hIyTZu3Pjzn/+cZVme5/sGznz68eQaAKtL8guKbi5YnZOTm11UnJtEw579Seczv9mZxAxdvR6vxz886B12XR7sGREP3nFX0bo1GyiKYhjmqaeeOn36dKTLaZqmaZphGL1ej/3eZIHqnQs2m83hcHAcx/N8zMQajYbn+RDnIyqZ47gBrv93zg+k4yvuuPWG72Tl5Gbn5GYDQFFJLgDk3Jo9K0fKD3oPbPn1Mx07xcvjxOv2e7/wA4C4vpfX4/d6/Ff/Grjw6RdSmvv0966h11IUJUpRfrkgCDRNDw/H3rJEq9UyDGMwGHASQoKgeucCy7KlpaVxJh4YGIgZsOF5XhSzIAiCIHAc93Xg6ifnBv3jf5XS3KhZSBUtvQZfS0ckkYfwp08u9f92aPU9uavuDqNeUZbSvwvget516W/jX8nTbLyv+PqsG2ia1mq1Wq1W/BDzLjiOYxhmfHw8ejKRY8eO4WDmBEH1zhGj0ehwOGImS3yamyhsAJD3pUP61f+49hUAuIe/cI98ATPIy781r+BWAPjGgoXy46Imxc+iI6UoKsFmrc1mM5vNMZMZDAa73Z5IQQgEqxcCSNz4fD6NRhO9ck0m0/wb1t3dLRlw7Nix+Teguro6erVoNJqhoaH5N0x9XLt2TfqMMwRngVartVgsURLodDpFdr6TF6qIf7NarTqdLkoCHNWcClC9syNKhEaj0SjVMpSXG0/bPhWwLBulYTI8PCwIQqSzyBxRsA1AFjEDUd3d3YoYduzYsRBLWlpaFLFkYCDayn40TQ8MDChimJqQt5xRvXFhtVqlb6FGozGZTCFfzcbGRqVsm2mMwWBQypiWlpYQY0wmk9wnWywWpWxTB6jeWeDz+eQvOQwGg8/nCwQCBQUF8i+oguaFHdIkGqkI8l+TgoICn8/n8/kMBoN00Gg0Kmge6aB642VgYECKtWg0GrmDlcK8Op1Owe/iTF8nolTjORAI+Hw+KYIl7020tLRITpiiKGxFzw1Ub1zIW8s6nW7mt01sEyr7LZT7tDRpPAcCgaGhIY1GM9OGgYEBeWjaarUqYh7RoHpj4PP55MMtTCZTWO/q8/kUebkqNyCsdBVvPAcCge7u7kiVJm9aV1ZWYit6VqB6o+Hz+aTYskajUbAJGpNIzWYRBQNpMZG3ommaxoEc8YPqjcjAwIAUBCooKEjzvlmkZrOkCqUNjMbAwIAU+dNqtUq9byMOVG945K5M2VhUPAwNDUWRrkia+zSfz6fXT299ns7NnPQBR0qGob6+XhpqbzKZOI5L88nl8YzrSvNZAVqtlmVZaYy02Wyura1V1iTCUPBXJH2Qx6hI8QDRxxWLpHnjWULe6qmsrFTanLQGW87T+Hw+aca5RqNRNoacCGITVK/XK23IHOnu7pbiWAzDpHm3RUGw5TyJIAilpaXivFmNRsOyLM4dVwqGYaR5DuJCCDirISaZq15RuuLCVDqdjuM4XL5UWWia5jhO7BFwHIcCjkmGqjdEuizL4uzTdICiKJZlUcBxkonqnSndNA8vZxRiIFoS8Jo1a6Is3JnhZJx6Ubrpj1zAPM+bzWb0wGHJLPWidElBFLA4mAyb0JHIIPWidMlCq9XabDbsA0chg9S7fft2lC5ZhPSB419PO0PIFPWazWbxvS5KlyxCBBzPwtGZQ0ao12q1imumiss+onTJQhSwOJDDZrNFX5Q3o1C/em02mzj2XRxNhe91SUQu4Pr6ekUWzU5DVK5ejuOkaStWq3UOo6l6G7Kyshp6k22YnIvtFVlZFe0X56k4OQTdHU3Tkmhra2uT+BKYoEoIQc3qFQRBelXY2Ng4+72FehuyskoOpsAyLG5OGI3GxsZGABAEYfv27ckIQZNXCUEoOFsi1UhyTWSJtp5DAHCoJ4lmpaa4uc0xIuXu5EjLYhmNxvSxat6Ky4g5RlKkqqCgIJFuEkWVJ8skLC4pxUl7Jtntdvm6n3OGxEoQUad6OY6rr6+HMEHm3oasSRp6exsaemVHGnphsoOSFa5jIqWb7L5EzDDMKXl2U90esaSK9ovikeBcIxY3bWDYvtOI06niuxMRR3GIEaxwHWCVP+IgktIYSDek6FTwuoqjbeXlbaOT//Qcmm6/BDdmgv4bbSsHKC8vnzww2lYO02cjZhgYbSuHqVPiNeVto1NXAxw6dKi8raetHKDifvHIZOKoxQVG26ZOiEbKGmB6fQkArCrRq/LuZiItx0HTtGwqv5ofsYjK19aQ1kma0d0NqvxAoOdQ+Ec72lYe+mil5zeVWDwSKUP5gw3NX3xa8mciLyJWcdPXheSj168BgMI1elXeXVikJTWrq6vl+an1EYuoWb3SBiUajWbm6irir9nMb0WsRxucXpY6fIZhrol2csajjVDcVGFypG+BbHFGFd5dWOSboUsLyqr4EYuoOWoljaSz2Wwzx1QVHxDr7mBJmO7GXEh6hrEI/cK0VyyTny5ZlaPiuwtBq9VKi2ZKrwZV/4jlqEq9FouF53kAMJlMkVaoWlbRPvX717F7+ZxfmpdLQ7YiZXiQTeL7f6k4jo/67fnmkiIV391MGIYRO0o8z0sjKNX9iOWoR73yOHOEFwnTAcNlFe2BnkPRairymV72IJQbmWWRM1zGGMsBDpYE/VCHRCvjZrq4YuYQdOy2yXK52N4wXYRfOqzGu4uIxWIR92Roampi2V+p+hGHoh71Rm8zTxJS3UBTywAmX8FNPszehuW7OwA6di+fjtdPP+eL7RUlBw/1SK2Z8Bkuq6g5BGIeEiXAFMd5K5GKK65sK4eDJZN2XWyvWM4zwc0q19jfVXx3YdFqtdKPdW2tVfWPOIjw/W7SkN4fRB1W1dPWNiqLC8wICk4eDQ0KBoUSgnolUTKUZzl9Sp5VcFAEpCIjFxeSa9A5Mea8plCddxcTKf784IP1an3EIvKoVVYgEADCEQShsLBQDFoMDQ1l5iwihmGcTqderxenMWcaPM/TND0+Pq7VaoeGhlQ8CTQQCGRlZYmf1dBytlqtonTr6uoyU7oIRVE1NTUAIAhC5kwAJt738jxfWFgIABqNhud5Ff/oRifDfS8ACIJA0/Tw8DCougmmKt8rBausVmvGSheB4PBVhiygQ7Z6WZYVXY1er5/99F1EbRiNRnHMGcuyab77aVIgW73ST2zmdHWQ6MjeHql/K2CC1Wuz2aSRVdIunkiGQ9O0OH2f5/mkzP5NZwhWrzSyCh0vIsdqtUrr16l7AXdS1Ss53pqaGrVGF5G5odVqpbdH6na/pKpXcrzic0IQOTU1NaL7bWpqUrH7JVK9cseLb4mQmWSI+yVSveh4kZhkgvslT73SJF50vEgUMsH9EqZeQRCampoAHS8SB6p3v4Sp1263i48BHS8SE9W7X8LUiz1eZFZI7re1tVVpW5IPSeqVQs1GoxEdLxIPkvvleV59Ow+SpF7p5xMHVyHxI01fESMmaoIY9UrTiUwmEw6uQuKHoihx5DPHcSqb/EyMeqVmD84ERGaLFCUR4yaqgQz18jwvNpv1ej1OJ0JmC03T0rxfMXSiDshQr9TRRceLzA3pK6SmoAkB6hUEweFwAEBBQQGqF5kbDMOIi7a3traqZuQGAeqVj9BQ2haEYCSvq5pXRwSoVwr0o+NFEsFoNEoDJ5W2JTmku3o5jhM3RzeZTDhCA0kErVYr7k3H87w6Xh2lu3ql4anoeJHEkTpf6mg8p7V65fEqfFGEJA5N0zqdDtQSu0pr9dpsNoxXIclFVe5X2o+su7tbaVuUpK6ubhZb1kVA6ZtQmMQrsK6uTumbUJLu7u6YVSTfQ/D6kOurX/yNInYrS+erlmRldXfZruKyXcnKjRR6u45+1HU0KVlRK1cb/iMTNdz05E9me0moem/TlSTJGJL49qLsZGV189LcDKzDz8/1JCurRd/RZGAFzo207vciCBIFVC+CkAqqF0FIBdWLIKSC6kUQUkH1IgipoHoRhFRQvQhCKqheBCEVVC+CkAqqF0FIBdWLIKSC6kUQUkmdesfOPp9X9bzDH/o5FfR3bcqrkv5SWNB8Mn8V6O+uqpJX4Ka8qk15XedTU9j8MZ/fQIn+rnmsOvJ8r7+7qmpT85D0/xXHkU0GhzwFu+/gpqqzV+bdMkIIrUCAy5eOK2YNgcyswCn6u0K+iikmdH5valiy/mfu9UnK6/Kl4wBFU/+NnX11Xx9sM3c0r188dex8c9X+hpauvesr1iapTMVJXQUCwNjlCwDMK4d+ZkjaLOe0I6UVCAAAVxxHyvf1JamIOCHP9wbjucIC7N07LV0AWLXLzAAc7gn364jMxHOFBViRp17pppr+rk15VeX7+mCb+acH5rPgxNUr73OGbU5AuF7H2Nnnp7tYR7rHwiS+4jgSmmDs7PN5Lx4GgIYXN+VVtfcDrC075W4O62OZ3JsTvrd5QdkKBLji9gCsW5qbottLPUpXIAAArPtpX/Op5vXLkn97UUhMvaF9zoYXI1ZfyFXrWtjpA30vrJNXBAAAu++grB3S98K64PqNyvmjLSwhziQdKvCSpw8gd5lnWgMEhf3SoQJhbdkp957SJbOxOzkk0u8V+5yw7qd9oun+7qqDLzR8fr6qcNUsrgKAofa8Fw8bunTuMvmFex2iU/V3Vx184XjfJc8eWLv+Z+6bV+S9ePjAk6eqCsPn39+1vwHgwJMEdHrTogL9F10A4NhvmL6Q3XeQ7QoKJaQpaVGBCpKI7xX7nA6pCrJLm5tPBd//TK70fBx8FQAUVvSZGXCck//4Tcsvu3SvAQAuuONwCGLQb5u5Q/majYO0qEAx4Gx42d18auqv45V1cLylqz9c8rQiLSpQQRLwvYn0lw4bqg7PPOr2w9rJ5m5QrzV3MROPPWLQbxsJTgMA0qUCCyvczRXBhxYbSvfu6zvcM1SxNq1/BNOjAhUknWLOrOfyXC/1d1dVle/rgwNPniJEuqkggQpEAMirwAR87+K8XADHJc8emHV/Xd7lSByxW0LeG8u0qMD+rk0GR2jViW+A0z5onxYVqCSJ+N7cxQzAYcP0uDAxwt4etb+0uOQuBvpeWBc0mux8c1XMC4NwXZ4aSjUp3b2OZrKkC5AeFbh25V4Adl9vUG5HW1hYd09J2tdnOlSgkiQSc16y/tFXPmb3OfbnyUL228xl0YO9Ya+K58JJbl66DeB4S/nxlr2O5grofeE4QNhuTFpEBaOSDhW4trDCYThsCM2NeWUnAa4pLSpw9mYnjcT6vYsNe045ZK8a4ut2LjbsOdVnZmRHmFcOxd1fnQwAAsAFt/98z3wOK00+ilcgAMDaspDcCGrIpEUFKkaWtPMdy7KlpaXNp9yK2qMM1id2/dv2zRaLJcF8srKyfvRg7Y8fejwZRpHE/7zxy5NvNia+i6LFYuk8ceqxX3QkxSqyqNqU193dHXOf6kAgkJWVJX5Op5gzgiCzAdWLIKSC6kUQUkH1IgipoHoRhFRQvQhCKqheBCEVVC+CkAqqF0FIBdWLIKSC6kUQUkH1IgipoHoRhFRQvQhCKqheBCEVVC+CkAqqF0FIJXRdq6pNeYrYoTzbNyclm5NvNp58szEpWWUmg/0fZu6XcJZMr4wjCALHccpaoyAURVEUlWAmLMsmwRRiibmqS0x4nud5PgmmkAlN01qtNnoa+co4WYmvRYQgyLyB61ohiBpA9SIIqaB6EYRUsN+LIKSCvhdBSAXViyCkgupFEFJB9SIIqaB6EYRU/h+RPM8aLzXFqQAAAABJRU5ErkJggg==" alt="订阅" loading="lazy"></p> <p>当有新消息通过 PUBLISH 命令发送给频道 channel1 时， 这个消息就会被发送给订阅它的三个客户端：</p> <p><img src="/assets/img/publish.376797ce.png" alt="发布" loading="lazy"></p> <table><thead><tr><th style="text-align:left;">序号</th> <th style="text-align:left;">命令及描述</th></tr></thead> <tbody><tr><td style="text-align:left;">1</td> <td style="text-align:left;">[PSUBSCRIBE pattern <a href="https://www.runoob.com/redis/pub-sub-psubscribe.html" target="_blank" rel="noopener noreferrer">pattern ...]<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 订阅一个或多个符合给定模式的频道。</td></tr> <tr><td style="text-align:left;">2</td> <td style="text-align:left;">[PUBSUB subcommand <a href="https://www.runoob.com/redis/pub-sub-pubsub.html" target="_blank" rel="noopener noreferrer">argument [argument ...]]<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 查看订阅与发布系统状态。</td></tr> <tr><td style="text-align:left;">3</td> <td style="text-align:left;"><a href="https://www.runoob.com/redis/pub-sub-publish.html" target="_blank" rel="noopener noreferrer">PUBLISH channel message<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 将信息发送到指定的频道。</td></tr> <tr><td style="text-align:left;">4</td> <td style="text-align:left;">[PUNSUBSCRIBE <a href="https://www.runoob.com/redis/pub-sub-punsubscribe.html" target="_blank" rel="noopener noreferrer">pattern [pattern ...]]<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 退订所有给定模式的频道。</td></tr> <tr><td style="text-align:left;">5</td> <td style="text-align:left;">[SUBSCRIBE channel <a href="https://www.runoob.com/redis/pub-sub-subscribe.html" target="_blank" rel="noopener noreferrer">channel ...]<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 订阅给定的一个或多个频道的信息。</td></tr> <tr><td style="text-align:left;">6</td> <td style="text-align:left;">[UNSUBSCRIBE <a href="https://www.runoob.com/redis/pub-sub-unsubscribe.html" target="_blank" rel="noopener noreferrer">channel [channel ...]]<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 指退订给定的频道。</td></tr></tbody></table> <h3 id="订阅端"><a href="#订阅端" class="header-anchor">#</a> 订阅端</h3> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token comment">#订阅一个频道</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> subscribe channelDemo
Reading messages<span class="token punctuation">..</span>. <span class="token punctuation">(</span>press Ctrl-C to quit<span class="token punctuation">)</span>
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;subscribe&quot;</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">&quot;channelDemo&quot;</span>

<span class="token comment">#等待读取信息</span>
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;message&quot;</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">&quot;channelDemo&quot;</span>
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">&quot;message1&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h3 id="发送端"><a href="#发送端" class="header-anchor">#</a> 发送端</h3> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> publish channelDemo message1
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>更多请参考</p> <blockquote><ul><li><a href="https://redisbook.readthedocs.io/en/latest/feature/pubsub.html" target="_blank" rel="noopener noreferrer">订阅与发布 — Redis 设计与实现 (redisbook.readthedocs.io)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></blockquote> <h2 id="_11-redis集群配置-主从复制配置"><a href="#_11-redis集群配置-主从复制配置" class="header-anchor">#</a> 11. Redis集群配置-主从复制配置</h2> <h3 id="_11-1-查看当前库信息"><a href="#_11-1-查看当前库信息" class="header-anchor">#</a> 11.1 查看当前库信息</h3> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> info replication
<span class="token comment"># Replication</span>

<span class="token comment"># 角色</span>
role:master

<span class="token comment"># 从机数量</span>
connected_slaves:0

master_replid:a8d691a368c6b581987c7502f0ec91b89edf812f
master_replid2:0000000000000000000000000000000000000000
master_repl_offset:0
second_repl_offset:-1
repl_backlog_active:0
repl_backlog_size:1048576
repl_backlog_first_byte_offset:0
repl_backlog_histlen:0
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> 

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><h3 id="_11-2-redis-conf配置"><a href="#_11-2-redis-conf配置" class="header-anchor">#</a> 11.2 <code>redis.conf</code>配置</h3> <p>这里以docker创建不同的容器来运行不同的<code>redis.conf</code>为例，<code>redis.conf</code>文件名称不能一样，主要修改以下几项（这里默认不开启<code>appendonly</code>，所以不需要修改生成的<code>appendonly</code>文件名）</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token comment">#端口号</span>
port <span class="token number">6380</span>

<span class="token comment">#pid文件不能相同</span>
pidfile /var/run/redis_6380.pid

<span class="token comment">#日志文件不能相同</span>
logfile <span class="token string">&quot;/var/log/redis-6380.log&quot;</span>

<span class="token comment">#RDB文件名</span>
dbfilename dumb-6380.rdb

<span class="token comment">#存放RDB和AOF的文件夹尽量也修改</span>
<span class="token function">dir</span> ./data/redis-6380

<span class="token comment">#当master设密码时，slave需要设置连接master的密码</span>
masterauth <span class="token number">123456</span>

<span class="token comment">#说明它是哪个master的slave，salveof 主IP（必须是真实IP，而不是本地127.0.0.1） 主服务端口</span>
replicaof <span class="token number">127.0</span>.0.1 <span class="token number">6379</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p>也可以通过<code>salveof</code>命令让当前redis实例成为某个redis实例的slave</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>slaveof <span class="token number">127.0</span>.0.1 <span class="token number">6379</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>从服务器比主服务器多一个<code>slaveof</code>的配置和<code>masterauth</code>密码</p> <h3 id="_11-3-启动容器"><a href="#_11-3-启动容器" class="header-anchor">#</a> 11.3 启动容器</h3> <p>启动<code>master</code></p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token function">docker</span> run -p <span class="token number">6379</span>:6379 --name redis-6379 -v /usr/local/docker/redis/redis-6379.conf:/etc/redis/redis-6379.conf -v /usr/local/docker/redis/data/redis-6379:/data/redis-6379 -d redis redis-server /etc/redis/redis-6379.conf
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>启动<code>slave-1</code></p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token function">docker</span> run -p <span class="token number">6380</span>:6380 --name redis-6380 -v /usr/local/docker/redis/redis-6380.conf:/etc/redis/redis-6380.conf -v /usr/local/docker/redis/data/redis-6380:/data/redis-6380 -d redis redis-server /etc/redis/redis-6380.conf
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>启动<code>slave-2</code></p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token function">docker</span> run -p <span class="token number">6381</span>:6381 --name redis-6381 -v /usr/local/docker/redis/redis-6381.conf:/etc/redis/redis-6381.conf -v /usr/local/docker/redis/data/redis-6381:/data/redis-6381 -d redis redis-server /etc/redis/redis-6381.conf
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>启动后在<code>master</code>中再次调用<code>info replication</code>如下</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> info replication
<span class="token comment"># Replication</span>
role:master
connected_slaves:2
slave0:ip<span class="token operator">=</span><span class="token number">127.0</span>.0.1,port<span class="token operator">=</span><span class="token number">6380</span>,state<span class="token operator">=</span>online,offset<span class="token operator">=</span><span class="token number">3374</span>,lag<span class="token operator">=</span><span class="token number">0</span>
slave1:ip<span class="token operator">=</span><span class="token number">127.0</span>.0.1,port<span class="token operator">=</span><span class="token number">6381</span>,state<span class="token operator">=</span>online,offset<span class="token operator">=</span><span class="token number">3374</span>,lag<span class="token operator">=</span><span class="token number">1</span>
master_replid:2f92baa3754bfd24b42113cfabd498396bfa736b
master_replid2:0000000000000000000000000000000000000000
master_repl_offset:3374
second_repl_offset:-1
repl_backlog_active:1
repl_backlog_size:1048576
repl_backlog_first_byte_offset:1
repl_backlog_histlen:3374
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>在<code>slave-1</code>中如下</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token number">127.0</span>.0.1:638<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span> info replication
<span class="token comment"># Replication</span>
role:slave
master_host:47.100.59.153
master_port:6379
master_link_status:up
master_last_io_seconds_ago:7
master_sync_in_progress:0
slave_repl_offset:5008
slave_priority:100
slave_read_only:1
connected_slaves:0
master_replid:2f92baa3754bfd24b42113cfabd498396bfa736b
master_replid2:0000000000000000000000000000000000000000
master_repl_offset:5008
second_repl_offset:-1
repl_backlog_active:1
repl_backlog_size:1048576
repl_backlog_first_byte_offset:1
repl_backlog_histlen:5008
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p>在<code>slave-2</code>中如下</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token number">127.0</span>.0.1:638<span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span> info replication
<span class="token comment"># Replication</span>
role:slave
master_host:47.100.59.153
master_port:6379
master_link_status:up
master_last_io_seconds_ago:9
master_sync_in_progress:0
slave_repl_offset:5078
slave_priority:100
slave_read_only:1
connected_slaves:0
master_replid:2f92baa3754bfd24b42113cfabd498396bfa736b
master_replid2:0000000000000000000000000000000000000000
master_repl_offset:5078
second_repl_offset:-1
repl_backlog_active:1
repl_backlog_size:1048576
repl_backlog_first_byte_offset:771
repl_backlog_histlen:4308
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><h3 id="_11-4-验证主写从读-主从宕机"><a href="#_11-4-验证主写从读-主从宕机" class="header-anchor">#</a> 11.4 验证主写从读/主从宕机</h3> <p><code>master</code>写入数据时，其它<code>slave</code>通过<code>增量复制</code>会同步<code>master</code>中的数据</p> <p>当<code>slave</code>写的时候提示只能读</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token number">127.0</span>.0.1:638<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span> <span class="token builtin class-name">set</span> k1 v1
<span class="token punctuation">(</span>error<span class="token punctuation">)</span> READONLY You can't <span class="token function">write</span> against a <span class="token builtin class-name">read</span> only replica.
<span class="token number">127.0</span>.0.1:638<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span> 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>主从宕机</p> <blockquote><ul><li><p>如果此时<code>master</code>宕机或断开连接，<code>slave</code>还能继续读；当<code>master</code>上线回来后，<code>slave</code>能继续同步<code>master</code>读的内容</p></li> <li><p>如果是<code>slave</code>宕机，那么此时<code>master</code>在期间写，当<code>slave</code>上线回来后会<code>全量复制</code> <code>master</code>的数据</p> <blockquote><p>当<code>slave</code>启动后，主动向<code>master</code>发送<code>SYNC</code>命令。<code>master</code>接收到<code>SYNC</code>命令后在后台保存快照（<code>RDB持久化</code>）和缓存保存快照这段时间的命令，然后将保存的快照文件和缓存的命令发送给<code>slave</code>。<code>slave</code>接收到快照文件和命令后加载快照文件和缓存的执行命令。</p> <p>复制初始化后，<code>master</code>每次接收到的写命令都会同步发送给<code>slave</code>，保证<code>主从数据一致性</code>。</p></blockquote></li></ul></blockquote> <h3 id="_11-5-其他注意"><a href="#_11-5-其他注意" class="header-anchor">#</a> 11.5 其他注意</h3> <p>当把<code>slave</code>从入到另一个<code>slave</code>时，被从入的<code>slave</code>依然不能写</p> <p>如果<code>master</code>宕机想要重新推举出新的master，或者说想让<code>slave</code>脱离<code>master</code>，可以通过以下命令</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>slaveof no one
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>如果需要自动选举，还需要<code>哨兵模式</code></p> <h2 id="_12-redis集群配置-sentinel-哨兵-模式"><a href="#_12-redis集群配置-sentinel-哨兵-模式" class="header-anchor">#</a> 12. Redis集群配置-Sentinel（哨兵）模式</h2> <div class="custom-block tip"><p class="custom-block-title">参考</p> <ul><li>https://www.cnblogs.com/kingyifan/p/11721422.html</li> <li>https://www.cnblogs.com/kevingrace/p/9004460.html</li></ul></div> <h3 id="_12-1-创建sentinel-conf"><a href="#_12-1-创建sentinel-conf" class="header-anchor">#</a> 12.1 创建<code>sentinel.conf</code></h3> <p><code>sentinel.conf</code></p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token comment"># 哨兵提供对外的端口号</span>
port <span class="token number">26379</span>
daemonize no
logfile <span class="token string">&quot;sentinel-26379.log&quot;</span>
<span class="token function">dir</span> <span class="token string">&quot;./data/sentinel-26379&quot;</span>
sentinel monitor mymaster <span class="token number">127.0</span>.0.1 <span class="token number">7000</span> <span class="token number">2</span>
sentinel down-after-milliseconds mymaster <span class="token number">30000</span>
sentinel parallel-syncs mymaster <span class="token number">1</span>
sentinel failover-timeout mymaster <span class="token number">15000</span>
sentinel auth-pass mymaster <span class="token number">123</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>配置详解</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token comment"># 告诉sentinel去监听地址为ip:port的一个master，这里的master-name可以自定义，quorum是一个数字，</span>
<span class="token comment"># 指明当有多少个sentinel认为一个master失效时，master才算真正失效，即客观下线</span>
sentinel monitor <span class="token operator">&lt;</span>master-name<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>ip<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>redis-port<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>quorum<span class="token operator">&gt;</span>

<span class="token comment"># 设置连接master和slave时的密码，注意的是sentinel不能分别为master和slave设置不同的密码，因此master和slave的密码应该设置相同。</span>
sentinel auth-pass <span class="token operator">&lt;</span>master-name<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>password<span class="token operator">&gt;</span>

<span class="token comment"># 这个配置项指定了需要多少失效时间，一个master才会被这个sentinel主观地认为是不可用的。 单位是毫秒，默认为30秒</span>
sentinel down-after-milliseconds <span class="token operator">&lt;</span>master-name<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>milliseconds<span class="token operator">&gt;</span> 

<span class="token comment"># 这个配置项指定了在发生failover主备切换时最多可以有多少个slave同时对新的master进行 同步，这个数字越小，完成failover所需的时间就越长，</span>
<span class="token comment"># 但是如果这个数字越大，就意味着越 多的slave因为replication而不可用。可以通过将这个值设为 1 来保证每次只有一个slave 处于不能处理命令请求的状态。</span>
sentinel parallel-syncs <span class="token operator">&lt;</span>master-name<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>numslaves<span class="token operator">&gt;</span> 

<span class="token comment"># failover-timeout 可以用在以下这些方面：</span>
<span class="token comment"># 同一个sentinel对同一个master两次failover之间的间隔时间。   </span>
<span class="token comment"># 当一个slave从一个错误的master那里同步数据开始计算时间。直到slave被纠正为向正确的master那里同步数据时。    </span>
<span class="token comment"># 当想要取消一个正在进行的failover所需要的时间。    </span>
<span class="token comment"># 当进行failover时，配置所有slaves指向新的master所需的最大时间。不过，即使过了这个超时，slaves依然会被正确配置为指向master，但是就不按parallel-syncs所配置的规则了。</span>
sentinel failover-timeout <span class="token operator">&lt;</span>master-name<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>milliseconds<span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><h3 id="_12-2-使用docker启动哨兵"><a href="#_12-2-使用docker启动哨兵" class="header-anchor">#</a> 12.2 使用Docker启动哨兵</h3> <h2 id="_13-redis集群配置-集群cluster模式"><a href="#_13-redis集群配置-集群cluster模式" class="header-anchor">#</a> 13. Redis集群配置-集群cluster模式</h2> <blockquote><p>通过docker并自定义网络搭建</p></blockquote> <div class="custom-block tip"><p class="custom-block-title">参考</p> <ul><li>https://www.cnblogs.com/catelina/p/13630036.html</li> <li><a href="https://www.jianshu.com/p/813a79ddf932" target="_blank" rel="noopener noreferrer">Redis-Cluster集群<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://www.cnblogs.com/xuchen0117/p/11678931.html" target="_blank" rel="noopener noreferrer">docker部署redis集群<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://blog.csdn.net/x3499633/article/details/88637819" target="_blank" rel="noopener noreferrer">Redis Cluster 高可用集群（Docker 实现）<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div> <p>一般是三主三从</p> <h3 id="_13-1-创建集群网络"><a href="#_13-1-创建集群网络" class="header-anchor">#</a> 13.1 创建集群网络</h3> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">docker</span> network create redis_cluster --subnet <span class="token number">172.38</span>.0.0/16
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><blockquote><p><code>--subnet</code>为子网范围</p></blockquote> <h3 id="_13-2-创建生成redis配置文件脚本"><a href="#_13-2-创建生成redis配置文件脚本" class="header-anchor">#</a> 13.2 创建生成redis配置文件脚本</h3> <p>用于生成自定义的redis配置<code>redis.conf</code></p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 循环6次</span>
<span class="token keyword">for</span> <span class="token for-or-select variable">port</span> <span class="token keyword">in</span> <span class="token variable"><span class="token variable">$(</span><span class="token function">seq</span> <span class="token number">79</span> <span class="token number">84</span><span class="token variable">)</span></span><span class="token punctuation">;</span>
<span class="token keyword">do</span>
  <span class="token function">mkdir</span> -p /data/docker/redis-cluster/node-63<span class="token variable">${port}</span>/conf
  <span class="token function">touch</span> /data/docker/redis-cluster/node-63<span class="token variable">${port}</span>/conf/redis.conf
  <span class="token function">cat</span> <span class="token operator">&gt;</span> /data/docker/redis-cluster/node-63<span class="token variable">${port}</span>/conf/redis.conf <span class="token operator">&lt;&lt;</span> <span class="token string">EOF
port 6379
bind 0.0.0.0
masterauth 123
requirepass 123
cluster-enabled yes
# 注意每个集群的cluster-config-file名称不能一样，官网说实例 ID在集群中保持一个独一无二（unique）的名字。
cluster-config-file nodes-63<span class="token variable">${port}</span>.conf
cluster-node-timeout 5000
cluster-announce-ip 172.38.0.<span class="token variable">${port}</span>
cluster-announce-port 6379
appendonly yes
# 注意该脚本，结束的EOF前面不能有空格，输出的内容前面也不能留空格
EOF</span>
<span class="token keyword">done</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p>之后会生成6个配置文件</p> <h3 id="_13-3-创建脚本通过docker运行"><a href="#_13-3-创建脚本通过docker运行" class="header-anchor">#</a> 13.3 创建脚本通过docker运行</h3> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token keyword">for</span> <span class="token for-or-select variable">port</span> <span class="token keyword">in</span> <span class="token variable"><span class="token variable">$(</span><span class="token function">seq</span> <span class="token number">79</span> <span class="token number">84</span><span class="token variable">)</span></span><span class="token punctuation">;</span>
<span class="token keyword">do</span>
  <span class="token function">docker</span> run -p <span class="token number">63</span><span class="token variable">${port}</span>:6379 -p <span class="token number">163</span><span class="token variable">${port}</span>:16379 --name redis-63<span class="token variable">${port}</span> <span class="token punctuation">\</span>
  -v /data/docker/redis-cluster/node-63<span class="token variable">${port}</span>/data:/data <span class="token punctuation">\</span>
  -v /data/docker/redis-cluster/node-63<span class="token variable">${port}</span>/conf/redis.conf:/etc/redis/redis.conf <span class="token punctuation">\</span>
  -d --net redis_cluster --ip <span class="token number">172.38</span>.0.<span class="token variable">${port}</span> redis redis-server /etc/redis/redis.conf
<span class="token keyword">done</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>查看生成的六个容器</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@izuf6f489inattnq5zpfcxz redis-cluster<span class="token punctuation">]</span><span class="token comment"># docker ps</span>
CONTAINER ID        IMAGE                 COMMAND                  CREATED              STATUS              PORTS                                              NAMES
a6b9f914ece0        redis                 <span class="token string">&quot;docker-entrypoint.s…&quot;</span>   About a minute ago   Up About a minute   <span class="token number">0.0</span>.0.0:6386-<span class="token operator">&gt;</span><span class="token number">6379</span>/tcp, <span class="token number">0.0</span>.0.0:26386-<span class="token operator">&gt;</span><span class="token number">26379</span>/tcp   redis-6
e8fd78ecb460        redis                 <span class="token string">&quot;docker-entrypoint.s…&quot;</span>   About a minute ago   Up About a minute   <span class="token number">0.0</span>.0.0:6385-<span class="token operator">&gt;</span><span class="token number">6379</span>/tcp, <span class="token number">0.0</span>.0.0:26385-<span class="token operator">&gt;</span><span class="token number">26379</span>/tcp   redis-5
aa236068a616        redis                 <span class="token string">&quot;docker-entrypoint.s…&quot;</span>   About a minute ago   Up About a minute   <span class="token number">0.0</span>.0.0:6384-<span class="token operator">&gt;</span><span class="token number">6379</span>/tcp, <span class="token number">0.0</span>.0.0:26384-<span class="token operator">&gt;</span><span class="token number">26379</span>/tcp   redis-4
d07e6c6a0e59        redis                 <span class="token string">&quot;docker-entrypoint.s…&quot;</span>   About a minute ago   Up About a minute   <span class="token number">0.0</span>.0.0:6383-<span class="token operator">&gt;</span><span class="token number">6379</span>/tcp, <span class="token number">0.0</span>.0.0:26383-<span class="token operator">&gt;</span><span class="token number">26379</span>/tcp   redis-3
7404f91d3ec5        redis                 <span class="token string">&quot;docker-entrypoint.s…&quot;</span>   About a minute ago   Up About a minute   <span class="token number">0.0</span>.0.0:6382-<span class="token operator">&gt;</span><span class="token number">6379</span>/tcp, <span class="token number">0.0</span>.0.0:26382-<span class="token operator">&gt;</span><span class="token number">26379</span>/tcp   redis-2
9b59cc207416        redis                 <span class="token string">&quot;docker-entrypoint.s…&quot;</span>   About a minute ago   Up About a minute   <span class="token number">0.0</span>.0.0:6381-<span class="token operator">&gt;</span><span class="token number">6379</span>/tcp, <span class="token number">0.0</span>.0.0:26381-<span class="token operator">&gt;</span><span class="token number">26379</span>/tcp   redis-1

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="_13-4-启动集群"><a href="#_13-4-启动集群" class="header-anchor">#</a> 13.4 启动集群</h3> <p>进入某个redis</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">docker</span> <span class="token builtin class-name">exec</span> -it redis-1 /bin/bash
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>启动集群</p> <blockquote><p>创建redis集群命令 <code>redis-cli --cluster create</code> 参数 <code>--cluster-replicas 1</code> 表示副本是1</p></blockquote> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 创建redis集群命令 redis-cli --cluster create 参数 --cluster-replicas 1 表示副本是1</span>
redis-cli --cluster create -a <span class="token number">123</span> <span class="token number">172.38</span>.0.79:6379 <span class="token number">172.38</span>.0.80:6379 <span class="token number">172.38</span>.0.81:6379 <span class="token number">172.38</span>.0.82:6379 <span class="token number">172.38</span>.0.83:6379 <span class="token number">172.38</span>.0.84:6379 --cluster-replicas <span class="token number">1</span> 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>创建成功</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>Waiting <span class="token keyword">for</span> the cluster to <span class="token function">join</span>
<span class="token builtin class-name">.</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Performing Cluster Check <span class="token punctuation">(</span>using <span class="token function">node</span> <span class="token number">172.38</span>.0.11:6379<span class="token punctuation">)</span>
M: 2dd15c79a6850e19be1cf503731b21b75c618242 <span class="token number">172.38</span>.0.11:6379
   slots:<span class="token punctuation">[</span><span class="token number">0</span>-5460<span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token number">5461</span> slots<span class="token punctuation">)</span> master
   <span class="token number">1</span> additional replica<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
S: 54169c6085325e041c01812d88c0c4718d427989 <span class="token number">172.38</span>.0.15:6379
   slots: <span class="token punctuation">(</span><span class="token number">0</span> slots<span class="token punctuation">)</span> slave
   replicates 2dd15c79a6850e19be1cf503731b21b75c618242
M: 722e27ee6ac3b34416387b56ebae3d69cf54a4d1 <span class="token number">172.38</span>.0.13:6379
   slots:<span class="token punctuation">[</span><span class="token number">10923</span>-16383<span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token number">5461</span> slots<span class="token punctuation">)</span> master
   <span class="token number">1</span> additional replica<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
M: 312454ec0845792a27650f1e237fc8be29d73f52 <span class="token number">172.38</span>.0.12:6379
   slots:<span class="token punctuation">[</span><span class="token number">5461</span>-10922<span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token number">5462</span> slots<span class="token punctuation">)</span> master
   <span class="token number">1</span> additional replica<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
S: f2f92641a484bc2e84a72a7aaeef68d713b1defc <span class="token number">172.38</span>.0.16:6379
   slots: <span class="token punctuation">(</span><span class="token number">0</span> slots<span class="token punctuation">)</span> slave
   replicates 312454ec0845792a27650f1e237fc8be29d73f52
S: dbe7035e84422f582ddd475cb822854c6ff57d00 <span class="token number">172.38</span>.0.14:6379
   slots: <span class="token punctuation">(</span><span class="token number">0</span> slots<span class="token punctuation">)</span> slave
   replicates 722e27ee6ac3b34416387b56ebae3d69cf54a4d1
<span class="token punctuation">[</span>OK<span class="token punctuation">]</span> All nodes agree about slots configuration.
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Check <span class="token keyword">for</span> <span class="token function">open</span> slots<span class="token punctuation">..</span>.
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Check slots coverage<span class="token punctuation">..</span>.
<span class="token punctuation">[</span>OK<span class="token punctuation">]</span> All <span class="token number">16384</span> slots covered.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><h3 id="_13-5-进入集群"><a href="#_13-5-进入集群" class="header-anchor">#</a> 13.5 进入集群</h3> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>redis-cli -c
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>查看集群信息</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> cluster info
cluster_state:ok
cluster_slots_assigned:16384
cluster_slots_ok:16384
cluster_slots_pfail:0
cluster_slots_fail:0
cluster_known_nodes:6
cluster_size:3
cluster_current_epoch:6
cluster_my_epoch:1
cluster_stats_messages_ping_sent:509
cluster_stats_messages_pong_sent:515
cluster_stats_messages_sent:1024
cluster_stats_messages_ping_received:510
cluster_stats_messages_pong_received:509
cluster_stats_messages_meet_received:5
cluster_stats_messages_received:1024
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>查看集群nodes</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> cluster nodes
54169c6085325e041c01812d88c0c4718d427989 <span class="token number">172.38</span>.0.15:6379@16379 slave 2dd15c79a6850e19be1cf503731b21b75c618242 <span class="token number">0</span> <span class="token number">1613875900000</span> <span class="token number">1</span> connected
722e27ee6ac3b34416387b56ebae3d69cf54a4d1 <span class="token number">172.38</span>.0.13:6379@16379 master - <span class="token number">0</span> <span class="token number">1613875900000</span> <span class="token number">3</span> connected <span class="token number">10923</span>-16383
312454ec0845792a27650f1e237fc8be29d73f52 <span class="token number">172.38</span>.0.12:6379@16379 master - <span class="token number">0</span> <span class="token number">1613875900000</span> <span class="token number">2</span> connected <span class="token number">5461</span>-10922
f2f92641a484bc2e84a72a7aaeef68d713b1defc <span class="token number">172.38</span>.0.16:6379@16379 slave 312454ec0845792a27650f1e237fc8be29d73f52 <span class="token number">0</span> <span class="token number">1613875900847</span> <span class="token number">2</span> connected
2dd15c79a6850e19be1cf503731b21b75c618242 <span class="token number">172.38</span>.0.11:6379@16379 myself,master - <span class="token number">0</span> <span class="token number">1613875899000</span> <span class="token number">1</span> connected <span class="token number">0</span>-5460
dbe7035e84422f582ddd475cb822854c6ff57d00 <span class="token number">172.38</span>.0.14:6379@16379 slave 722e27ee6ac3b34416387b56ebae3d69cf54a4d1 <span class="token number">0</span> <span class="token number">1613875899000</span> <span class="token number">3</span> connected
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="_13-6-测试"><a href="#_13-6-测试" class="header-anchor">#</a> 13.6 测试</h3> <p>set一个值</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>root@d0de8a779418:/data<span class="token comment"># redis-cli -c</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> <span class="token builtin class-name">set</span> k1 v1
-<span class="token operator">&gt;</span> Redirected to slot <span class="token punctuation">[</span><span class="token number">12706</span><span class="token punctuation">]</span> located at <span class="token number">172.38</span>.0.13:6379
OK
<span class="token number">172.38</span>.0.13:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>可以看到此值通过桶算法被set到另一个节点。当通过get等命令获取值时如果key在其他节点，也会切换到其他主节点</p> <blockquote><p>注意从节点不提供服务，只是作为备份和集群入口存在</p></blockquote> <h3 id="_13-7-测试集群高可用"><a href="#_13-7-测试集群高可用" class="header-anchor">#</a> 13.7 测试集群高可用</h3> <p>模拟某个节点挂掉，此时他的从节点会顶替成为主节点，当挂掉的节点恢复时，会自动成为新的主节点的从节点</p> <p>查看初始节点状态</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> cluster nodes
54169c6085325e041c01812d88c0c4718d427989 <span class="token number">172.38</span>.0.15:6379@16379 slave 2dd15c79a6850e19be1cf503731b21b75c618242 <span class="token number">0</span> <span class="token number">1613875900000</span> <span class="token number">1</span> connected
722e27ee6ac3b34416387b56ebae3d69cf54a4d1 <span class="token number">172.38</span>.0.13:6379@16379 master - <span class="token number">0</span> <span class="token number">1613875900000</span> <span class="token number">3</span> connected <span class="token number">10923</span>-16383
312454ec0845792a27650f1e237fc8be29d73f52 <span class="token number">172.38</span>.0.12:6379@16379 master - <span class="token number">0</span> <span class="token number">1613875900000</span> <span class="token number">2</span> connected <span class="token number">5461</span>-10922
f2f92641a484bc2e84a72a7aaeef68d713b1defc <span class="token number">172.38</span>.0.16:6379@16379 slave 312454ec0845792a27650f1e237fc8be29d73f52 <span class="token number">0</span> <span class="token number">1613875900847</span> <span class="token number">2</span> connected
2dd15c79a6850e19be1cf503731b21b75c618242 <span class="token number">172.38</span>.0.11:6379@16379 myself,master - <span class="token number">0</span> <span class="token number">1613875899000</span> <span class="token number">1</span> connected <span class="token number">0</span>-5460
dbe7035e84422f582ddd475cb822854c6ff57d00 <span class="token number">172.38</span>.0.14:6379@16379 slave 722e27ee6ac3b34416387b56ebae3d69cf54a4d1 <span class="token number">0</span> <span class="token number">1613875899000</span> <span class="token number">3</span> connected
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>挂掉<code>172.38.0.11:6379</code>的主节点后，从节点<code>172.38.0.15:6379</code>自动顶替成为新的主节点</p> <div class="language-shell line-numbers-mode"><div class="highlight-lines"><br><br><br><br><div class="highlighted"> </div><br><br><br><br><br></div><pre class="language-shell"><code><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> cluster nodes
f2f92641a484bc2e84a72a7aaeef68d713b1defc <span class="token number">172.38</span>.0.16:6379@16379 slave 312454ec0845792a27650f1e237fc8be29d73f52 <span class="token number">0</span> <span class="token number">1613879100375</span> <span class="token number">2</span> connected
dbe7035e84422f582ddd475cb822854c6ff57d00 <span class="token number">172.38</span>.0.14:6379@16379 slave 722e27ee6ac3b34416387b56ebae3d69cf54a4d1 <span class="token number">0</span> <span class="token number">1613879099373</span> <span class="token number">3</span> connected
722e27ee6ac3b34416387b56ebae3d69cf54a4d1 <span class="token number">172.38</span>.0.13:6379@16379 master - <span class="token number">0</span> <span class="token number">1613879100579</span> <span class="token number">3</span> connected <span class="token number">10923</span>-16383
<span class="token comment">#挂掉的主节点</span>
2dd15c79a6850e19be1cf503731b21b75c618242 <span class="token number">172.38</span>.0.11:6379@16379 master,fail - <span class="token number">1613879073779</span> <span class="token number">1613879071274</span> <span class="token number">1</span> connected
312454ec0845792a27650f1e237fc8be29d73f52 <span class="token number">172.38</span>.0.12:6379@16379 myself,master - <span class="token number">0</span> <span class="token number">1613879099000</span> <span class="token number">2</span> connected <span class="token number">5461</span>-10922
<span class="token comment">#顶替上来的从节点</span>
54169c6085325e041c01812d88c0c4718d427989 <span class="token number">172.38</span>.0.15:6379@16379 master - <span class="token number">0</span> <span class="token number">1613879100000</span> <span class="token number">7</span> connected <span class="token number">0</span>-5460
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>此时再恢复挂掉的主节点后</p> <div class="language-shell line-numbers-mode"><div class="highlight-lines"><br><br><br><br><div class="highlighted"> </div><br><br><br></div><pre class="language-shell"><code><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> cluster nodes
f2f92641a484bc2e84a72a7aaeef68d713b1defc <span class="token number">172.38</span>.0.16:6379@16379 slave 312454ec0845792a27650f1e237fc8be29d73f52 <span class="token number">0</span> <span class="token number">1613879274000</span> <span class="token number">2</span> connected
dbe7035e84422f582ddd475cb822854c6ff57d00 <span class="token number">172.38</span>.0.14:6379@16379 slave 722e27ee6ac3b34416387b56ebae3d69cf54a4d1 <span class="token number">0</span> <span class="token number">1613879273030</span> <span class="token number">3</span> connected
722e27ee6ac3b34416387b56ebae3d69cf54a4d1 <span class="token number">172.38</span>.0.13:6379@16379 master - <span class="token number">0</span> <span class="token number">1613879273000</span> <span class="token number">3</span> connected <span class="token number">10923</span>-16383
2dd15c79a6850e19be1cf503731b21b75c618242 <span class="token number">172.38</span>.0.11:6379@16379 slave 54169c6085325e041c01812d88c0c4718d427989 <span class="token number">0</span> <span class="token number">1613879275046</span> <span class="token number">7</span> connected
312454ec0845792a27650f1e237fc8be29d73f52 <span class="token number">172.38</span>.0.12:6379@16379 myself,master - <span class="token number">0</span> <span class="token number">1613879273000</span> <span class="token number">2</span> connected <span class="token number">5461</span>-10922
54169c6085325e041c01812d88c0c4718d427989 <span class="token number">172.38</span>.0.15:6379@16379 master - <span class="token number">0</span> <span class="token number">1613879274042</span> <span class="token number">7</span> connected <span class="token number">0</span>-5460
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><blockquote><p>可以看到此时的<code>172.38.0.11:6379</code>节点已经变为从节点</p></blockquote> <p>如果某个主节点和它的从节点一起挂掉，那么此时的redis集群不可用</p> <p>我们此时挂掉主节点<code>172.38.0.15:6379</code>以及它的从节点<code>172.38.0.11:6379</code>，之后再从其他节点进入查看集群状态</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> cluster info
<span class="token comment">#集群状态为fail不可用</span>
cluster_state:fail
cluster_slots_assigned:16384
cluster_slots_ok:10923
cluster_slots_pfail:0
cluster_slots_fail:5461
cluster_known_nodes:6
cluster_size:3
cluster_current_epoch:7
cluster_my_epoch:2
cluster_stats_messages_ping_sent:9535
cluster_stats_messages_pong_sent:9628
cluster_stats_messages_meet_sent:1
cluster_stats_messages_fail_sent:5
cluster_stats_messages_auth-ack_sent:1
cluster_stats_messages_sent:19170
cluster_stats_messages_ping_received:9628
cluster_stats_messages_pong_received:9534
cluster_stats_messages_fail_received:3
cluster_stats_messages_auth-req_received:1
cluster_stats_messages_received:19166
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p>可以看到<code>cluster_state:fail</code>，说明此时集群已经不可用(fail)</p> <p>再尝试set值也报错误</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> <span class="token builtin class-name">set</span> k2 v2
<span class="token punctuation">(</span>error<span class="token punctuation">)</span> CLUSTERDOWN The cluster is down
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="_13-8-增加节点"><a href="#_13-8-增加节点" class="header-anchor">#</a> 13.8 增加节点</h3> <p>由于集群已经初始化，我们后续增加节点只用增加就行</p> <p>创建两个新的redis容器，配置和创建方式同上</p> <blockquote><p>新增两个redis容器<code>redis-7</code>和<code>redis-8</code></p></blockquote> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@izuf6f489inattnq5zpfcxz ~<span class="token punctuation">]</span><span class="token comment"># docker ps</span>
CONTAINER ID        IMAGE                 COMMAND                  CREATED             STATUS              PORTS                                              NAMES
56cc93bc0184        redis                 <span class="token string">&quot;docker-entrypoint.s…&quot;</span>   <span class="token number">5</span> seconds ago       Up <span class="token number">3</span> seconds        <span class="token number">0.0</span>.0.0:6388-<span class="token operator">&gt;</span><span class="token number">6379</span>/tcp, <span class="token number">0.0</span>.0.0:16388-<span class="token operator">&gt;</span><span class="token number">16379</span>/tcp   redis-8
8c27e66cbe48        redis                 <span class="token string">&quot;docker-entrypoint.s…&quot;</span>   <span class="token number">5</span> seconds ago       Up <span class="token number">4</span> seconds        <span class="token number">0.0</span>.0.0:6387-<span class="token operator">&gt;</span><span class="token number">6379</span>/tcp, <span class="token number">0.0</span>.0.0:16387-<span class="token operator">&gt;</span><span class="token number">16379</span>/tcp   redis-7
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>从某个节点进入集群并新增节点</p> <p>新增了<code>172.38.0.17 6379</code>和<code>172.38.0.18 6379</code></p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token number">172.38</span>.0.15:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> cluster meet <span class="token number">172.38</span>.0.17 <span class="token number">6379</span>
OK
<span class="token number">172.38</span>.0.15:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> cluster meet <span class="token number">172.38</span>.0.18 <span class="token number">6379</span>
OK
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>再次查看集群节点信息</p> <div class="language-shell line-numbers-mode"><div class="highlight-lines"><br><br><br><div class="highlighted"> </div><br><br><br><br><br><br></div><pre class="language-shell"><code><span class="token number">172.38</span>.0.15:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> cluster nodes
2dd15c79a6850e19be1cf503731b21b75c618242 <span class="token number">172.38</span>.0.11:6379@16379 slave 54169c6085325e041c01812d88c0c4718d427989 <span class="token number">0</span> <span class="token number">1613883611396</span> <span class="token number">7</span> connected
722e27ee6ac3b34416387b56ebae3d69cf54a4d1 <span class="token number">172.38</span>.0.13:6379@16379 master - <span class="token number">0</span> <span class="token number">1613883610594</span> <span class="token number">3</span> connected <span class="token number">10923</span>-16383
d1f011036255d7266095b6163b433939722c4acb <span class="token number">172.38</span>.0.18:6379@16379 master - <span class="token number">0</span> <span class="token number">1613883610393</span> <span class="token number">9</span> connected
54169c6085325e041c01812d88c0c4718d427989 <span class="token number">172.38</span>.0.15:6379@16379 myself,master - <span class="token number">0</span> <span class="token number">1613883609000</span> <span class="token number">7</span> connected <span class="token number">0</span>-5460
f2f92641a484bc2e84a72a7aaeef68d713b1defc <span class="token number">172.38</span>.0.16:6379@16379 master - <span class="token number">0</span> <span class="token number">1613883611000</span> <span class="token number">8</span> connected <span class="token number">5461</span>-10922
f288476630bd43910dff617591ac1521e06f9b72 <span class="token number">172.38</span>.0.17:6379@16379 master - <span class="token number">0</span> <span class="token number">1613883610594</span> <span class="token number">0</span> connected
312454ec0845792a27650f1e237fc8be29d73f52 <span class="token number">172.38</span>.0.12:6379@16379 slave f2f92641a484bc2e84a72a7aaeef68d713b1defc <span class="token number">0</span> <span class="token number">1613883611596</span> <span class="token number">8</span> connected
dbe7035e84422f582ddd475cb822854c6ff57d00 <span class="token number">172.38</span>.0.14:6379@16379 slave 722e27ee6ac3b34416387b56ebae3d69cf54a4d1 <span class="token number">0</span> <span class="token number">1613883610000</span> <span class="token number">3</span> connected
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>发现新增的节点进来都是<code>master</code>身份即主节点</p> <h3 id="_13-9-更换节点身份"><a href="#_13-9-更换节点身份" class="header-anchor">#</a> 13.9 更换节点身份</h3> <p>将新增的<code>172.38.0.18 6379</code>节点身份改为<code>172.38.0.17 6379</code>的<code>slave</code></p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>redis-cli -c -h <span class="token number">172.38</span>.0.18 -p <span class="token number">6379</span> cluster replicate f288476630bd43910dff617591ac1521e06f9b72<span class="token punctuation">(</span>主节点node_id<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>也可以进入集群后让当前节点变为某个节点的从节点</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token number">172.38</span>.0.18:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> CLUSTER REPLICATE f288476630bd43910dff617591ac1521e06f9b72
OK
<span class="token number">172.38</span>.0.18:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>再次查看集群节点信息</p> <div class="language-shell line-numbers-mode"><div class="highlight-lines"><br><br><br><br><div class="highlighted"> </div><br><br><br><br><br></div><pre class="language-shell"><code><span class="token number">172.38</span>.0.18:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> cluster nodes
722e27ee6ac3b34416387b56ebae3d69cf54a4d1 <span class="token number">172.38</span>.0.13:6379@16379 master - <span class="token number">0</span> <span class="token number">1613884572000</span> <span class="token number">3</span> connected <span class="token number">10923</span>-16383
dbe7035e84422f582ddd475cb822854c6ff57d00 <span class="token number">172.38</span>.0.14:6379@16379 slave 722e27ee6ac3b34416387b56ebae3d69cf54a4d1 <span class="token number">0</span> <span class="token number">1613884572009</span> <span class="token number">3</span> connected
f2f92641a484bc2e84a72a7aaeef68d713b1defc <span class="token number">172.38</span>.0.16:6379@16379 master - <span class="token number">0</span> <span class="token number">1613884570605</span> <span class="token number">8</span> connected <span class="token number">5461</span>-10922
d1f011036255d7266095b6163b433939722c4acb <span class="token number">172.38</span>.0.18:6379@16379 myself,slave f288476630bd43910dff617591ac1521e06f9b72 <span class="token number">0</span> <span class="token number">1613884572000</span> <span class="token number">0</span> connected
54169c6085325e041c01812d88c0c4718d427989 <span class="token number">172.38</span>.0.15:6379@16379 master - <span class="token number">0</span> <span class="token number">1613884572910</span> <span class="token number">7</span> connected <span class="token number">0</span>-5460
312454ec0845792a27650f1e237fc8be29d73f52 <span class="token number">172.38</span>.0.12:6379@16379 slave f2f92641a484bc2e84a72a7aaeef68d713b1defc <span class="token number">0</span> <span class="token number">1613884571000</span> <span class="token number">8</span> connected
f288476630bd43910dff617591ac1521e06f9b72 <span class="token number">172.38</span>.0.17:6379@16379 master - <span class="token number">0</span> <span class="token number">1613884572409</span> <span class="token number">0</span> connected
2dd15c79a6850e19be1cf503731b21b75c618242 <span class="token number">172.38</span>.0.11:6379@16379 slave 54169c6085325e041c01812d88c0c4718d427989 <span class="token number">0</span> <span class="token number">1613884572000</span> <span class="token number">7</span> connected
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>发现已经更改</p> <h3 id="_13-11-删除节点"><a href="#_13-11-删除节点" class="header-anchor">#</a> 13.11 删除节点</h3> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token number">192.168</span>.30.130:700<span class="token operator"><span class="token file-descriptor important">8</span>&gt;</span> CLUSTER FORGET 1a1c7f02fce87530bd5abdfc98df1cffce4f1767
<span class="token punctuation">(</span>error<span class="token punctuation">)</span> ERR I tried hard but I can<span class="token string">'t forget myself...               #无法删除登录节点

192.168.30.130:7008&gt; CLUSTER FORGET e51ab166bc0f33026887bcf8eba0dff3d5b0bf14
(error) ERR Can'</span>t forget my master<span class="token operator">!</span>                 <span class="token comment">#不能删除自己的master节点</span>

<span class="token number">192.168</span>.30.130:700<span class="token operator"><span class="token file-descriptor important">8</span>&gt;</span> CLUSTER FORGET 6788453ee9a8d7f72b1d45a9093838efd0e501f1
OK              <span class="token comment">#可以删除其它的master节点</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="_13-10-其他集群操作"><a href="#_13-10-其他集群操作" class="header-anchor">#</a> 13.10 其他集群操作</h3> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token number">172.38</span>.0.18:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> cluster <span class="token builtin class-name">help</span>
 <span class="token number">1</span><span class="token punctuation">)</span> CLUSTER <span class="token operator">&lt;</span>subcommand<span class="token operator">&gt;</span> arg arg <span class="token punctuation">..</span>. arg. Subcommands are:
 <span class="token number">2</span><span class="token punctuation">)</span> ADDSLOTS <span class="token operator">&lt;</span>slot<span class="token operator">&gt;</span> <span class="token punctuation">[</span>slot <span class="token punctuation">..</span>.<span class="token punctuation">]</span> -- Assign slots to current node.
 <span class="token number">3</span><span class="token punctuation">)</span> BUMPEPOCH -- Advance the cluster config epoch.
 <span class="token number">4</span><span class="token punctuation">)</span> COUNT-failure-reports <span class="token operator">&lt;</span>node-id<span class="token operator">&gt;</span> -- Return number of failure reports <span class="token keyword">for</span> <span class="token operator">&lt;</span>node-id<span class="token operator">&gt;</span>.
 <span class="token number">5</span><span class="token punctuation">)</span> COUNTKEYSINSLOT <span class="token operator">&lt;</span>slot<span class="token operator">&gt;</span> - Return the number of keys <span class="token keyword">in</span> <span class="token operator">&lt;</span>slot<span class="token operator">&gt;</span>.
 <span class="token number">6</span><span class="token punctuation">)</span> DELSLOTS <span class="token operator">&lt;</span>slot<span class="token operator">&gt;</span> <span class="token punctuation">[</span>slot <span class="token punctuation">..</span>.<span class="token punctuation">]</span> -- Delete slots information from current node.
 <span class="token number">7</span><span class="token punctuation">)</span> FAILOVER <span class="token punctuation">[</span>force<span class="token operator">|</span>takeover<span class="token punctuation">]</span> -- Promote current replica <span class="token function">node</span> to being a master.
 <span class="token number">8</span><span class="token punctuation">)</span> FORGET <span class="token operator">&lt;</span>node-id<span class="token operator">&gt;</span> -- Remove a <span class="token function">node</span> from the cluster.
 <span class="token number">9</span><span class="token punctuation">)</span> GETKEYSINSLOT <span class="token operator">&lt;</span>slot<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>count<span class="token operator">&gt;</span> -- Return key names stored by current <span class="token function">node</span> <span class="token keyword">in</span> a slot.
<span class="token number">10</span><span class="token punctuation">)</span> FLUSHSLOTS -- Delete current <span class="token function">node</span> own slots information.
<span class="token number">11</span><span class="token punctuation">)</span> INFO - Return information about the cluster.
<span class="token number">12</span><span class="token punctuation">)</span> KEYSLOT <span class="token operator">&lt;</span>key<span class="token operator">&gt;</span> -- Return the <span class="token builtin class-name">hash</span> slot <span class="token keyword">for</span> <span class="token operator">&lt;</span>key<span class="token operator">&gt;</span>.
<span class="token number">13</span><span class="token punctuation">)</span> MEET <span class="token operator">&lt;</span>ip<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>port<span class="token operator">&gt;</span> <span class="token punctuation">[</span>bus-port<span class="token punctuation">]</span> -- Connect nodes into a working cluster.
<span class="token number">14</span><span class="token punctuation">)</span> MYID -- Return the <span class="token function">node</span> id.
<span class="token number">15</span><span class="token punctuation">)</span> NODES -- Return cluster configuration seen by node. Output format:
<span class="token number">16</span><span class="token punctuation">)</span>     <span class="token operator">&lt;</span>id<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>ip:port<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>flags<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>master<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>pings<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>pongs<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>epoch<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>link<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>slot<span class="token operator">&gt;</span> <span class="token punctuation">..</span>. <span class="token operator">&lt;</span>slot<span class="token operator">&gt;</span>
<span class="token number">17</span><span class="token punctuation">)</span> REPLICATE <span class="token operator">&lt;</span>node-id<span class="token operator">&gt;</span> -- Configure current <span class="token function">node</span> as replica to <span class="token operator">&lt;</span>node-id<span class="token operator">&gt;</span>.
<span class="token number">18</span><span class="token punctuation">)</span> RESET <span class="token punctuation">[</span>hard<span class="token operator">|</span>soft<span class="token punctuation">]</span> -- Reset current <span class="token function">node</span> <span class="token punctuation">(</span>default: soft<span class="token punctuation">)</span>.
<span class="token number">19</span><span class="token punctuation">)</span> SET-config-epoch <span class="token operator">&lt;</span>epoch<span class="token operator">&gt;</span> - Set config epoch of current node.
<span class="token number">20</span><span class="token punctuation">)</span> SETSLOT <span class="token operator">&lt;</span>slot<span class="token operator">&gt;</span> <span class="token punctuation">(</span>importing<span class="token operator">|</span>migrating<span class="token operator">|</span>stable<span class="token operator">|</span><span class="token function">node</span> <span class="token operator">&lt;</span>node-id<span class="token operator">&gt;</span><span class="token punctuation">)</span> -- Set slot state.
<span class="token number">21</span><span class="token punctuation">)</span> REPLICAS <span class="token operator">&lt;</span>node-id<span class="token operator">&gt;</span> -- Return <span class="token operator">&lt;</span>node-id<span class="token operator">&gt;</span> replicas.
<span class="token number">22</span><span class="token punctuation">)</span> SAVECONFIG - Force saving cluster configuration on disk.
<span class="token number">23</span><span class="token punctuation">)</span> SLOTS -- Return information about slots range mappings. Each range is made of:
<span class="token number">24</span><span class="token punctuation">)</span>     start, end, master and replicas IP addresses, ports and ids
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div></div> <!----> <div class="content__content-bottom"></div> <footer class="page-meta"><div class="edit-link"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon edit-icon"><path d="M117.953 696.992 64.306 959.696l265.931-49.336 450.204-452.505-212.284-213.376-450.204 452.513zm496.384-296.326L219.039 797.993l-46.108-46.34L568.233 354.33l46.104 46.335zm345.357-122.99-114.45 115.04-212.288-213.377 114.45-115.035 212.288 213.371zm0 0" fill="currentColor"></path></svg> <a href="https://github.com/LifeAlsoIsGG/edit/main/database/redis/Redis_deployment&amp;use.md" target="_blank" rel="noopener noreferrer">Edit this page</a></div> <div class="meta-item update-time"><span class="label">Last update:</span> <span class="info">July 2, 2022 04:41</span></div> <div class="meta-item contributors"><span class="label">Contributors: </span> <span class="info"><span title="email: 1138312802@qq.com" class="contributor">
          Draco
        </span> <!----></span></div></footer> <div class="page-nav"><p class="inner"><span class="prev"><a href="/database/redis/Redis_theory_note/" class="prev"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon prev-icon"><path d="M906.783 588.79c-.02 8.499-6.882 15.36-15.38 15.37l-443.7-.01 75.704 191.682c2.52 6.42.482 13.763-5.038 17.91-5.52 4.168-13.138 4.147-18.616-.092L123.228 524.175a15.362 15.362 0 0 1-6-12.165c0-4.782 2.222-9.277 6-12.185L499.753 210.35a15.388 15.388 0 0 1 9.38-3.195c3.236 0 6.502 1.034 9.236 3.103 5.52 4.147 7.578 11.49 5.038 17.91L447.683 419.84l443.72-.01c8.498.01 15.36 6.881 15.36 15.36l.02 153.6z" fill="currentColor"></path></svg>
        Redis理论学习笔记
      </a></span> <span class="next"><a href="/database/redis/Redis_scene/">
        Redis应用场景
        <svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon next-icon"><path d="M906.772 512c0 4.772-2.211 9.267-5.99 12.175L524.257 813.66a15.37 15.37 0 0 1-18.616.092 15.368 15.368 0 0 1-5.038-17.91l75.714-191.672h-443.73c-8.488 0-15.36-6.881-15.36-15.36v-153.6c0-8.489 6.872-15.36 15.36-15.36h443.73l-75.714-191.682a15.358 15.358 0 0 1 5.048-17.91c5.51-4.158 13.128-4.137 18.606.092l376.525 289.485a15.323 15.323 0 0 1 5.99 12.165z" fill="currentColor"></path></svg></a></span></p></div> <div class="comments-wrapper"><div class="waline-wrapper"><div id="waline-comment"></div></div></div> <!----> <div class="content__page-bottom"></div></main> <footer class="footer-wrapper"><div class="media-links-wrapper"><a href="https://github.com/LifeAlsoIsGG" rel="noopener noreferrer" target="_blank" aria-label="Github" data-balloon-pos="up" class="media-link"><span class="sr-only">Github</span> <svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon icon-github"><circle cx="512" cy="512" r="512" fill="#171515"></circle> <path d="M509.423 146.442c-200.317 0-362.756 162.42-362.756 362.8 0 160.266 103.936 296.24 248.109 344.217 18.139 3.327 24.76-7.872 24.76-17.486 0-8.613-.313-31.427-.49-61.702-100.912 21.923-122.205-48.63-122.205-48.63-16.495-41.91-40.28-53.067-40.28-53.067-32.937-22.51 2.492-22.053 2.492-22.053 36.407 2.566 55.568 37.386 55.568 37.386 32.362 55.438 84.907 39.43 105.58 30.143 3.296-23.444 12.667-39.43 23.032-48.498-80.557-9.156-165.246-40.28-165.246-179.297 0-39.604 14.135-71.988 37.342-97.348-3.731-9.178-16.18-46.063 3.556-96.009 0 0 30.46-9.754 99.76 37.19 28.937-8.048 59.97-12.071 90.823-12.211 30.807.14 61.843 4.165 90.822 12.21 69.26-46.944 99.663-37.189 99.663-37.189 19.792 49.946 7.34 86.831 3.61 96.01 23.25 25.359 37.29 57.742 37.29 97.347 0 139.366-84.82 170.033-165.637 179.013 13.026 11.2 24.628 33.342 24.628 67.182 0 48.498-.445 87.627-.445 99.521 0 9.702 6.535 20.988 24.945 17.444 144.03-48.067 247.881-183.95 247.881-344.175 0-200.378-162.442-362.798-362.802-362.798z" fill="#FFF"></path></svg></a><a href="https://twitter.com/LifeAlsoIsGG" rel="noopener noreferrer" target="_blank" aria-label="Twitter" data-balloon-pos="up" class="media-link"><span class="sr-only">Twitter</span> <svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon icon-twitter"><circle cx="512" cy="512" r="512" fill="#5EAADE"></circle> <path d="M749.737 364.631c-17.594 7.805-36.513 13.088-56.371 15.459 20.269-12.148 35.836-31.387 43.156-54.312A196.233 196.233 0 0 1 674.2 349.6c-17.894-19.083-43.406-30.997-71.636-30.997-54.2 0-98.137 43.944-98.137 98.157 0 7.695.861 15.19 2.544 22.373-81.57-4.092-153.876-43.174-202.284-102.558-8.443 14.498-13.285 31.356-13.285 49.348 0 34.05 17.326 64.096 43.656 81.697a97.69 97.69 0 0 1-44.447-12.277c-.01.41-.01.82-.01 1.24 0 47.558 33.822 87.23 78.72 96.249a98.285 98.285 0 0 1-25.852 3.448 97.491 97.491 0 0 1-18.465-1.768c12.483 39.002 48.725 67.38 91.672 68.17-33.582 26.334-75.897 42.024-121.884 42.024-7.924 0-15.736-.46-23.408-1.37 43.434 27.844 95.014 44.104 150.443 44.104 180.505 0 279.221-149.576 279.221-279.294 0-4.263-.09-8.494-.278-12.708 19.178-13.835 35.813-31.115 48.967-50.807z" fill="#FFF"></path></svg></a><a href="http://localhost:8083/blog-vuepress/tencent:/AddContact/?fromId=50&amp;fromSubId=1&amp;subcmd=all&amp;uin=1138312802.html" rel="noopener noreferrer" target="_blank" aria-label="QQ" data-balloon-pos="up" class="media-link"><span class="sr-only">QQ</span> <svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon icon-qq"><circle cx="512" cy="512" r="512" fill="#5EAADE"></circle> <path d="M729.46 627.3c-3.157-39.628-24.045-83.747-32.624-105.91l-22.084-57.047c-.702-23.73 6.312-78.322-30.511-146.61s-110.82-74.446-124.497-75.147c-13.677-.701-99.248-1.403-141.331 72.945-42.084 74.347-30.745 148.812-30.745 148.812l-23.523 57.478c-.001.002-10.962 26.223-20.43 58.135-9.469 31.914-18.938 82.064-9.469 92.234 9.47 10.17 43.837-46.643 46.993-51.903 0 0 2.456 27.18 8.943 41.383l.81 1.776.33.723.38.826.3.652.444.96.203.436a281.465 281.465 0 0 0 1.917 4.025l.189.386c.231.473.468.953.711 1.442l.146.292c6.886 13.807 18.61 33.823 37.443 50.42l.018.016-1.184.387c-10.667 3.516-31.694 11.21-40.625 19.82-1.717 1.655-2.987 3.344-3.65 5.045-5.376 13.794 4.208 15.43 20.575 16.366 16.366.934 94.923 3.04 132.564-2.221.407-.056.787-.114 1.17-.171 2.711.094 5.324.142 7.83.16l.151.002c.836.005 1.663.008 2.475.008.496 0 1.015-.002 1.542-.006l.21-.001a222.593 222.593 0 0 0 5.462-.107c.26.038.508.076.778.114 37.642 5.26 116.198 3.156 132.564 2.22 16.366-.934 25.951-2.571 20.574-16.365-4.302-11.037-34.175-21.62-45.956-25.413a141.388 141.388 0 0 0 7.958-7.645l.237-.245a142.494 142.494 0 0 0 2.53-2.702c42.435-46.643 38.928-76.101 40.682-92.935 0 0 35.775 51.553 43.488 53.306 7.713 1.754 10.169-6.31 7.012-45.94z" fill="#FFF"></path></svg></a></div> <div class="footer">粤ICP备19126168号</div> <div class="copyright">Copyright © 2022 Draco</div></footer></div><div class="global-ui"><!----><div id="pwa-install"><!----> <div id="install-modal-wrapper" style="display:none;"><div class="background"></div> <div class="install-modal"><div class="header"><button aria-label="Close" class="close-button"><svg width="23" height="22" xmlns="http://www.w3.org/2000/svg" class="icon close-icon"><path fill-rule="evenodd" clip-rule="evenodd" d="M1.12.358a1.224 1.224 0 011.729 0l8.92 8.914L20.686.358a1.224 1.224 0 011.73 1.728L13.497 11l8.92 8.913a1.222 1.222 0 11-1.73 1.729l-8.919-8.913-8.92 8.913a1.224 1.224 0 01-1.729-1.729L10.04 11l-8.92-8.914a1.222 1.222 0 010-1.728z" fill="currentColor"></path></svg></button> <div class="logo"><!----> <div class="title"><h1></h1> <p class="desc">This app can be installed on your PC or mobile device.  This will allow this web app to look and behave like any other installed app.  You will find it in your app lists and be able to pin it to your home screen, start menus or task bars.  This installed web app will also be able to safely interact with other apps and your operating system. </p></div></div></div> <div class="content"><div class="highlight"><!----> <!----></div> <div class="description"><h3>Description</h3> <p></p></div></div> <div class="button-wrapper"><button class="install-button">
        Install <span></span></button> <button class="cancel-button">
        Cancel
      </button></div></div></div></div><!----><div tabindex="-1" role="dialog" aria-hidden="true" class="pswp"><div class="pswp__bg"></div> <div class="pswp__scroll-wrap"><div class="pswp__container"><div class="pswp__item"></div> <div class="pswp__item"></div> <div class="pswp__item"></div></div> <div class="pswp__ui pswp__ui--hidden"><div class="pswp__top-bar"><div class="pswp__counter"></div> <button title="Close" aria-label="Close" class="pswp__button pswp__button--close"></button> <button title="Share" aria-label="Share" class="pswp__button pswp__button--share"></button> <button title="Switch to full screen" aria-label="Switch to full screen" class="pswp__button pswp__button--fs"></button> <button title="Zoom in/out" aria-label="Zoom in/out" class="pswp__button pswp__button--zoom"></button> <div class="pswp__preloader"><div class="pswp__preloader__icn"><div class="pswp__preloader__cut"><div class="pswp__preloader__donut"></div></div></div></div></div> <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class="pswp__share-tooltip"></div></div> <button title="Prev (Arrow Left)" aria-label="Prev (Arrow Left)" class="pswp__button pswp__button--arrow--left"></button> <button title="Next (Arrow Right)" aria-label="Next (Arrow Right)" class="pswp__button pswp__button--arrow--right"></button> <div class="pswp__caption"><div class="pswp__caption__center"></div></div></div></div></div></div></div>
    <script src="/assets/js/app.f37efbaf.js" defer></script><script src="/assets/js/vendors~layout-Layout.f4e7cf7e.js" defer></script><script src="/assets/js/vendors~layout-Blog~layout-Layout~layout-NotFound.9dd70d26.js" defer></script><script src="/assets/js/page-Redis部署与基本使用.ebeabc90.js" defer></script><script src="/assets/js/vendors~layout-Blog~layout-Layout.2ab8e312.js" defer></script>
  </body>
</html>
